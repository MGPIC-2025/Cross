import{T as wc,a as ii,b as ar,L as rr,c as hn,F as eo,M as ls,V as At,C as as,d as rs,S as vs,e as Sc,P as Xs,D as gs,f as zs,g as Ae,I as lr,Q as an,h as Tc,O as cr,i as Mc,j as Cc,B as mn,k as Ec,l as ur,N as xc,m as kc,n as Ac,o as ai,p as dr,R as ri,q as Rc,r as $c,s as Pc,t as Ho,u as Lc,v as $t,w as ks,x as Ct,y as Ic,z as fr,A as Oc,E as et,G as Dc,H as Nc,J as Gc,K as Hc,U as Xt,W as Ln,X as pr,Y as Uc,Z as Fc,_ as Bc,$ as jc,a0 as zc,a1 as hr,a2 as Vc,a3 as ta,a4 as sa,a5 as na,a6 as oa,a7 as li,a8 as Kc,a9 as Wc,aa as wt,ab as qc,ac as Xc,ad as qt,ae as _o,af as go,ag as vo,ah as Yc,ai as Jc,aj as Js,ak as Ys,al as ia,am as Zc,an as mr,ao as to,ap as ci,aq as so,ar as Qc,as as eu,at as tu,au as aa,av as su}from"./three-BxQHwZkI.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=s(o);fetch(o.href,i)}})();const nu="debug";function f(...t){switch(nu){case"debug":console.log(...t);break}}/**
* @vue/shared v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function xi(t){const e=Object.create(null);for(const s of t.split(","))e[s]=1;return s=>s in e}const Ke={},Zs=[],Jt=()=>{},_r=()=>!1,yo=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),ki=t=>t.startsWith("onUpdate:"),ht=Object.assign,Ai=(t,e)=>{const s=t.indexOf(e);s>-1&&t.splice(s,1)},ou=Object.prototype.hasOwnProperty,Be=(t,e)=>ou.call(t,e),Se=Array.isArray,Qs=t=>bo(t)==="[object Map]",gr=t=>bo(t)==="[object Set]",Re=t=>typeof t=="function",nt=t=>typeof t=="string",Ls=t=>typeof t=="symbol",Je=t=>t!==null&&typeof t=="object",vr=t=>(Je(t)||Re(t))&&Re(t.then)&&Re(t.catch),yr=Object.prototype.toString,bo=t=>yr.call(t),iu=t=>bo(t).slice(8,-1),br=t=>bo(t)==="[object Object]",Ri=t=>nt(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,_n=xi(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),wo=t=>{const e=Object.create(null);return s=>e[s]||(e[s]=t(s))},au=/-\w/g,As=wo(t=>t.replace(au,e=>e.slice(1).toUpperCase())),ru=/\B([A-Z])/g,Ks=wo(t=>t.replace(ru,"-$1").toLowerCase()),wr=wo(t=>t.charAt(0).toUpperCase()+t.slice(1)),Uo=wo(t=>t?`on${wr(t)}`:""),xs=(t,e)=>!Object.is(t,e),Fo=(t,...e)=>{for(let s=0;s<t.length;s++)t[s](...e)},Sr=(t,e,s,n=!1)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:n,value:s})},lu=t=>{const e=parseFloat(t);return isNaN(e)?t:e},cu=t=>{const e=nt(t)?Number(t):NaN;return isNaN(e)?t:e};let ra;const So=()=>ra||(ra=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Ft(t){if(Se(t)){const e={};for(let s=0;s<t.length;s++){const n=t[s],o=nt(n)?pu(n):Ft(n);if(o)for(const i in o)e[i]=o[i]}return e}else if(nt(t)||Je(t))return t}const uu=/;(?![^(]*\))/g,du=/:([^]+)/,fu=/\/\*[^]*?\*\//g;function pu(t){const e={};return t.replace(fu,"").split(uu).forEach(s=>{if(s){const n=s.split(du);n.length>1&&(e[n[0].trim()]=n[1].trim())}}),e}function Ye(t){let e="";if(nt(t))e=t;else if(Se(t))for(let s=0;s<t.length;s++){const n=Ye(t[s]);n&&(e+=n+" ")}else if(Je(t))for(const s in t)t[s]&&(e+=s+" ");return e.trim()}const hu="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",mu=xi(hu);function Tr(t){return!!t||t===""}const Mr=t=>!!(t&&t.__v_isRef===!0),se=t=>nt(t)?t:t==null?"":Se(t)||Je(t)&&(t.toString===yr||!Re(t.toString))?Mr(t)?se(t.value):JSON.stringify(t,Cr,2):String(t),Cr=(t,e)=>Mr(e)?Cr(t,e.value):Qs(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((s,[n,o],i)=>(s[Bo(n,i)+" =>"]=o,s),{})}:gr(e)?{[`Set(${e.size})`]:[...e.values()].map(s=>Bo(s))}:Ls(e)?Bo(e):Je(e)&&!Se(e)&&!br(e)?String(e):e,Bo=(t,e="")=>{var s;return Ls(t)?`Symbol(${(s=t.description)!=null?s:e})`:t};function _u(t){return t==null?"initial":typeof t=="string"?t===""?" ":t:String(t)}/**
* @vue/reactivity v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Rt;class gu{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Rt,!e&&Rt&&(this.index=(Rt.scopes||(Rt.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,s;if(this.scopes)for(e=0,s=this.scopes.length;e<s;e++)this.scopes[e].pause();for(e=0,s=this.effects.length;e<s;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,s;if(this.scopes)for(e=0,s=this.scopes.length;e<s;e++)this.scopes[e].resume();for(e=0,s=this.effects.length;e<s;e++)this.effects[e].resume()}}run(e){if(this._active){const s=Rt;try{return Rt=this,e()}finally{Rt=s}}}on(){++this._on===1&&(this.prevScope=Rt,Rt=this)}off(){this._on>0&&--this._on===0&&(Rt=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let s,n;for(s=0,n=this.effects.length;s<n;s++)this.effects[s].stop();for(this.effects.length=0,s=0,n=this.cleanups.length;s<n;s++)this.cleanups[s]();if(this.cleanups.length=0,this.scopes){for(s=0,n=this.scopes.length;s<n;s++)this.scopes[s].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const o=this.parent.scopes.pop();o&&o!==this&&(this.parent.scopes[this.index]=o,o.index=this.index)}this.parent=void 0}}}function vu(){return Rt}let Xe;const jo=new WeakSet;class Er{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Rt&&Rt.active&&Rt.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,jo.has(this)&&(jo.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||kr(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,la(this),Ar(this);const e=Xe,s=Zt;Xe=this,Zt=!0;try{return this.fn()}finally{Rr(this),Xe=e,Zt=s,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Li(e);this.deps=this.depsTail=void 0,la(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?jo.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){ui(this)&&this.run()}get dirty(){return ui(this)}}let xr=0,gn,vn;function kr(t,e=!1){if(t.flags|=8,e){t.next=vn,vn=t;return}t.next=gn,gn=t}function $i(){xr++}function Pi(){if(--xr>0)return;if(vn){let e=vn;for(vn=void 0;e;){const s=e.next;e.next=void 0,e.flags&=-9,e=s}}let t;for(;gn;){let e=gn;for(gn=void 0;e;){const s=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(n){t||(t=n)}e=s}}if(t)throw t}function Ar(t){for(let e=t.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function Rr(t){let e,s=t.depsTail,n=s;for(;n;){const o=n.prevDep;n.version===-1?(n===s&&(s=o),Li(n),yu(n)):e=n,n.dep.activeLink=n.prevActiveLink,n.prevActiveLink=void 0,n=o}t.deps=e,t.depsTail=s}function ui(t){for(let e=t.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&($r(e.dep.computed)||e.dep.version!==e.version))return!0;return!!t._dirty}function $r(t){if(t.flags&4&&!(t.flags&16)||(t.flags&=-17,t.globalVersion===Cn)||(t.globalVersion=Cn,!t.isSSR&&t.flags&128&&(!t.deps&&!t._dirty||!ui(t))))return;t.flags|=2;const e=t.dep,s=Xe,n=Zt;Xe=t,Zt=!0;try{Ar(t);const o=t.fn(t._value);(e.version===0||xs(o,t._value))&&(t.flags|=128,t._value=o,e.version++)}catch(o){throw e.version++,o}finally{Xe=s,Zt=n,Rr(t),t.flags&=-3}}function Li(t,e=!1){const{dep:s,prevSub:n,nextSub:o}=t;if(n&&(n.nextSub=o,t.prevSub=void 0),o&&(o.prevSub=n,t.nextSub=void 0),s.subs===t&&(s.subs=n,!n&&s.computed)){s.computed.flags&=-5;for(let i=s.computed.deps;i;i=i.nextDep)Li(i,!0)}!e&&!--s.sc&&s.map&&s.map.delete(s.key)}function yu(t){const{prevDep:e,nextDep:s}=t;e&&(e.nextDep=s,t.prevDep=void 0),s&&(s.prevDep=e,t.nextDep=void 0)}let Zt=!0;const Pr=[];function bs(){Pr.push(Zt),Zt=!1}function ws(){const t=Pr.pop();Zt=t===void 0?!0:t}function la(t){const{cleanup:e}=t;if(t.cleanup=void 0,e){const s=Xe;Xe=void 0;try{e()}finally{Xe=s}}}let Cn=0;class bu{constructor(e,s){this.sub=e,this.dep=s,this.version=s.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Ii{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Xe||!Zt||Xe===this.computed)return;let s=this.activeLink;if(s===void 0||s.sub!==Xe)s=this.activeLink=new bu(Xe,this),Xe.deps?(s.prevDep=Xe.depsTail,Xe.depsTail.nextDep=s,Xe.depsTail=s):Xe.deps=Xe.depsTail=s,Lr(s);else if(s.version===-1&&(s.version=this.version,s.nextDep)){const n=s.nextDep;n.prevDep=s.prevDep,s.prevDep&&(s.prevDep.nextDep=n),s.prevDep=Xe.depsTail,s.nextDep=void 0,Xe.depsTail.nextDep=s,Xe.depsTail=s,Xe.deps===s&&(Xe.deps=n)}return s}trigger(e){this.version++,Cn++,this.notify(e)}notify(e){$i();try{for(let s=this.subs;s;s=s.prevSub)s.sub.notify()&&s.sub.dep.notify()}finally{Pi()}}}function Lr(t){if(t.dep.sc++,t.sub.flags&4){const e=t.dep.computed;if(e&&!t.dep.subs){e.flags|=20;for(let n=e.deps;n;n=n.nextDep)Lr(n)}const s=t.dep.subs;s!==t&&(t.prevSub=s,s&&(s.nextSub=t)),t.dep.subs=t}}const di=new WeakMap,Vs=Symbol(""),fi=Symbol(""),En=Symbol("");function gt(t,e,s){if(Zt&&Xe){let n=di.get(t);n||di.set(t,n=new Map);let o=n.get(s);o||(n.set(s,o=new Ii),o.map=n,o.key=s),o.track()}}function ms(t,e,s,n,o,i){const a=di.get(t);if(!a){Cn++;return}const r=l=>{l&&l.trigger()};if($i(),e==="clear")a.forEach(r);else{const l=Se(t),c=l&&Ri(s);if(l&&s==="length"){const u=Number(n);a.forEach((d,m)=>{(m==="length"||m===En||!Ls(m)&&m>=u)&&r(d)})}else switch((s!==void 0||a.has(void 0))&&r(a.get(s)),c&&r(a.get(En)),e){case"add":l?c&&r(a.get("length")):(r(a.get(Vs)),Qs(t)&&r(a.get(fi)));break;case"delete":l||(r(a.get(Vs)),Qs(t)&&r(a.get(fi)));break;case"set":Qs(t)&&r(a.get(Vs));break}}Pi()}function Ws(t){const e=Fe(t);return e===t?e:(gt(e,"iterate",En),zt(t)?e:e.map(pt))}function To(t){return gt(t=Fe(t),"iterate",En),t}const wu={__proto__:null,[Symbol.iterator](){return zo(this,Symbol.iterator,pt)},concat(...t){return Ws(this).concat(...t.map(e=>Se(e)?Ws(e):e))},entries(){return zo(this,"entries",t=>(t[1]=pt(t[1]),t))},every(t,e){return ds(this,"every",t,e,void 0,arguments)},filter(t,e){return ds(this,"filter",t,e,s=>s.map(pt),arguments)},find(t,e){return ds(this,"find",t,e,pt,arguments)},findIndex(t,e){return ds(this,"findIndex",t,e,void 0,arguments)},findLast(t,e){return ds(this,"findLast",t,e,pt,arguments)},findLastIndex(t,e){return ds(this,"findLastIndex",t,e,void 0,arguments)},forEach(t,e){return ds(this,"forEach",t,e,void 0,arguments)},includes(...t){return Vo(this,"includes",t)},indexOf(...t){return Vo(this,"indexOf",t)},join(t){return Ws(this).join(t)},lastIndexOf(...t){return Vo(this,"lastIndexOf",t)},map(t,e){return ds(this,"map",t,e,void 0,arguments)},pop(){return cn(this,"pop")},push(...t){return cn(this,"push",t)},reduce(t,...e){return ca(this,"reduce",t,e)},reduceRight(t,...e){return ca(this,"reduceRight",t,e)},shift(){return cn(this,"shift")},some(t,e){return ds(this,"some",t,e,void 0,arguments)},splice(...t){return cn(this,"splice",t)},toReversed(){return Ws(this).toReversed()},toSorted(t){return Ws(this).toSorted(t)},toSpliced(...t){return Ws(this).toSpliced(...t)},unshift(...t){return cn(this,"unshift",t)},values(){return zo(this,"values",pt)}};function zo(t,e,s){const n=To(t),o=n[e]();return n!==t&&!zt(t)&&(o._next=o.next,o.next=()=>{const i=o._next();return i.done||(i.value=s(i.value)),i}),o}const Su=Array.prototype;function ds(t,e,s,n,o,i){const a=To(t),r=a!==t&&!zt(t),l=a[e];if(l!==Su[e]){const d=l.apply(t,i);return r?pt(d):d}let c=s;a!==t&&(r?c=function(d,m){return s.call(this,pt(d),m,t)}:s.length>2&&(c=function(d,m){return s.call(this,d,m,t)}));const u=l.call(a,c,n);return r&&o?o(u):u}function ca(t,e,s,n){const o=To(t);let i=s;return o!==t&&(zt(t)?s.length>3&&(i=function(a,r,l){return s.call(this,a,r,l,t)}):i=function(a,r,l){return s.call(this,a,pt(r),l,t)}),o[e](i,...n)}function Vo(t,e,s){const n=Fe(t);gt(n,"iterate",En);const o=n[e](...s);return(o===-1||o===!1)&&Gi(s[0])?(s[0]=Fe(s[0]),n[e](...s)):o}function cn(t,e,s=[]){bs(),$i();const n=Fe(t)[e].apply(t,s);return Pi(),ws(),n}const Tu=xi("__proto__,__v_isRef,__isVue"),Ir=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(Ls));function Mu(t){Ls(t)||(t=String(t));const e=Fe(this);return gt(e,"has",t),e.hasOwnProperty(t)}class Or{constructor(e=!1,s=!1){this._isReadonly=e,this._isShallow=s}get(e,s,n){if(s==="__v_skip")return e.__v_skip;const o=this._isReadonly,i=this._isShallow;if(s==="__v_isReactive")return!o;if(s==="__v_isReadonly")return o;if(s==="__v_isShallow")return i;if(s==="__v_raw")return n===(o?i?Iu:Hr:i?Gr:Nr).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(n)?e:void 0;const a=Se(e);if(!o){let l;if(a&&(l=wu[s]))return l;if(s==="hasOwnProperty")return Mu}const r=Reflect.get(e,s,vt(e)?e:n);if((Ls(s)?Ir.has(s):Tu(s))||(o||gt(e,"get",s),i))return r;if(vt(r)){const l=a&&Ri(s)?r:r.value;return o&&Je(l)?hi(l):l}return Je(r)?o?hi(r):Di(r):r}}class Dr extends Or{constructor(e=!1){super(!1,e)}set(e,s,n,o){let i=e[s];if(!this._isShallow){const l=Rs(i);if(!zt(n)&&!Rs(n)&&(i=Fe(i),n=Fe(n)),!Se(e)&&vt(i)&&!vt(n))return l||(i.value=n),!0}const a=Se(e)&&Ri(s)?Number(s)<e.length:Be(e,s),r=Reflect.set(e,s,n,vt(e)?e:o);return e===Fe(o)&&(a?xs(n,i)&&ms(e,"set",s,n):ms(e,"add",s,n)),r}deleteProperty(e,s){const n=Be(e,s);e[s];const o=Reflect.deleteProperty(e,s);return o&&n&&ms(e,"delete",s,void 0),o}has(e,s){const n=Reflect.has(e,s);return(!Ls(s)||!Ir.has(s))&&gt(e,"has",s),n}ownKeys(e){return gt(e,"iterate",Se(e)?"length":Vs),Reflect.ownKeys(e)}}class Cu extends Or{constructor(e=!1){super(!0,e)}set(e,s){return!0}deleteProperty(e,s){return!0}}const Eu=new Dr,xu=new Cu,ku=new Dr(!0);const pi=t=>t,Un=t=>Reflect.getPrototypeOf(t);function Au(t,e,s){return function(...n){const o=this.__v_raw,i=Fe(o),a=Qs(i),r=t==="entries"||t===Symbol.iterator&&a,l=t==="keys"&&a,c=o[t](...n),u=s?pi:e?no:pt;return!e&&gt(i,"iterate",l?fi:Vs),{next(){const{value:d,done:m}=c.next();return m?{value:d,done:m}:{value:r?[u(d[0]),u(d[1])]:u(d),done:m}},[Symbol.iterator](){return this}}}}function Fn(t){return function(...e){return t==="delete"?!1:t==="clear"?void 0:this}}function Ru(t,e){const s={get(o){const i=this.__v_raw,a=Fe(i),r=Fe(o);t||(xs(o,r)&&gt(a,"get",o),gt(a,"get",r));const{has:l}=Un(a),c=e?pi:t?no:pt;if(l.call(a,o))return c(i.get(o));if(l.call(a,r))return c(i.get(r));i!==a&&i.get(o)},get size(){const o=this.__v_raw;return!t&&gt(Fe(o),"iterate",Vs),o.size},has(o){const i=this.__v_raw,a=Fe(i),r=Fe(o);return t||(xs(o,r)&&gt(a,"has",o),gt(a,"has",r)),o===r?i.has(o):i.has(o)||i.has(r)},forEach(o,i){const a=this,r=a.__v_raw,l=Fe(r),c=e?pi:t?no:pt;return!t&&gt(l,"iterate",Vs),r.forEach((u,d)=>o.call(i,c(u),c(d),a))}};return ht(s,t?{add:Fn("add"),set:Fn("set"),delete:Fn("delete"),clear:Fn("clear")}:{add(o){!e&&!zt(o)&&!Rs(o)&&(o=Fe(o));const i=Fe(this);return Un(i).has.call(i,o)||(i.add(o),ms(i,"add",o,o)),this},set(o,i){!e&&!zt(i)&&!Rs(i)&&(i=Fe(i));const a=Fe(this),{has:r,get:l}=Un(a);let c=r.call(a,o);c||(o=Fe(o),c=r.call(a,o));const u=l.call(a,o);return a.set(o,i),c?xs(i,u)&&ms(a,"set",o,i):ms(a,"add",o,i),this},delete(o){const i=Fe(this),{has:a,get:r}=Un(i);let l=a.call(i,o);l||(o=Fe(o),l=a.call(i,o)),r&&r.call(i,o);const c=i.delete(o);return l&&ms(i,"delete",o,void 0),c},clear(){const o=Fe(this),i=o.size!==0,a=o.clear();return i&&ms(o,"clear",void 0,void 0),a}}),["keys","values","entries",Symbol.iterator].forEach(o=>{s[o]=Au(o,t,e)}),s}function Oi(t,e){const s=Ru(t,e);return(n,o,i)=>o==="__v_isReactive"?!t:o==="__v_isReadonly"?t:o==="__v_raw"?n:Reflect.get(Be(s,o)&&o in n?s:n,o,i)}const $u={get:Oi(!1,!1)},Pu={get:Oi(!1,!0)},Lu={get:Oi(!0,!1)};const Nr=new WeakMap,Gr=new WeakMap,Hr=new WeakMap,Iu=new WeakMap;function Ou(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Du(t){return t.__v_skip||!Object.isExtensible(t)?0:Ou(iu(t))}function Di(t){return Rs(t)?t:Ni(t,!1,Eu,$u,Nr)}function Nu(t){return Ni(t,!1,ku,Pu,Gr)}function hi(t){return Ni(t,!0,xu,Lu,Hr)}function Ni(t,e,s,n,o){if(!Je(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const i=Du(t);if(i===0)return t;const a=o.get(t);if(a)return a;const r=new Proxy(t,i===2?n:s);return o.set(t,r),r}function en(t){return Rs(t)?en(t.__v_raw):!!(t&&t.__v_isReactive)}function Rs(t){return!!(t&&t.__v_isReadonly)}function zt(t){return!!(t&&t.__v_isShallow)}function Gi(t){return t?!!t.__v_raw:!1}function Fe(t){const e=t&&t.__v_raw;return e?Fe(e):t}function Gu(t){return!Be(t,"__v_skip")&&Object.isExtensible(t)&&Sr(t,"__v_skip",!0),t}const pt=t=>Je(t)?Di(t):t,no=t=>Je(t)?hi(t):t;function vt(t){return t?t.__v_isRef===!0:!1}function W(t){return Hu(t,!1)}function Hu(t,e){return vt(t)?t:new Uu(t,e)}class Uu{constructor(e,s){this.dep=new Ii,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=s?e:Fe(e),this._value=s?e:pt(e),this.__v_isShallow=s}get value(){return this.dep.track(),this._value}set value(e){const s=this._rawValue,n=this.__v_isShallow||zt(e)||Rs(e);e=n?e:Fe(e),xs(e,s)&&(this._rawValue=e,this._value=n?e:pt(e),this.dep.trigger())}}function ue(t){return vt(t)?t.value:t}const Fu={get:(t,e,s)=>e==="__v_raw"?t:ue(Reflect.get(t,e,s)),set:(t,e,s,n)=>{const o=t[e];return vt(o)&&!vt(s)?(o.value=s,!0):Reflect.set(t,e,s,n)}};function Ur(t){return en(t)?t:new Proxy(t,Fu)}class Bu{constructor(e,s,n){this.fn=e,this.setter=s,this._value=void 0,this.dep=new Ii(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Cn-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!s,this.isSSR=n}notify(){if(this.flags|=16,!(this.flags&8)&&Xe!==this)return kr(this,!0),!0}get value(){const e=this.dep.track();return $r(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function ju(t,e,s=!1){let n,o;return Re(t)?n=t:(n=t.get,o=t.set),new Bu(n,o,s)}const Bn={},oo=new WeakMap;let Fs;function zu(t,e=!1,s=Fs){if(s){let n=oo.get(s);n||oo.set(s,n=[]),n.push(t)}}function Vu(t,e,s=Ke){const{immediate:n,deep:o,once:i,scheduler:a,augmentJob:r,call:l}=s,c=w=>o?w:zt(w)||o===!1||o===0?_s(w,1):_s(w);let u,d,m,h,_=!1,E=!1;if(vt(t)?(d=()=>t.value,_=zt(t)):en(t)?(d=()=>c(t),_=!0):Se(t)?(E=!0,_=t.some(w=>en(w)||zt(w)),d=()=>t.map(w=>{if(vt(w))return w.value;if(en(w))return c(w);if(Re(w))return l?l(w,2):w()})):Re(t)?e?d=l?()=>l(t,2):t:d=()=>{if(m){bs();try{m()}finally{ws()}}const w=Fs;Fs=u;try{return l?l(t,3,[h]):t(h)}finally{Fs=w}}:d=Jt,e&&o){const w=d,$=o===!0?1/0:o;d=()=>_s(w(),$)}const S=vu(),v=()=>{u.stop(),S&&S.active&&Ai(S.effects,u)};if(i&&e){const w=e;e=(...$)=>{w(...$),v()}}let M=E?new Array(t.length).fill(Bn):Bn;const b=w=>{if(!(!(u.flags&1)||!u.dirty&&!w))if(e){const $=u.run();if(o||_||(E?$.some((F,B)=>xs(F,M[B])):xs($,M))){m&&m();const F=Fs;Fs=u;try{const B=[$,M===Bn?void 0:E&&M[0]===Bn?[]:M,h];M=$,l?l(e,3,B):e(...B)}finally{Fs=F}}}else u.run()};return r&&r(b),u=new Er(d),u.scheduler=a?()=>a(b,!1):b,h=w=>zu(w,!1,u),m=u.onStop=()=>{const w=oo.get(u);if(w){if(l)l(w,4);else for(const $ of w)$();oo.delete(u)}},e?n?b(!0):M=u.run():a?a(b.bind(null,!0),!0):u.run(),v.pause=u.pause.bind(u),v.resume=u.resume.bind(u),v.stop=v,v}function _s(t,e=1/0,s){if(e<=0||!Je(t)||t.__v_skip||(s=s||new Map,(s.get(t)||0)>=e))return t;if(s.set(t,e),e--,vt(t))_s(t.value,e,s);else if(Se(t))for(let n=0;n<t.length;n++)_s(t[n],e,s);else if(gr(t)||Qs(t))t.forEach(n=>{_s(n,e,s)});else if(br(t)){for(const n in t)_s(t[n],e,s);for(const n of Object.getOwnPropertySymbols(t))Object.prototype.propertyIsEnumerable.call(t,n)&&_s(t[n],e,s)}return t}/**
* @vue/runtime-core v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function In(t,e,s,n){try{return n?t(...n):t()}catch(o){Mo(o,e,s)}}function Qt(t,e,s,n){if(Re(t)){const o=In(t,e,s,n);return o&&vr(o)&&o.catch(i=>{Mo(i,e,s)}),o}if(Se(t)){const o=[];for(let i=0;i<t.length;i++)o.push(Qt(t[i],e,s,n));return o}}function Mo(t,e,s,n=!0){const o=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:a}=e&&e.appContext.config||Ke;if(e){let r=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${s}`;for(;r;){const u=r.ec;if(u){for(let d=0;d<u.length;d++)if(u[d](t,l,c)===!1)return}r=r.parent}if(i){bs(),In(i,null,10,[t,l,c]),ws();return}}Ku(t,s,o,n,a)}function Ku(t,e,s,n=!0,o=!1){if(o)throw t;console.error(t)}const St=[];let ns=-1;const tn=[];let Cs=null,qs=0;const Fr=Promise.resolve();let io=null;function xn(t){const e=io||Fr;return t?e.then(this?t.bind(this):t):e}function Wu(t){let e=ns+1,s=St.length;for(;e<s;){const n=e+s>>>1,o=St[n],i=kn(o);i<t||i===t&&o.flags&2?e=n+1:s=n}return e}function Hi(t){if(!(t.flags&1)){const e=kn(t),s=St[St.length-1];!s||!(t.flags&2)&&e>=kn(s)?St.push(t):St.splice(Wu(e),0,t),t.flags|=1,Br()}}function Br(){io||(io=Fr.then(Vr))}function jr(t){Se(t)?tn.push(...t):Cs&&t.id===-1?Cs.splice(qs+1,0,t):t.flags&1||(tn.push(t),t.flags|=1),Br()}function ua(t,e,s=ns+1){for(;s<St.length;s++){const n=St[s];if(n&&n.flags&2){if(t&&n.id!==t.uid)continue;St.splice(s,1),s--,n.flags&4&&(n.flags&=-2),n(),n.flags&4||(n.flags&=-2)}}}function zr(t){if(tn.length){const e=[...new Set(tn)].sort((s,n)=>kn(s)-kn(n));if(tn.length=0,Cs){Cs.push(...e);return}for(Cs=e,qs=0;qs<Cs.length;qs++){const s=Cs[qs];s.flags&4&&(s.flags&=-2),s.flags&8||s(),s.flags&=-2}Cs=null,qs=0}}const kn=t=>t.id==null?t.flags&2?-1:1/0:t.id;function Vr(t){try{for(ns=0;ns<St.length;ns++){const e=St[ns];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),In(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;ns<St.length;ns++){const e=St[ns];e&&(e.flags&=-2)}ns=-1,St.length=0,zr(),io=null,(St.length||tn.length)&&Vr()}}let Bt=null,Kr=null;function ao(t){const e=Bt;return Bt=t,Kr=t&&t.type.__scopeId||null,e}function Wr(t,e=Bt,s){if(!e||t._n)return t;const n=(...o)=>{n._d&&co(-1);const i=ao(e);let a;try{a=t(...o)}finally{ao(i),n._d&&co(1)}return a};return n._n=!0,n._c=!0,n._d=!0,n}function qr(t,e){if(Bt===null)return t;const s=Ao(Bt),n=t.dirs||(t.dirs=[]);for(let o=0;o<e.length;o++){let[i,a,r,l=Ke]=e[o];i&&(Re(i)&&(i={mounted:i,updated:i}),i.deep&&_s(a),n.push({dir:i,instance:s,value:a,oldValue:void 0,arg:r,modifiers:l}))}return t}function Ds(t,e,s,n){const o=t.dirs,i=e&&e.dirs;for(let a=0;a<o.length;a++){const r=o[a];i&&(r.oldValue=i[a].value);let l=r.dir[n];l&&(bs(),Qt(l,s,8,[t.el,r,t,e]),ws())}}const Xr=Symbol("_vte"),Yr=t=>t.__isTeleport,yn=t=>t&&(t.disabled||t.disabled===""),da=t=>t&&(t.defer||t.defer===""),fa=t=>typeof SVGElement<"u"&&t instanceof SVGElement,pa=t=>typeof MathMLElement=="function"&&t instanceof MathMLElement,mi=(t,e)=>{const s=t&&t.to;return nt(s)?e?e(s):null:s},Jr={name:"Teleport",__isTeleport:!0,process(t,e,s,n,o,i,a,r,l,c){const{mc:u,pc:d,pbc:m,o:{insert:h,querySelector:_,createText:E,createComment:S}}=c,v=yn(e.props);let{shapeFlag:M,children:b,dynamicChildren:w}=e;if(t==null){const $=e.el=E(""),F=e.anchor=E("");h($,s,n),h(F,s,n);const B=(Q,q)=>{M&16&&u(b,Q,q,o,i,a,r,l)},ee=()=>{const Q=e.target=mi(e.props,_),q=Qr(Q,e,E,h);Q&&(a!=="svg"&&fa(Q)?a="svg":a!=="mathml"&&pa(Q)&&(a="mathml"),o&&o.isCE&&(o.ce._teleportTargets||(o.ce._teleportTargets=new Set)).add(Q),v||(B(Q,q),qn(e,!1)))};v&&(B(s,F),qn(e,!0)),da(e.props)?(e.el.__isMounted=!1,bt(()=>{ee(),delete e.el.__isMounted},i)):ee()}else{if(da(e.props)&&t.el.__isMounted===!1){bt(()=>{Jr.process(t,e,s,n,o,i,a,r,l,c)},i);return}e.el=t.el,e.targetStart=t.targetStart;const $=e.anchor=t.anchor,F=e.target=t.target,B=e.targetAnchor=t.targetAnchor,ee=yn(t.props),Q=ee?s:F,q=ee?$:B;if(a==="svg"||fa(F)?a="svg":(a==="mathml"||pa(F))&&(a="mathml"),w?(m(t.dynamicChildren,w,Q,o,i,a,r),ji(t,e,!0)):l||d(t,e,Q,q,o,i,a,r,!1),v)ee?e.props&&t.props&&e.props.to!==t.props.to&&(e.props.to=t.props.to):jn(e,s,$,c,1);else if((e.props&&e.props.to)!==(t.props&&t.props.to)){const P=e.target=mi(e.props,_);P&&jn(e,P,null,c,0)}else ee&&jn(e,F,B,c,1);qn(e,v)}},remove(t,e,s,{um:n,o:{remove:o}},i){const{shapeFlag:a,children:r,anchor:l,targetStart:c,targetAnchor:u,target:d,props:m}=t;if(d&&(o(c),o(u)),i&&o(l),a&16){const h=i||!yn(m);for(let _=0;_<r.length;_++){const E=r[_];n(E,e,s,h,!!E.dynamicChildren)}}},move:jn,hydrate:qu};function jn(t,e,s,{o:{insert:n},m:o},i=2){i===0&&n(t.targetAnchor,e,s);const{el:a,anchor:r,shapeFlag:l,children:c,props:u}=t,d=i===2;if(d&&n(a,e,s),(!d||yn(u))&&l&16)for(let m=0;m<c.length;m++)o(c[m],e,s,2);d&&n(r,e,s)}function qu(t,e,s,n,o,i,{o:{nextSibling:a,parentNode:r,querySelector:l,insert:c,createText:u}},d){function m(E,S,v,M){S.anchor=d(a(E),S,r(E),s,n,o,i),S.targetStart=v,S.targetAnchor=M}const h=e.target=mi(e.props,l),_=yn(e.props);if(h){const E=h._lpa||h.firstChild;if(e.shapeFlag&16)if(_)m(t,e,E,E&&a(E));else{e.anchor=a(t);let S=E;for(;S;){if(S&&S.nodeType===8){if(S.data==="teleport start anchor")e.targetStart=S;else if(S.data==="teleport anchor"){e.targetAnchor=S,h._lpa=e.targetAnchor&&a(e.targetAnchor);break}}S=a(S)}e.targetAnchor||Qr(h,e,u,c),d(E&&a(E),e,h,s,n,o,i)}qn(e,_)}else _&&e.shapeFlag&16&&m(t,e,t,a(t));return e.anchor&&a(e.anchor)}const Zr=Jr;function qn(t,e){const s=t.ctx;if(s&&s.ut){let n,o;for(e?(n=t.el,o=t.anchor):(n=t.targetStart,o=t.targetAnchor);n&&n!==o;)n.nodeType===1&&n.setAttribute("data-v-owner",s.uid),n=n.nextSibling;s.ut()}}function Qr(t,e,s,n){const o=e.targetStart=s(""),i=e.targetAnchor=s("");return o[Xr]=i,t&&(n(o,t),n(i,t)),i}const hs=Symbol("_leaveCb"),zn=Symbol("_enterCb");function Xu(){const t={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Et(()=>{t.isMounted=!0}),cs(()=>{t.isUnmounting=!0}),t}const Ht=[Function,Array],el={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Ht,onEnter:Ht,onAfterEnter:Ht,onEnterCancelled:Ht,onBeforeLeave:Ht,onLeave:Ht,onAfterLeave:Ht,onLeaveCancelled:Ht,onBeforeAppear:Ht,onAppear:Ht,onAfterAppear:Ht,onAppearCancelled:Ht},tl=t=>{const e=t.subTree;return e.component?tl(e.component):e},Yu={name:"BaseTransition",props:el,setup(t,{slots:e}){const s=Vi(),n=Xu();return()=>{const o=e.default&&ol(e.default(),!0);if(!o||!o.length)return;const i=sl(o),a=Fe(t),{mode:r}=a;if(n.isLeaving)return Ko(i);const l=ha(i);if(!l)return Ko(i);let c=_i(l,a,n,s,d=>c=d);l.type!==Tt&&An(l,c);let u=s.subTree&&ha(s.subTree);if(u&&u.type!==Tt&&!Bs(u,l)&&tl(s).type!==Tt){let d=_i(u,a,n,s);if(An(u,d),r==="out-in"&&l.type!==Tt)return n.isLeaving=!0,d.afterLeave=()=>{n.isLeaving=!1,s.job.flags&8||s.update(),delete d.afterLeave,u=void 0},Ko(i);r==="in-out"&&l.type!==Tt?d.delayLeave=(m,h,_)=>{const E=nl(n,u);E[String(u.key)]=u,m[hs]=()=>{h(),m[hs]=void 0,delete c.delayedLeave,u=void 0},c.delayedLeave=()=>{_(),delete c.delayedLeave,u=void 0}}:u=void 0}else u&&(u=void 0);return i}}};function sl(t){let e=t[0];if(t.length>1){for(const s of t)if(s.type!==Tt){e=s;break}}return e}const Ju=Yu;function nl(t,e){const{leavingVNodes:s}=t;let n=s.get(e.type);return n||(n=Object.create(null),s.set(e.type,n)),n}function _i(t,e,s,n,o){const{appear:i,mode:a,persisted:r=!1,onBeforeEnter:l,onEnter:c,onAfterEnter:u,onEnterCancelled:d,onBeforeLeave:m,onLeave:h,onAfterLeave:_,onLeaveCancelled:E,onBeforeAppear:S,onAppear:v,onAfterAppear:M,onAppearCancelled:b}=e,w=String(t.key),$=nl(s,t),F=(Q,q)=>{Q&&Qt(Q,n,9,q)},B=(Q,q)=>{const P=q[1];F(Q,q),Se(Q)?Q.every(L=>L.length<=1)&&P():Q.length<=1&&P()},ee={mode:a,persisted:r,beforeEnter(Q){let q=l;if(!s.isMounted)if(i)q=S||l;else return;Q[hs]&&Q[hs](!0);const P=$[w];P&&Bs(t,P)&&P.el[hs]&&P.el[hs](),F(q,[Q])},enter(Q){let q=c,P=u,L=d;if(!s.isMounted)if(i)q=v||c,P=M||u,L=b||d;else return;let fe=!1;const Te=Q[zn]=Ce=>{fe||(fe=!0,Ce?F(L,[Q]):F(P,[Q]),ee.delayedLeave&&ee.delayedLeave(),Q[zn]=void 0)};q?B(q,[Q,Te]):Te()},leave(Q,q){const P=String(t.key);if(Q[zn]&&Q[zn](!0),s.isUnmounting)return q();F(m,[Q]);let L=!1;const fe=Q[hs]=Te=>{L||(L=!0,q(),Te?F(E,[Q]):F(_,[Q]),Q[hs]=void 0,$[P]===t&&delete $[P])};$[P]=t,h?B(h,[Q,fe]):fe()},clone(Q){const q=_i(Q,e,s,n,o);return o&&o(q),q}};return ee}function Ko(t){if(Co(t))return t=$s(t),t.children=null,t}function ha(t){if(!Co(t))return Yr(t.type)&&t.children?sl(t.children):t;if(t.component)return t.component.subTree;const{shapeFlag:e,children:s}=t;if(s){if(e&16)return s[0];if(e&32&&Re(s.default))return s.default()}}function An(t,e){t.shapeFlag&6&&t.component?(t.transition=e,An(t.component.subTree,e)):t.shapeFlag&128?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}function ol(t,e=!1,s){let n=[],o=0;for(let i=0;i<t.length;i++){let a=t[i];const r=s==null?a.key:String(s)+String(a.key!=null?a.key:i);a.type===We?(a.patchFlag&128&&o++,n=n.concat(ol(a.children,e,r))):(e||a.type!==Tt)&&n.push(r!=null?$s(a,{key:r}):a)}if(o>1)for(let i=0;i<n.length;i++)n[i].patchFlag=-2;return n}function il(t){t.ids=[t.ids[0]+t.ids[2]+++"-",0,0]}const ro=new WeakMap;function bn(t,e,s,n,o=!1){if(Se(t)){t.forEach((_,E)=>bn(_,e&&(Se(e)?e[E]:e),s,n,o));return}if(wn(n)&&!o){n.shapeFlag&512&&n.type.__asyncResolved&&n.component.subTree.component&&bn(t,e,s,n.component.subTree);return}const i=n.shapeFlag&4?Ao(n.component):n.el,a=o?null:i,{i:r,r:l}=t,c=e&&e.r,u=r.refs===Ke?r.refs={}:r.refs,d=r.setupState,m=Fe(d),h=d===Ke?_r:_=>Be(m,_);if(c!=null&&c!==l){if(ma(e),nt(c))u[c]=null,h(c)&&(d[c]=null);else if(vt(c)){c.value=null;const _=e;_.k&&(u[_.k]=null)}}if(Re(l))In(l,r,12,[a,u]);else{const _=nt(l),E=vt(l);if(_||E){const S=()=>{if(t.f){const v=_?h(l)?d[l]:u[l]:l.value;if(o)Se(v)&&Ai(v,i);else if(Se(v))v.includes(i)||v.push(i);else if(_)u[l]=[i],h(l)&&(d[l]=u[l]);else{const M=[i];l.value=M,t.k&&(u[t.k]=M)}}else _?(u[l]=a,h(l)&&(d[l]=a)):E&&(l.value=a,t.k&&(u[t.k]=a))};if(a){const v=()=>{S(),ro.delete(t)};v.id=-1,ro.set(t,v),bt(v,s)}else ma(t),S()}}}function ma(t){const e=ro.get(t);e&&(e.flags|=8,ro.delete(t))}So().requestIdleCallback;So().cancelIdleCallback;const wn=t=>!!t.type.__asyncLoader,Co=t=>t.type.__isKeepAlive;function Zu(t,e){al(t,"a",e)}function Qu(t,e){al(t,"da",e)}function al(t,e,s=Mt){const n=t.__wdc||(t.__wdc=()=>{let o=s;for(;o;){if(o.isDeactivated)return;o=o.parent}return t()});if(Eo(e,n,s),s){let o=s.parent;for(;o&&o.parent;)Co(o.parent.vnode)&&ed(n,e,s,o),o=o.parent}}function ed(t,e,s,n){const o=Eo(e,t,n,!0);Ui(()=>{Ai(n[e],o)},s)}function Eo(t,e,s=Mt,n=!1){if(s){const o=s[t]||(s[t]=[]),i=e.__weh||(e.__weh=(...a)=>{bs();const r=On(s),l=Qt(e,s,t,a);return r(),ws(),l});return n?o.unshift(i):o.push(i),i}}const Ss=t=>(e,s=Mt)=>{(!$n||t==="sp")&&Eo(t,(...n)=>e(...n),s)},td=Ss("bm"),Et=Ss("m"),rl=Ss("bu"),sd=Ss("u"),cs=Ss("bum"),Ui=Ss("um"),nd=Ss("sp"),od=Ss("rtg"),id=Ss("rtc");function ad(t,e=Mt){Eo("ec",t,e)}const rd=Symbol.for("v-ndc");function Vt(t,e,s,n){let o;const i=s,a=Se(t);if(a||nt(t)){const r=a&&en(t);let l=!1,c=!1;r&&(l=!zt(t),c=Rs(t),t=To(t)),o=new Array(t.length);for(let u=0,d=t.length;u<d;u++)o[u]=e(l?c?no(pt(t[u])):pt(t[u]):t[u],u,void 0,i)}else if(typeof t=="number"){o=new Array(t);for(let r=0;r<t;r++)o[r]=e(r+1,r,void 0,i)}else if(Je(t))if(t[Symbol.iterator])o=Array.from(t,(r,l)=>e(r,l,void 0,i));else{const r=Object.keys(t);o=new Array(r.length);for(let l=0,c=r.length;l<c;l++){const u=r[l];o[l]=e(t[u],u,l,i)}}else o=[];return o}const gi=t=>t?El(t)?Ao(t):gi(t.parent):null,Sn=ht(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>gi(t.parent),$root:t=>gi(t.root),$host:t=>t.ce,$emit:t=>t.emit,$options:t=>cl(t),$forceUpdate:t=>t.f||(t.f=()=>{Hi(t.update)}),$nextTick:t=>t.n||(t.n=xn.bind(t.proxy)),$watch:t=>Ad.bind(t)}),Wo=(t,e)=>t!==Ke&&!t.__isScriptSetup&&Be(t,e),ld={get({_:t},e){if(e==="__v_skip")return!0;const{ctx:s,setupState:n,data:o,props:i,accessCache:a,type:r,appContext:l}=t;let c;if(e[0]!=="$"){const h=a[e];if(h!==void 0)switch(h){case 1:return n[e];case 2:return o[e];case 4:return s[e];case 3:return i[e]}else{if(Wo(n,e))return a[e]=1,n[e];if(o!==Ke&&Be(o,e))return a[e]=2,o[e];if((c=t.propsOptions[0])&&Be(c,e))return a[e]=3,i[e];if(s!==Ke&&Be(s,e))return a[e]=4,s[e];vi&&(a[e]=0)}}const u=Sn[e];let d,m;if(u)return e==="$attrs"&&gt(t.attrs,"get",""),u(t);if((d=r.__cssModules)&&(d=d[e]))return d;if(s!==Ke&&Be(s,e))return a[e]=4,s[e];if(m=l.config.globalProperties,Be(m,e))return m[e]},set({_:t},e,s){const{data:n,setupState:o,ctx:i}=t;return Wo(o,e)?(o[e]=s,!0):n!==Ke&&Be(n,e)?(n[e]=s,!0):Be(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(i[e]=s,!0)},has({_:{data:t,setupState:e,accessCache:s,ctx:n,appContext:o,propsOptions:i,type:a}},r){let l,c;return!!(s[r]||t!==Ke&&r[0]!=="$"&&Be(t,r)||Wo(e,r)||(l=i[0])&&Be(l,r)||Be(n,r)||Be(Sn,r)||Be(o.config.globalProperties,r)||(c=a.__cssModules)&&c[r])},defineProperty(t,e,s){return s.get!=null?t._.accessCache[e]=0:Be(s,"value")&&this.set(t,e,s.value,null),Reflect.defineProperty(t,e,s)}};function _a(t){return Se(t)?t.reduce((e,s)=>(e[s]=null,e),{}):t}let vi=!0;function cd(t){const e=cl(t),s=t.proxy,n=t.ctx;vi=!1,e.beforeCreate&&ga(e.beforeCreate,t,"bc");const{data:o,computed:i,methods:a,watch:r,provide:l,inject:c,created:u,beforeMount:d,mounted:m,beforeUpdate:h,updated:_,activated:E,deactivated:S,beforeDestroy:v,beforeUnmount:M,destroyed:b,unmounted:w,render:$,renderTracked:F,renderTriggered:B,errorCaptured:ee,serverPrefetch:Q,expose:q,inheritAttrs:P,components:L,directives:fe,filters:Te}=e;if(c&&ud(c,n,null),a)for(const X in a){const A=a[X];Re(A)&&(n[X]=A.bind(s))}if(o){const X=o.call(s,s);Je(X)&&(t.data=Di(X))}if(vi=!0,i)for(const X in i){const A=i[X],de=Re(A)?A.bind(s,s):Re(A.get)?A.get.bind(s,s):Jt,V=!Re(A)&&Re(A.set)?A.set.bind(s):Jt,O=Pe({get:de,set:V});Object.defineProperty(n,X,{enumerable:!0,configurable:!0,get:()=>O.value,set:Z=>O.value=Z})}if(r)for(const X in r)ll(r[X],n,s,X);if(l){const X=Re(l)?l.call(s):l;Reflect.ownKeys(X).forEach(A=>{_d(A,X[A])})}u&&ga(u,t,"c");function ve(X,A){Se(A)?A.forEach(de=>X(de.bind(s))):A&&X(A.bind(s))}if(ve(td,d),ve(Et,m),ve(rl,h),ve(sd,_),ve(Zu,E),ve(Qu,S),ve(ad,ee),ve(id,F),ve(od,B),ve(cs,M),ve(Ui,w),ve(nd,Q),Se(q))if(q.length){const X=t.exposed||(t.exposed={});q.forEach(A=>{Object.defineProperty(X,A,{get:()=>s[A],set:de=>s[A]=de,enumerable:!0})})}else t.exposed||(t.exposed={});$&&t.render===Jt&&(t.render=$),P!=null&&(t.inheritAttrs=P),L&&(t.components=L),fe&&(t.directives=fe),Q&&il(t)}function ud(t,e,s=Jt){Se(t)&&(t=yi(t));for(const n in t){const o=t[n];let i;Je(o)?"default"in o?i=Xn(o.from||n,o.default,!0):i=Xn(o.from||n):i=Xn(o),vt(i)?Object.defineProperty(e,n,{enumerable:!0,configurable:!0,get:()=>i.value,set:a=>i.value=a}):e[n]=i}}function ga(t,e,s){Qt(Se(t)?t.map(n=>n.bind(e.proxy)):t.bind(e.proxy),e,s)}function ll(t,e,s,n){let o=n.includes(".")?wl(s,n):()=>s[n];if(nt(t)){const i=e[t];Re(i)&&It(o,i)}else if(Re(t))It(o,t.bind(s));else if(Je(t))if(Se(t))t.forEach(i=>ll(i,e,s,n));else{const i=Re(t.handler)?t.handler.bind(s):e[t.handler];Re(i)&&It(o,i,t)}}function cl(t){const e=t.type,{mixins:s,extends:n}=e,{mixins:o,optionsCache:i,config:{optionMergeStrategies:a}}=t.appContext,r=i.get(e);let l;return r?l=r:!o.length&&!s&&!n?l=e:(l={},o.length&&o.forEach(c=>lo(l,c,a,!0)),lo(l,e,a)),Je(e)&&i.set(e,l),l}function lo(t,e,s,n=!1){const{mixins:o,extends:i}=e;i&&lo(t,i,s,!0),o&&o.forEach(a=>lo(t,a,s,!0));for(const a in e)if(!(n&&a==="expose")){const r=dd[a]||s&&s[a];t[a]=r?r(t[a],e[a]):e[a]}return t}const dd={data:va,props:ya,emits:ya,methods:pn,computed:pn,beforeCreate:yt,created:yt,beforeMount:yt,mounted:yt,beforeUpdate:yt,updated:yt,beforeDestroy:yt,beforeUnmount:yt,destroyed:yt,unmounted:yt,activated:yt,deactivated:yt,errorCaptured:yt,serverPrefetch:yt,components:pn,directives:pn,watch:pd,provide:va,inject:fd};function va(t,e){return e?t?function(){return ht(Re(t)?t.call(this,this):t,Re(e)?e.call(this,this):e)}:e:t}function fd(t,e){return pn(yi(t),yi(e))}function yi(t){if(Se(t)){const e={};for(let s=0;s<t.length;s++)e[t[s]]=t[s];return e}return t}function yt(t,e){return t?[...new Set([].concat(t,e))]:e}function pn(t,e){return t?ht(Object.create(null),t,e):e}function ya(t,e){return t?Se(t)&&Se(e)?[...new Set([...t,...e])]:ht(Object.create(null),_a(t),_a(e??{})):e}function pd(t,e){if(!t)return e;if(!e)return t;const s=ht(Object.create(null),t);for(const n in e)s[n]=yt(t[n],e[n]);return s}function ul(){return{app:null,config:{isNativeTag:_r,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let hd=0;function md(t,e){return function(n,o=null){Re(n)||(n=ht({},n)),o!=null&&!Je(o)&&(o=null);const i=ul(),a=new WeakSet,r=[];let l=!1;const c=i.app={_uid:hd++,_component:n,_props:o,_container:null,_context:i,_instance:null,version:Jd,get config(){return i.config},set config(u){},use(u,...d){return a.has(u)||(u&&Re(u.install)?(a.add(u),u.install(c,...d)):Re(u)&&(a.add(u),u(c,...d))),c},mixin(u){return i.mixins.includes(u)||i.mixins.push(u),c},component(u,d){return d?(i.components[u]=d,c):i.components[u]},directive(u,d){return d?(i.directives[u]=d,c):i.directives[u]},mount(u,d,m){if(!l){const h=c._ceVNode||tt(n,o);return h.appContext=i,m===!0?m="svg":m===!1&&(m=void 0),t(h,u,m),l=!0,c._container=u,u.__vue_app__=c,Ao(h.component)}},onUnmount(u){r.push(u)},unmount(){l&&(Qt(r,c._instance,16),t(null,c._container),delete c._container.__vue_app__)},provide(u,d){return i.provides[u]=d,c},runWithContext(u){const d=sn;sn=c;try{return u()}finally{sn=d}}};return c}}let sn=null;function _d(t,e){if(Mt){let s=Mt.provides;const n=Mt.parent&&Mt.parent.provides;n===s&&(s=Mt.provides=Object.create(n)),s[t]=e}}function Xn(t,e,s=!1){const n=Vi();if(n||sn){let o=sn?sn._context.provides:n?n.parent==null||n.ce?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides:void 0;if(o&&t in o)return o[t];if(arguments.length>1)return s&&Re(e)?e.call(n&&n.proxy):e}}const dl={},fl=()=>Object.create(dl),pl=t=>Object.getPrototypeOf(t)===dl;function gd(t,e,s,n=!1){const o={},i=fl();t.propsDefaults=Object.create(null),hl(t,e,o,i);for(const a in t.propsOptions[0])a in o||(o[a]=void 0);s?t.props=n?o:Nu(o):t.type.props?t.props=o:t.props=i,t.attrs=i}function vd(t,e,s,n){const{props:o,attrs:i,vnode:{patchFlag:a}}=t,r=Fe(o),[l]=t.propsOptions;let c=!1;if((n||a>0)&&!(a&16)){if(a&8){const u=t.vnode.dynamicProps;for(let d=0;d<u.length;d++){let m=u[d];if(xo(t.emitsOptions,m))continue;const h=e[m];if(l)if(Be(i,m))h!==i[m]&&(i[m]=h,c=!0);else{const _=As(m);o[_]=bi(l,r,_,h,t,!1)}else h!==i[m]&&(i[m]=h,c=!0)}}}else{hl(t,e,o,i)&&(c=!0);let u;for(const d in r)(!e||!Be(e,d)&&((u=Ks(d))===d||!Be(e,u)))&&(l?s&&(s[d]!==void 0||s[u]!==void 0)&&(o[d]=bi(l,r,d,void 0,t,!0)):delete o[d]);if(i!==r)for(const d in i)(!e||!Be(e,d))&&(delete i[d],c=!0)}c&&ms(t.attrs,"set","")}function hl(t,e,s,n){const[o,i]=t.propsOptions;let a=!1,r;if(e)for(let l in e){if(_n(l))continue;const c=e[l];let u;o&&Be(o,u=As(l))?!i||!i.includes(u)?s[u]=c:(r||(r={}))[u]=c:xo(t.emitsOptions,l)||(!(l in n)||c!==n[l])&&(n[l]=c,a=!0)}if(i){const l=Fe(s),c=r||Ke;for(let u=0;u<i.length;u++){const d=i[u];s[d]=bi(o,l,d,c[d],t,!Be(c,d))}}return a}function bi(t,e,s,n,o,i){const a=t[s];if(a!=null){const r=Be(a,"default");if(r&&n===void 0){const l=a.default;if(a.type!==Function&&!a.skipFactory&&Re(l)){const{propsDefaults:c}=o;if(s in c)n=c[s];else{const u=On(o);n=c[s]=l.call(null,e),u()}}else n=l;o.ce&&o.ce._setProp(s,n)}a[0]&&(i&&!r?n=!1:a[1]&&(n===""||n===Ks(s))&&(n=!0))}return n}const yd=new WeakMap;function ml(t,e,s=!1){const n=s?yd:e.propsCache,o=n.get(t);if(o)return o;const i=t.props,a={},r=[];let l=!1;if(!Re(t)){const u=d=>{l=!0;const[m,h]=ml(d,e,!0);ht(a,m),h&&r.push(...h)};!s&&e.mixins.length&&e.mixins.forEach(u),t.extends&&u(t.extends),t.mixins&&t.mixins.forEach(u)}if(!i&&!l)return Je(t)&&n.set(t,Zs),Zs;if(Se(i))for(let u=0;u<i.length;u++){const d=As(i[u]);ba(d)&&(a[d]=Ke)}else if(i)for(const u in i){const d=As(u);if(ba(d)){const m=i[u],h=a[d]=Se(m)||Re(m)?{type:m}:ht({},m),_=h.type;let E=!1,S=!0;if(Se(_))for(let v=0;v<_.length;++v){const M=_[v],b=Re(M)&&M.name;if(b==="Boolean"){E=!0;break}else b==="String"&&(S=!1)}else E=Re(_)&&_.name==="Boolean";h[0]=E,h[1]=S,(E||Be(h,"default"))&&r.push(d)}}const c=[a,r];return Je(t)&&n.set(t,c),c}function ba(t){return t[0]!=="$"&&!_n(t)}const Fi=t=>t==="_"||t==="_ctx"||t==="$stable",Bi=t=>Se(t)?t.map(is):[is(t)],bd=(t,e,s)=>{if(e._n)return e;const n=Wr((...o)=>Bi(e(...o)),s);return n._c=!1,n},_l=(t,e,s)=>{const n=t._ctx;for(const o in t){if(Fi(o))continue;const i=t[o];if(Re(i))e[o]=bd(o,i,n);else if(i!=null){const a=Bi(i);e[o]=()=>a}}},gl=(t,e)=>{const s=Bi(e);t.slots.default=()=>s},vl=(t,e,s)=>{for(const n in e)(s||!Fi(n))&&(t[n]=e[n])},wd=(t,e,s)=>{const n=t.slots=fl();if(t.vnode.shapeFlag&32){const o=e._;o?(vl(n,e,s),s&&Sr(n,"_",o,!0)):_l(e,n)}else e&&gl(t,e)},Sd=(t,e,s)=>{const{vnode:n,slots:o}=t;let i=!0,a=Ke;if(n.shapeFlag&32){const r=e._;r?s&&r===1?i=!1:vl(o,e,s):(i=!e.$stable,_l(e,o)),a=e}else e&&(gl(t,e),a={default:1});if(i)for(const r in o)!Fi(r)&&a[r]==null&&delete o[r]},bt=Nd;function Td(t){return Md(t)}function Md(t,e){const s=So();s.__VUE__=!0;const{insert:n,remove:o,patchProp:i,createElement:a,createText:r,createComment:l,setText:c,setElementText:u,parentNode:d,nextSibling:m,setScopeId:h=Jt,insertStaticContent:_}=t,E=(g,T,R,j=null,H=null,N=null,K=void 0,oe=null,Y=!!T.dynamicChildren)=>{if(g===T)return;g&&!Bs(g,T)&&(j=De(g),Z(g,H,N,!0),g=null),T.patchFlag===-2&&(Y=!1,T.dynamicChildren=null);const{type:z,ref:_e,shapeFlag:le}=T;switch(z){case ko:S(g,T,R,j);break;case Tt:v(g,T,R,j);break;case Tn:g==null&&M(T,R,j,K);break;case We:L(g,T,R,j,H,N,K,oe,Y);break;default:le&1?$(g,T,R,j,H,N,K,oe,Y):le&6?fe(g,T,R,j,H,N,K,oe,Y):(le&64||le&128)&&z.process(g,T,R,j,H,N,K,oe,Y,st)}_e!=null&&H?bn(_e,g&&g.ref,N,T||g,!T):_e==null&&g&&g.ref!=null&&bn(g.ref,null,N,g,!0)},S=(g,T,R,j)=>{if(g==null)n(T.el=r(T.children),R,j);else{const H=T.el=g.el;T.children!==g.children&&c(H,T.children)}},v=(g,T,R,j)=>{g==null?n(T.el=l(T.children||""),R,j):T.el=g.el},M=(g,T,R,j)=>{[g.el,g.anchor]=_(g.children,T,R,j,g.el,g.anchor)},b=({el:g,anchor:T},R,j)=>{let H;for(;g&&g!==T;)H=m(g),n(g,R,j),g=H;n(T,R,j)},w=({el:g,anchor:T})=>{let R;for(;g&&g!==T;)R=m(g),o(g),g=R;o(T)},$=(g,T,R,j,H,N,K,oe,Y)=>{T.type==="svg"?K="svg":T.type==="math"&&(K="mathml"),g==null?F(T,R,j,H,N,K,oe,Y):Q(g,T,H,N,K,oe,Y)},F=(g,T,R,j,H,N,K,oe)=>{let Y,z;const{props:_e,shapeFlag:le,transition:pe,dirs:ce}=g;if(Y=g.el=a(g.type,N,_e&&_e.is,_e),le&8?u(Y,g.children):le&16&&ee(g.children,Y,null,j,H,qo(g,N),K,oe),ce&&Ds(g,null,j,"created"),B(Y,g,g.scopeId,K,j),_e){for(const ie in _e)ie!=="value"&&!_n(ie)&&i(Y,ie,null,_e[ie],N,j);"value"in _e&&i(Y,"value",null,_e.value,N),(z=_e.onVnodeBeforeMount)&&ts(z,j,g)}ce&&Ds(g,null,j,"beforeMount");const ge=Cd(H,pe);ge&&pe.beforeEnter(Y),n(Y,T,R),((z=_e&&_e.onVnodeMounted)||ge||ce)&&bt(()=>{z&&ts(z,j,g),ge&&pe.enter(Y),ce&&Ds(g,null,j,"mounted")},H)},B=(g,T,R,j,H)=>{if(R&&h(g,R),j)for(let N=0;N<j.length;N++)h(g,j[N]);if(H){let N=H.subTree;if(T===N||Tl(N.type)&&(N.ssContent===T||N.ssFallback===T)){const K=H.vnode;B(g,K,K.scopeId,K.slotScopeIds,H.parent)}}},ee=(g,T,R,j,H,N,K,oe,Y=0)=>{for(let z=Y;z<g.length;z++){const _e=g[z]=oe?Es(g[z]):is(g[z]);E(null,_e,T,R,j,H,N,K,oe)}},Q=(g,T,R,j,H,N,K)=>{const oe=T.el=g.el;let{patchFlag:Y,dynamicChildren:z,dirs:_e}=T;Y|=g.patchFlag&16;const le=g.props||Ke,pe=T.props||Ke;let ce;if(R&&Ns(R,!1),(ce=pe.onVnodeBeforeUpdate)&&ts(ce,R,T,g),_e&&Ds(T,g,R,"beforeUpdate"),R&&Ns(R,!0),(le.innerHTML&&pe.innerHTML==null||le.textContent&&pe.textContent==null)&&u(oe,""),z?q(g.dynamicChildren,z,oe,R,j,qo(T,H),N):K||A(g,T,oe,null,R,j,qo(T,H),N,!1),Y>0){if(Y&16)P(oe,le,pe,R,H);else if(Y&2&&le.class!==pe.class&&i(oe,"class",null,pe.class,H),Y&4&&i(oe,"style",le.style,pe.style,H),Y&8){const ge=T.dynamicProps;for(let ie=0;ie<ge.length;ie++){const Me=ge[ie],qe=le[Me],Qe=pe[Me];(Qe!==qe||Me==="value")&&i(oe,Me,qe,Qe,H,R)}}Y&1&&g.children!==T.children&&u(oe,T.children)}else!K&&z==null&&P(oe,le,pe,R,H);((ce=pe.onVnodeUpdated)||_e)&&bt(()=>{ce&&ts(ce,R,T,g),_e&&Ds(T,g,R,"updated")},j)},q=(g,T,R,j,H,N,K)=>{for(let oe=0;oe<T.length;oe++){const Y=g[oe],z=T[oe],_e=Y.el&&(Y.type===We||!Bs(Y,z)||Y.shapeFlag&198)?d(Y.el):R;E(Y,z,_e,null,j,H,N,K,!0)}},P=(g,T,R,j,H)=>{if(T!==R){if(T!==Ke)for(const N in T)!_n(N)&&!(N in R)&&i(g,N,T[N],null,H,j);for(const N in R){if(_n(N))continue;const K=R[N],oe=T[N];K!==oe&&N!=="value"&&i(g,N,oe,K,H,j)}"value"in R&&i(g,"value",T.value,R.value,H)}},L=(g,T,R,j,H,N,K,oe,Y)=>{const z=T.el=g?g.el:r(""),_e=T.anchor=g?g.anchor:r("");let{patchFlag:le,dynamicChildren:pe,slotScopeIds:ce}=T;ce&&(oe=oe?oe.concat(ce):ce),g==null?(n(z,R,j),n(_e,R,j),ee(T.children||[],R,_e,H,N,K,oe,Y)):le>0&&le&64&&pe&&g.dynamicChildren?(q(g.dynamicChildren,pe,R,H,N,K,oe),(T.key!=null||H&&T===H.subTree)&&ji(g,T,!0)):A(g,T,R,_e,H,N,K,oe,Y)},fe=(g,T,R,j,H,N,K,oe,Y)=>{T.slotScopeIds=oe,g==null?T.shapeFlag&512?H.ctx.activate(T,R,j,K,Y):Te(T,R,j,H,N,K,Y):Ce(g,T,Y)},Te=(g,T,R,j,H,N,K)=>{const oe=g.component=zd(g,j,H);if(Co(g)&&(oe.ctx.renderer=st),Vd(oe,!1,K),oe.asyncDep){if(H&&H.registerDep(oe,ve,K),!g.el){const Y=oe.subTree=tt(Tt);v(null,Y,T,R),g.placeholder=Y.el}}else ve(oe,g,T,R,H,N,K)},Ce=(g,T,R)=>{const j=T.component=g.component;if(Od(g,T,R))if(j.asyncDep&&!j.asyncResolved){X(j,T,R);return}else j.next=T,j.update();else T.el=g.el,j.vnode=T},ve=(g,T,R,j,H,N,K)=>{const oe=()=>{if(g.isMounted){let{next:le,bu:pe,u:ce,parent:ge,vnode:ie}=g;{const ft=yl(g);if(ft){le&&(le.el=ie.el,X(g,le,K)),ft.asyncDep.then(()=>{g.isUnmounted||oe()});return}}let Me=le,qe;Ns(g,!1),le?(le.el=ie.el,X(g,le,K)):le=ie,pe&&Fo(pe),(qe=le.props&&le.props.onVnodeBeforeUpdate)&&ts(qe,ge,le,ie),Ns(g,!0);const Qe=Sa(g),dt=g.subTree;g.subTree=Qe,E(dt,Qe,d(dt.el),De(dt),g,H,N),le.el=Qe.el,Me===null&&Dd(g,Qe.el),ce&&bt(ce,H),(qe=le.props&&le.props.onVnodeUpdated)&&bt(()=>ts(qe,ge,le,ie),H)}else{let le;const{el:pe,props:ce}=T,{bm:ge,m:ie,parent:Me,root:qe,type:Qe}=g,dt=wn(T);Ns(g,!1),ge&&Fo(ge),!dt&&(le=ce&&ce.onVnodeBeforeMount)&&ts(le,Me,T),Ns(g,!0);{qe.ce&&qe.ce._def.shadowRoot!==!1&&qe.ce._injectChildStyle(Qe);const ft=g.subTree=Sa(g);E(null,ft,R,j,g,H,N),T.el=ft.el}if(ie&&bt(ie,H),!dt&&(le=ce&&ce.onVnodeMounted)){const ft=T;bt(()=>ts(le,Me,ft),H)}(T.shapeFlag&256||Me&&wn(Me.vnode)&&Me.vnode.shapeFlag&256)&&g.a&&bt(g.a,H),g.isMounted=!0,T=R=j=null}};g.scope.on();const Y=g.effect=new Er(oe);g.scope.off();const z=g.update=Y.run.bind(Y),_e=g.job=Y.runIfDirty.bind(Y);_e.i=g,_e.id=g.uid,Y.scheduler=()=>Hi(_e),Ns(g,!0),z()},X=(g,T,R)=>{T.component=g;const j=g.vnode.props;g.vnode=T,g.next=null,vd(g,T.props,j,R),Sd(g,T.children,R),bs(),ua(g),ws()},A=(g,T,R,j,H,N,K,oe,Y=!1)=>{const z=g&&g.children,_e=g?g.shapeFlag:0,le=T.children,{patchFlag:pe,shapeFlag:ce}=T;if(pe>0){if(pe&128){V(z,le,R,j,H,N,K,oe,Y);return}else if(pe&256){de(z,le,R,j,H,N,K,oe,Y);return}}ce&8?(_e&16&&Ue(z,H,N),le!==z&&u(R,le)):_e&16?ce&16?V(z,le,R,j,H,N,K,oe,Y):Ue(z,H,N,!0):(_e&8&&u(R,""),ce&16&&ee(le,R,j,H,N,K,oe,Y))},de=(g,T,R,j,H,N,K,oe,Y)=>{g=g||Zs,T=T||Zs;const z=g.length,_e=T.length,le=Math.min(z,_e);let pe;for(pe=0;pe<le;pe++){const ce=T[pe]=Y?Es(T[pe]):is(T[pe]);E(g[pe],ce,R,null,H,N,K,oe,Y)}z>_e?Ue(g,H,N,!0,!1,le):ee(T,R,j,H,N,K,oe,Y,le)},V=(g,T,R,j,H,N,K,oe,Y)=>{let z=0;const _e=T.length;let le=g.length-1,pe=_e-1;for(;z<=le&&z<=pe;){const ce=g[z],ge=T[z]=Y?Es(T[z]):is(T[z]);if(Bs(ce,ge))E(ce,ge,R,null,H,N,K,oe,Y);else break;z++}for(;z<=le&&z<=pe;){const ce=g[le],ge=T[pe]=Y?Es(T[pe]):is(T[pe]);if(Bs(ce,ge))E(ce,ge,R,null,H,N,K,oe,Y);else break;le--,pe--}if(z>le){if(z<=pe){const ce=pe+1,ge=ce<_e?T[ce].el:j;for(;z<=pe;)E(null,T[z]=Y?Es(T[z]):is(T[z]),R,ge,H,N,K,oe,Y),z++}}else if(z>pe)for(;z<=le;)Z(g[z],H,N,!0),z++;else{const ce=z,ge=z,ie=new Map;for(z=ge;z<=pe;z++){const it=T[z]=Y?Es(T[z]):is(T[z]);it.key!=null&&ie.set(it.key,z)}let Me,qe=0;const Qe=pe-ge+1;let dt=!1,ft=0;const Nt=new Array(Qe);for(z=0;z<Qe;z++)Nt[z]=0;for(z=ce;z<=le;z++){const it=g[z];if(qe>=Qe){Z(it,H,N,!0);continue}let Gt;if(it.key!=null)Gt=ie.get(it.key);else for(Me=ge;Me<=pe;Me++)if(Nt[Me-ge]===0&&Bs(it,T[Me])){Gt=Me;break}Gt===void 0?Z(it,H,N,!0):(Nt[Gt-ge]=z+1,Gt>=ft?ft=Gt:dt=!0,E(it,T[Gt],R,null,H,N,K,oe,Y),qe++)}const es=dt?Ed(Nt):Zs;for(Me=es.length-1,z=Qe-1;z>=0;z--){const it=ge+z,Gt=T[it],Dn=T[it+1],Nn=it+1<_e?Dn.el||Dn.placeholder:j;Nt[z]===0?E(null,Gt,R,Nn,H,N,K,oe,Y):dt&&(Me<0||z!==es[Me]?O(Gt,R,Nn,2):Me--)}}},O=(g,T,R,j,H=null)=>{const{el:N,type:K,transition:oe,children:Y,shapeFlag:z}=g;if(z&6){O(g.component.subTree,T,R,j);return}if(z&128){g.suspense.move(T,R,j);return}if(z&64){K.move(g,T,R,st);return}if(K===We){n(N,T,R);for(let le=0;le<Y.length;le++)O(Y[le],T,R,j);n(g.anchor,T,R);return}if(K===Tn){b(g,T,R);return}if(j!==2&&z&1&&oe)if(j===0)oe.beforeEnter(N),n(N,T,R),bt(()=>oe.enter(N),H);else{const{leave:le,delayLeave:pe,afterLeave:ce}=oe,ge=()=>{g.ctx.isUnmounted?o(N):n(N,T,R)},ie=()=>{N._isLeaving&&N[hs](!0),le(N,()=>{ge(),ce&&ce()})};pe?pe(N,ge,ie):ie()}else n(N,T,R)},Z=(g,T,R,j=!1,H=!1)=>{const{type:N,props:K,ref:oe,children:Y,dynamicChildren:z,shapeFlag:_e,patchFlag:le,dirs:pe,cacheIndex:ce}=g;if(le===-2&&(H=!1),oe!=null&&(bs(),bn(oe,null,R,g,!0),ws()),ce!=null&&(T.renderCache[ce]=void 0),_e&256){T.ctx.deactivate(g);return}const ge=_e&1&&pe,ie=!wn(g);let Me;if(ie&&(Me=K&&K.onVnodeBeforeUnmount)&&ts(Me,T,g),_e&6)Ge(g.component,R,j);else{if(_e&128){g.suspense.unmount(R,j);return}ge&&Ds(g,null,T,"beforeUnmount"),_e&64?g.type.remove(g,T,R,st,j):z&&!z.hasOnce&&(N!==We||le>0&&le&64)?Ue(z,T,R,!1,!0):(N===We&&le&384||!H&&_e&16)&&Ue(Y,T,R),j&&re(g)}(ie&&(Me=K&&K.onVnodeUnmounted)||ge)&&bt(()=>{Me&&ts(Me,T,g),ge&&Ds(g,null,T,"unmounted")},R)},re=g=>{const{type:T,el:R,anchor:j,transition:H}=g;if(T===We){Ee(R,j);return}if(T===Tn){w(g);return}const N=()=>{o(R),H&&!H.persisted&&H.afterLeave&&H.afterLeave()};if(g.shapeFlag&1&&H&&!H.persisted){const{leave:K,delayLeave:oe}=H,Y=()=>K(R,N);oe?oe(g.el,N,Y):Y()}else N()},Ee=(g,T)=>{let R;for(;g!==T;)R=m(g),o(g),g=R;o(T)},Ge=(g,T,R)=>{const{bum:j,scope:H,job:N,subTree:K,um:oe,m:Y,a:z}=g;wa(Y),wa(z),j&&Fo(j),H.stop(),N&&(N.flags|=8,Z(K,g,T,R)),oe&&bt(oe,T),bt(()=>{g.isUnmounted=!0},T)},Ue=(g,T,R,j=!1,H=!1,N=0)=>{for(let K=N;K<g.length;K++)Z(g[K],T,R,j,H)},De=g=>{if(g.shapeFlag&6)return De(g.component.subTree);if(g.shapeFlag&128)return g.suspense.next();const T=m(g.anchor||g.el),R=T&&T[Xr];return R?m(R):T};let Ze=!1;const ot=(g,T,R)=>{g==null?T._vnode&&Z(T._vnode,null,null,!0):E(T._vnode||null,g,T,null,null,null,R),T._vnode=g,Ze||(Ze=!0,ua(),zr(),Ze=!1)},st={p:E,um:Z,m:O,r:re,mt:Te,mc:ee,pc:A,pbc:q,n:De,o:t};return{render:ot,hydrate:void 0,createApp:md(ot)}}function qo({type:t,props:e},s){return s==="svg"&&t==="foreignObject"||s==="mathml"&&t==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:s}function Ns({effect:t,job:e},s){s?(t.flags|=32,e.flags|=4):(t.flags&=-33,e.flags&=-5)}function Cd(t,e){return(!t||t&&!t.pendingBranch)&&e&&!e.persisted}function ji(t,e,s=!1){const n=t.children,o=e.children;if(Se(n)&&Se(o))for(let i=0;i<n.length;i++){const a=n[i];let r=o[i];r.shapeFlag&1&&!r.dynamicChildren&&((r.patchFlag<=0||r.patchFlag===32)&&(r=o[i]=Es(o[i]),r.el=a.el),!s&&r.patchFlag!==-2&&ji(a,r)),r.type===ko&&r.patchFlag!==-1&&(r.el=a.el),r.type===Tt&&!r.el&&(r.el=a.el)}}function Ed(t){const e=t.slice(),s=[0];let n,o,i,a,r;const l=t.length;for(n=0;n<l;n++){const c=t[n];if(c!==0){if(o=s[s.length-1],t[o]<c){e[n]=o,s.push(n);continue}for(i=0,a=s.length-1;i<a;)r=i+a>>1,t[s[r]]<c?i=r+1:a=r;c<t[s[i]]&&(i>0&&(e[n]=s[i-1]),s[i]=n)}}for(i=s.length,a=s[i-1];i-- >0;)s[i]=a,a=e[a];return s}function yl(t){const e=t.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:yl(e)}function wa(t){if(t)for(let e=0;e<t.length;e++)t[e].flags|=8}const xd=Symbol.for("v-scx"),kd=()=>Xn(xd);function It(t,e,s){return bl(t,e,s)}function bl(t,e,s=Ke){const{immediate:n,deep:o,flush:i,once:a}=s,r=ht({},s),l=e&&n||!e&&i!=="post";let c;if($n){if(i==="sync"){const h=kd();c=h.__watcherHandles||(h.__watcherHandles=[])}else if(!l){const h=()=>{};return h.stop=Jt,h.resume=Jt,h.pause=Jt,h}}const u=Mt;r.call=(h,_,E)=>Qt(h,u,_,E);let d=!1;i==="post"?r.scheduler=h=>{bt(h,u&&u.suspense)}:i!=="sync"&&(d=!0,r.scheduler=(h,_)=>{_?h():Hi(h)}),r.augmentJob=h=>{e&&(h.flags|=4),d&&(h.flags|=2,u&&(h.id=u.uid,h.i=u))};const m=Vu(t,e,r);return $n&&(c?c.push(m):l&&m()),m}function Ad(t,e,s){const n=this.proxy,o=nt(t)?t.includes(".")?wl(n,t):()=>n[t]:t.bind(n,n);let i;Re(e)?i=e:(i=e.handler,s=e);const a=On(this),r=bl(o,i.bind(n),s);return a(),r}function wl(t,e){const s=e.split(".");return()=>{let n=t;for(let o=0;o<s.length&&n;o++)n=n[s[o]];return n}}const Rd=(t,e)=>e==="modelValue"||e==="model-value"?t.modelModifiers:t[`${e}Modifiers`]||t[`${As(e)}Modifiers`]||t[`${Ks(e)}Modifiers`];function $d(t,e,...s){if(t.isUnmounted)return;const n=t.vnode.props||Ke;let o=s;const i=e.startsWith("update:"),a=i&&Rd(n,e.slice(7));a&&(a.trim&&(o=s.map(u=>nt(u)?u.trim():u)),a.number&&(o=s.map(lu)));let r,l=n[r=Uo(e)]||n[r=Uo(As(e))];!l&&i&&(l=n[r=Uo(Ks(e))]),l&&Qt(l,t,6,o);const c=n[r+"Once"];if(c){if(!t.emitted)t.emitted={};else if(t.emitted[r])return;t.emitted[r]=!0,Qt(c,t,6,o)}}const Pd=new WeakMap;function Sl(t,e,s=!1){const n=s?Pd:e.emitsCache,o=n.get(t);if(o!==void 0)return o;const i=t.emits;let a={},r=!1;if(!Re(t)){const l=c=>{const u=Sl(c,e,!0);u&&(r=!0,ht(a,u))};!s&&e.mixins.length&&e.mixins.forEach(l),t.extends&&l(t.extends),t.mixins&&t.mixins.forEach(l)}return!i&&!r?(Je(t)&&n.set(t,null),null):(Se(i)?i.forEach(l=>a[l]=null):ht(a,i),Je(t)&&n.set(t,a),a)}function xo(t,e){return!t||!yo(e)?!1:(e=e.slice(2).replace(/Once$/,""),Be(t,e[0].toLowerCase()+e.slice(1))||Be(t,Ks(e))||Be(t,e))}function Sa(t){const{type:e,vnode:s,proxy:n,withProxy:o,propsOptions:[i],slots:a,attrs:r,emit:l,render:c,renderCache:u,props:d,data:m,setupState:h,ctx:_,inheritAttrs:E}=t,S=ao(t);let v,M;try{if(s.shapeFlag&4){const w=o||n,$=w;v=is(c.call($,w,u,d,h,m,_)),M=r}else{const w=e;v=is(w.length>1?w(d,{attrs:r,slots:a,emit:l}):w(d,null)),M=e.props?r:Ld(r)}}catch(w){Mn.length=0,Mo(w,t,1),v=tt(Tt)}let b=v;if(M&&E!==!1){const w=Object.keys(M),{shapeFlag:$}=b;w.length&&$&7&&(i&&w.some(ki)&&(M=Id(M,i)),b=$s(b,M,!1,!0))}return s.dirs&&(b=$s(b,null,!1,!0),b.dirs=b.dirs?b.dirs.concat(s.dirs):s.dirs),s.transition&&An(b,s.transition),v=b,ao(S),v}const Ld=t=>{let e;for(const s in t)(s==="class"||s==="style"||yo(s))&&((e||(e={}))[s]=t[s]);return e},Id=(t,e)=>{const s={};for(const n in t)(!ki(n)||!(n.slice(9)in e))&&(s[n]=t[n]);return s};function Od(t,e,s){const{props:n,children:o,component:i}=t,{props:a,children:r,patchFlag:l}=e,c=i.emitsOptions;if(e.dirs||e.transition)return!0;if(s&&l>=0){if(l&1024)return!0;if(l&16)return n?Ta(n,a,c):!!a;if(l&8){const u=e.dynamicProps;for(let d=0;d<u.length;d++){const m=u[d];if(a[m]!==n[m]&&!xo(c,m))return!0}}}else return(o||r)&&(!r||!r.$stable)?!0:n===a?!1:n?a?Ta(n,a,c):!0:!!a;return!1}function Ta(t,e,s){const n=Object.keys(e);if(n.length!==Object.keys(t).length)return!0;for(let o=0;o<n.length;o++){const i=n[o];if(e[i]!==t[i]&&!xo(s,i))return!0}return!1}function Dd({vnode:t,parent:e},s){for(;e;){const n=e.subTree;if(n.suspense&&n.suspense.activeBranch===t&&(n.el=t.el),n===t)(t=e.vnode).el=s,e=e.parent;else break}}const Tl=t=>t.__isSuspense;function Nd(t,e){e&&e.pendingBranch?Se(t)?e.effects.push(...t):e.effects.push(t):jr(t)}const We=Symbol.for("v-fgt"),ko=Symbol.for("v-txt"),Tt=Symbol.for("v-cmt"),Tn=Symbol.for("v-stc"),Mn=[];let Dt=null;function I(t=!1){Mn.push(Dt=t?null:[])}function Gd(){Mn.pop(),Dt=Mn[Mn.length-1]||null}let Rn=1;function co(t,e=!1){Rn+=t,t<0&&Dt&&e&&(Dt.hasOnce=!0)}function Ml(t){return t.dynamicChildren=Rn>0?Dt||Zs:null,Gd(),Rn>0&&Dt&&Dt.push(t),t}function U(t,e,s,n,o,i){return Ml(p(t,e,s,n,o,i,!0))}function Lt(t,e,s,n,o){return Ml(tt(t,e,s,n,o,!0))}function uo(t){return t?t.__v_isVNode===!0:!1}function Bs(t,e){return t.type===e.type&&t.key===e.key}const Cl=({key:t})=>t??null,Yn=({ref:t,ref_key:e,ref_for:s})=>(typeof t=="number"&&(t=""+t),t!=null?nt(t)||vt(t)||Re(t)?{i:Bt,r:t,k:e,f:!!s}:t:null);function p(t,e=null,s=null,n=0,o=null,i=t===We?0:1,a=!1,r=!1){const l={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&Cl(e),ref:e&&Yn(e),scopeId:Kr,slotScopeIds:null,children:s,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:n,dynamicProps:o,dynamicChildren:null,appContext:null,ctx:Bt};return r?(zi(l,s),i&128&&t.normalize(l)):s&&(l.shapeFlag|=nt(s)?8:16),Rn>0&&!a&&Dt&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&Dt.push(l),l}const tt=Hd;function Hd(t,e=null,s=null,n=0,o=null,i=!1){if((!t||t===rd)&&(t=Tt),uo(t)){const r=$s(t,e,!0);return s&&zi(r,s),Rn>0&&!i&&Dt&&(r.shapeFlag&6?Dt[Dt.indexOf(t)]=r:Dt.push(r)),r.patchFlag=-2,r}if(Xd(t)&&(t=t.__vccOpts),e){e=Ud(e);let{class:r,style:l}=e;r&&!nt(r)&&(e.class=Ye(r)),Je(l)&&(Gi(l)&&!Se(l)&&(l=ht({},l)),e.style=Ft(l))}const a=nt(t)?1:Tl(t)?128:Yr(t)?64:Je(t)?4:Re(t)?2:0;return p(t,e,s,n,o,a,i,!0)}function Ud(t){return t?Gi(t)||pl(t)?ht({},t):t:null}function $s(t,e,s=!1,n=!1){const{props:o,ref:i,patchFlag:a,children:r,transition:l}=t,c=e?Fd(o||{},e):o,u={__v_isVNode:!0,__v_skip:!0,type:t.type,props:c,key:c&&Cl(c),ref:e&&e.ref?s&&i?Se(i)?i.concat(Yn(e)):[i,Yn(e)]:Yn(e):i,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:r,target:t.target,targetStart:t.targetStart,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==We?a===-1?16:a|16:a,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:l,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&$s(t.ssContent),ssFallback:t.ssFallback&&$s(t.ssFallback),placeholder:t.placeholder,el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce};return l&&n&&An(u,l.clone(u)),u}function Ps(t=" ",e=0){return tt(ko,null,t,e)}function fo(t,e){const s=tt(Tn,null,t);return s.staticCount=e,s}function ye(t="",e=!1){return e?(I(),Lt(Tt,null,t)):tt(Tt,null,t)}function is(t){return t==null||typeof t=="boolean"?tt(Tt):Se(t)?tt(We,null,t.slice()):uo(t)?Es(t):tt(ko,null,String(t))}function Es(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:$s(t)}function zi(t,e){let s=0;const{shapeFlag:n}=t;if(e==null)e=null;else if(Se(e))s=16;else if(typeof e=="object")if(n&65){const o=e.default;o&&(o._c&&(o._d=!1),zi(t,o()),o._c&&(o._d=!0));return}else{s=32;const o=e._;!o&&!pl(e)?e._ctx=Bt:o===3&&Bt&&(Bt.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else Re(e)?(e={default:e,_ctx:Bt},s=32):(e=String(e),n&64?(s=16,e=[Ps(e)]):s=8);t.children=e,t.shapeFlag|=s}function Fd(...t){const e={};for(let s=0;s<t.length;s++){const n=t[s];for(const o in n)if(o==="class")e.class!==n.class&&(e.class=Ye([e.class,n.class]));else if(o==="style")e.style=Ft([e.style,n.style]);else if(yo(o)){const i=e[o],a=n[o];a&&i!==a&&!(Se(i)&&i.includes(a))&&(e[o]=i?[].concat(i,a):a)}else o!==""&&(e[o]=n[o])}return e}function ts(t,e,s,n=null){Qt(t,e,7,[s,n])}const Bd=ul();let jd=0;function zd(t,e,s){const n=t.type,o=(e?e.appContext:t.appContext)||Bd,i={uid:jd++,vnode:t,type:n,parent:e,appContext:o,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new gu(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(o.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:ml(n,o),emitsOptions:Sl(n,o),emit:null,emitted:null,propsDefaults:Ke,inheritAttrs:n.inheritAttrs,ctx:Ke,data:Ke,props:Ke,attrs:Ke,slots:Ke,refs:Ke,setupState:Ke,setupContext:null,suspense:s,suspenseId:s?s.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=$d.bind(null,i),t.ce&&t.ce(i),i}let Mt=null;const Vi=()=>Mt||Bt;let po,wi;{const t=So(),e=(s,n)=>{let o;return(o=t[s])||(o=t[s]=[]),o.push(n),i=>{o.length>1?o.forEach(a=>a(i)):o[0](i)}};po=e("__VUE_INSTANCE_SETTERS__",s=>Mt=s),wi=e("__VUE_SSR_SETTERS__",s=>$n=s)}const On=t=>{const e=Mt;return po(t),t.scope.on(),()=>{t.scope.off(),po(e)}},Ma=()=>{Mt&&Mt.scope.off(),po(null)};function El(t){return t.vnode.shapeFlag&4}let $n=!1;function Vd(t,e=!1,s=!1){e&&wi(e);const{props:n,children:o}=t.vnode,i=El(t);gd(t,n,i,e),wd(t,o,s||e);const a=i?Kd(t,e):void 0;return e&&wi(!1),a}function Kd(t,e){const s=t.type;t.accessCache=Object.create(null),t.proxy=new Proxy(t.ctx,ld);const{setup:n}=s;if(n){bs();const o=t.setupContext=n.length>1?qd(t):null,i=On(t),a=In(n,t,0,[t.props,o]),r=vr(a);if(ws(),i(),(r||t.sp)&&!wn(t)&&il(t),r){if(a.then(Ma,Ma),e)return a.then(l=>{Ca(t,l)}).catch(l=>{Mo(l,t,0)});t.asyncDep=a}else Ca(t,a)}else xl(t)}function Ca(t,e,s){Re(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:Je(e)&&(t.setupState=Ur(e)),xl(t)}function xl(t,e,s){const n=t.type;t.render||(t.render=n.render||Jt);{const o=On(t);bs();try{cd(t)}finally{ws(),o()}}}const Wd={get(t,e){return gt(t,"get",""),t[e]}};function qd(t){const e=s=>{t.exposed=s||{}};return{attrs:new Proxy(t.attrs,Wd),slots:t.slots,emit:t.emit,expose:e}}function Ao(t){return t.exposed?t.exposeProxy||(t.exposeProxy=new Proxy(Ur(Gu(t.exposed)),{get(e,s){if(s in e)return e[s];if(s in Sn)return Sn[s](t)},has(e,s){return s in e||s in Sn}})):t.proxy}function Xd(t){return Re(t)&&"__vccOpts"in t}const Pe=(t,e)=>ju(t,e,$n);function Yd(t,e,s){try{co(-1);const n=arguments.length;return n===2?Je(e)&&!Se(e)?uo(e)?tt(t,null,[e]):tt(t,e):tt(t,null,e):(n>3?s=Array.prototype.slice.call(arguments,2):n===3&&uo(s)&&(s=[s]),tt(t,e,s))}finally{co(1)}}const Jd="3.5.22";/**
* @vue/runtime-dom v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Si;const Ea=typeof window<"u"&&window.trustedTypes;if(Ea)try{Si=Ea.createPolicy("vue",{createHTML:t=>t})}catch{}const kl=Si?t=>Si.createHTML(t):t=>t,Zd="http://www.w3.org/2000/svg",Qd="http://www.w3.org/1998/Math/MathML",ps=typeof document<"u"?document:null,xa=ps&&ps.createElement("template"),ef={insert:(t,e,s)=>{e.insertBefore(t,s||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,s,n)=>{const o=e==="svg"?ps.createElementNS(Zd,t):e==="mathml"?ps.createElementNS(Qd,t):s?ps.createElement(t,{is:s}):ps.createElement(t);return t==="select"&&n&&n.multiple!=null&&o.setAttribute("multiple",n.multiple),o},createText:t=>ps.createTextNode(t),createComment:t=>ps.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>ps.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,s,n,o,i){const a=s?s.previousSibling:e.lastChild;if(o&&(o===i||o.nextSibling))for(;e.insertBefore(o.cloneNode(!0),s),!(o===i||!(o=o.nextSibling)););else{xa.innerHTML=kl(n==="svg"?`<svg>${t}</svg>`:n==="mathml"?`<math>${t}</math>`:t);const r=xa.content;if(n==="svg"||n==="mathml"){const l=r.firstChild;for(;l.firstChild;)r.appendChild(l.firstChild);r.removeChild(l)}e.insertBefore(r,s)}return[a?a.nextSibling:e.firstChild,s?s.previousSibling:e.lastChild]}},Ts="transition",un="animation",Pn=Symbol("_vtc"),Al={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},tf=ht({},el,Al),sf=t=>(t.displayName="Transition",t.props=tf,t),nf=sf((t,{slots:e})=>Yd(Ju,of(t),e)),Gs=(t,e=[])=>{Se(t)?t.forEach(s=>s(...e)):t&&t(...e)},ka=t=>t?Se(t)?t.some(e=>e.length>1):t.length>1:!1;function of(t){const e={};for(const L in t)L in Al||(e[L]=t[L]);if(t.css===!1)return e;const{name:s="v",type:n,duration:o,enterFromClass:i=`${s}-enter-from`,enterActiveClass:a=`${s}-enter-active`,enterToClass:r=`${s}-enter-to`,appearFromClass:l=i,appearActiveClass:c=a,appearToClass:u=r,leaveFromClass:d=`${s}-leave-from`,leaveActiveClass:m=`${s}-leave-active`,leaveToClass:h=`${s}-leave-to`}=t,_=af(o),E=_&&_[0],S=_&&_[1],{onBeforeEnter:v,onEnter:M,onEnterCancelled:b,onLeave:w,onLeaveCancelled:$,onBeforeAppear:F=v,onAppear:B=M,onAppearCancelled:ee=b}=e,Q=(L,fe,Te,Ce)=>{L._enterCancelled=Ce,Hs(L,fe?u:r),Hs(L,fe?c:a),Te&&Te()},q=(L,fe)=>{L._isLeaving=!1,Hs(L,d),Hs(L,h),Hs(L,m),fe&&fe()},P=L=>(fe,Te)=>{const Ce=L?B:M,ve=()=>Q(fe,L,Te);Gs(Ce,[fe,ve]),Aa(()=>{Hs(fe,L?l:i),fs(fe,L?u:r),ka(Ce)||Ra(fe,n,E,ve)})};return ht(e,{onBeforeEnter(L){Gs(v,[L]),fs(L,i),fs(L,a)},onBeforeAppear(L){Gs(F,[L]),fs(L,l),fs(L,c)},onEnter:P(!1),onAppear:P(!0),onLeave(L,fe){L._isLeaving=!0;const Te=()=>q(L,fe);fs(L,d),L._enterCancelled?(fs(L,m),La(L)):(La(L),fs(L,m)),Aa(()=>{L._isLeaving&&(Hs(L,d),fs(L,h),ka(w)||Ra(L,n,S,Te))}),Gs(w,[L,Te])},onEnterCancelled(L){Q(L,!1,void 0,!0),Gs(b,[L])},onAppearCancelled(L){Q(L,!0,void 0,!0),Gs(ee,[L])},onLeaveCancelled(L){q(L),Gs($,[L])}})}function af(t){if(t==null)return null;if(Je(t))return[Xo(t.enter),Xo(t.leave)];{const e=Xo(t);return[e,e]}}function Xo(t){return cu(t)}function fs(t,e){e.split(/\s+/).forEach(s=>s&&t.classList.add(s)),(t[Pn]||(t[Pn]=new Set)).add(e)}function Hs(t,e){e.split(/\s+/).forEach(n=>n&&t.classList.remove(n));const s=t[Pn];s&&(s.delete(e),s.size||(t[Pn]=void 0))}function Aa(t){requestAnimationFrame(()=>{requestAnimationFrame(t)})}let rf=0;function Ra(t,e,s,n){const o=t._endId=++rf,i=()=>{o===t._endId&&n()};if(s!=null)return setTimeout(i,s);const{type:a,timeout:r,propCount:l}=lf(t,e);if(!a)return n();const c=a+"end";let u=0;const d=()=>{t.removeEventListener(c,m),i()},m=h=>{h.target===t&&++u>=l&&d()};setTimeout(()=>{u<l&&d()},r+1),t.addEventListener(c,m)}function lf(t,e){const s=window.getComputedStyle(t),n=_=>(s[_]||"").split(", "),o=n(`${Ts}Delay`),i=n(`${Ts}Duration`),a=$a(o,i),r=n(`${un}Delay`),l=n(`${un}Duration`),c=$a(r,l);let u=null,d=0,m=0;e===Ts?a>0&&(u=Ts,d=a,m=i.length):e===un?c>0&&(u=un,d=c,m=l.length):(d=Math.max(a,c),u=d>0?a>c?Ts:un:null,m=u?u===Ts?i.length:l.length:0);const h=u===Ts&&/\b(?:transform|all)(?:,|$)/.test(n(`${Ts}Property`).toString());return{type:u,timeout:d,propCount:m,hasTransform:h}}function $a(t,e){for(;t.length<e.length;)t=t.concat(t);return Math.max(...e.map((s,n)=>Pa(s)+Pa(t[n])))}function Pa(t){return t==="auto"?0:Number(t.slice(0,-1).replace(",","."))*1e3}function La(t){return(t?t.ownerDocument:document).body.offsetHeight}function cf(t,e,s){const n=t[Pn];n&&(e=(e?[e,...n]:[...n]).join(" ")),e==null?t.removeAttribute("class"):s?t.setAttribute("class",e):t.className=e}const ho=Symbol("_vod"),Rl=Symbol("_vsh"),$l={name:"show",beforeMount(t,{value:e},{transition:s}){t[ho]=t.style.display==="none"?"":t.style.display,s&&e?s.beforeEnter(t):dn(t,e)},mounted(t,{value:e},{transition:s}){s&&e&&s.enter(t)},updated(t,{value:e,oldValue:s},{transition:n}){!e!=!s&&(n?e?(n.beforeEnter(t),dn(t,!0),n.enter(t)):n.leave(t,()=>{dn(t,!1)}):dn(t,e))},beforeUnmount(t,{value:e}){dn(t,e)}};function dn(t,e){t.style.display=e?t[ho]:"none",t[Rl]=!e}const Pl=Symbol("");function Kt(t){const e=Vi();if(!e)return;const s=e.ut=(o=t(e.proxy))=>{Array.from(document.querySelectorAll(`[data-v-owner="${e.uid}"]`)).forEach(i=>mo(i,o))},n=()=>{const o=t(e.proxy);e.ce?mo(e.ce,o):Ti(e.subTree,o),s(o)};rl(()=>{jr(n)}),Et(()=>{It(n,Jt,{flush:"post"});const o=new MutationObserver(n);o.observe(e.subTree.el.parentNode,{childList:!0}),Ui(()=>o.disconnect())})}function Ti(t,e){if(t.shapeFlag&128){const s=t.suspense;t=s.activeBranch,s.pendingBranch&&!s.isHydrating&&s.effects.push(()=>{Ti(s.activeBranch,e)})}for(;t.component;)t=t.component.subTree;if(t.shapeFlag&1&&t.el)mo(t.el,e);else if(t.type===We)t.children.forEach(s=>Ti(s,e));else if(t.type===Tn){let{el:s,anchor:n}=t;for(;s&&(mo(s,e),s!==n);)s=s.nextSibling}}function mo(t,e){if(t.nodeType===1){const s=t.style;let n="";for(const o in e){const i=_u(e[o]);s.setProperty(`--${o}`,i),n+=`--${o}: ${i};`}s[Pl]=n}}const uf=/(?:^|;)\s*display\s*:/;function df(t,e,s){const n=t.style,o=nt(s);let i=!1;if(s&&!o){if(e)if(nt(e))for(const a of e.split(";")){const r=a.slice(0,a.indexOf(":")).trim();s[r]==null&&Jn(n,r,"")}else for(const a in e)s[a]==null&&Jn(n,a,"");for(const a in s)a==="display"&&(i=!0),Jn(n,a,s[a])}else if(o){if(e!==s){const a=n[Pl];a&&(s+=";"+a),n.cssText=s,i=uf.test(s)}}else e&&t.removeAttribute("style");ho in t&&(t[ho]=i?n.display:"",t[Rl]&&(n.display="none"))}const Ia=/\s*!important$/;function Jn(t,e,s){if(Se(s))s.forEach(n=>Jn(t,e,n));else if(s==null&&(s=""),e.startsWith("--"))t.setProperty(e,s);else{const n=ff(t,e);Ia.test(s)?t.setProperty(Ks(n),s.replace(Ia,""),"important"):t[n]=s}}const Oa=["Webkit","Moz","ms"],Yo={};function ff(t,e){const s=Yo[e];if(s)return s;let n=As(e);if(n!=="filter"&&n in t)return Yo[e]=n;n=wr(n);for(let o=0;o<Oa.length;o++){const i=Oa[o]+n;if(i in t)return Yo[e]=i}return e}const Da="http://www.w3.org/1999/xlink";function Na(t,e,s,n,o,i=mu(e)){n&&e.startsWith("xlink:")?s==null?t.removeAttributeNS(Da,e.slice(6,e.length)):t.setAttributeNS(Da,e,s):s==null||i&&!Tr(s)?t.removeAttribute(e):t.setAttribute(e,i?"":Ls(s)?String(s):s)}function Ga(t,e,s,n,o){if(e==="innerHTML"||e==="textContent"){s!=null&&(t[e]=e==="innerHTML"?kl(s):s);return}const i=t.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const r=i==="OPTION"?t.getAttribute("value")||"":t.value,l=s==null?t.type==="checkbox"?"on":"":String(s);(r!==l||!("_value"in t))&&(t.value=l),s==null&&t.removeAttribute(e),t._value=s;return}let a=!1;if(s===""||s==null){const r=typeof t[e];r==="boolean"?s=Tr(s):s==null&&r==="string"?(s="",a=!0):r==="number"&&(s=0,a=!0)}try{t[e]=s}catch{}a&&t.removeAttribute(o||e)}function pf(t,e,s,n){t.addEventListener(e,s,n)}function hf(t,e,s,n){t.removeEventListener(e,s,n)}const Ha=Symbol("_vei");function mf(t,e,s,n,o=null){const i=t[Ha]||(t[Ha]={}),a=i[e];if(n&&a)a.value=n;else{const[r,l]=_f(e);if(n){const c=i[e]=yf(n,o);pf(t,r,c,l)}else a&&(hf(t,r,a,l),i[e]=void 0)}}const Ua=/(?:Once|Passive|Capture)$/;function _f(t){let e;if(Ua.test(t)){e={};let n;for(;n=t.match(Ua);)t=t.slice(0,t.length-n[0].length),e[n[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):Ks(t.slice(2)),e]}let Jo=0;const gf=Promise.resolve(),vf=()=>Jo||(gf.then(()=>Jo=0),Jo=Date.now());function yf(t,e){const s=n=>{if(!n._vts)n._vts=Date.now();else if(n._vts<=s.attached)return;Qt(bf(n,s.value),e,5,[n])};return s.value=t,s.attached=vf(),s}function bf(t,e){if(Se(e)){const s=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{s.call(t),t._stopped=!0},e.map(n=>o=>!o._stopped&&n&&n(o))}else return e}const Fa=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123,wf=(t,e,s,n,o,i)=>{const a=o==="svg";e==="class"?cf(t,n,a):e==="style"?df(t,s,n):yo(e)?ki(e)||mf(t,e,s,n,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):Sf(t,e,n,a))?(Ga(t,e,n),!t.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Na(t,e,n,a,i,e!=="value")):t._isVueCE&&(/[A-Z]/.test(e)||!nt(n))?Ga(t,As(e),n,i,e):(e==="true-value"?t._trueValue=n:e==="false-value"&&(t._falseValue=n),Na(t,e,n,a))};function Sf(t,e,s,n){if(n)return!!(e==="innerHTML"||e==="textContent"||e in t&&Fa(e)&&Re(s));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const o=t.tagName;if(o==="IMG"||o==="VIDEO"||o==="CANVAS"||o==="SOURCE")return!1}return Fa(e)&&nt(s)?!1:e in t}const Tf=["ctrl","shift","alt","meta"],Mf={stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:t=>t.target!==t.currentTarget,ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>"button"in t&&t.button!==0,middle:t=>"button"in t&&t.button!==1,right:t=>"button"in t&&t.button!==2,exact:(t,e)=>Tf.some(s=>t[`${s}Key`]&&!e.includes(s))},ys=(t,e)=>{const s=t._withMods||(t._withMods={}),n=e.join(".");return s[n]||(s[n]=(o,...i)=>{for(let a=0;a<e.length;a++){const r=Mf[e[a]];if(r&&r(o,e))return}return t(o,...i)})},Cf=ht({patchProp:wf},ef);let Ba;function Ef(){return Ba||(Ba=Td(Cf))}const ja=(...t)=>{const e=Ef().createApp(...t),{mount:s}=e;return e.mount=n=>{const o=kf(n);if(!o)return;const i=e._component;!Re(i)&&!i.render&&!i.template&&(i.template=o.innerHTML),o.nodeType===1&&(o.textContent="");const a=s(o,!1,xf(o));return o instanceof Element&&(o.removeAttribute("v-cloak"),o.setAttribute("data-v-app","")),a},e};function xf(t){if(t instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&t instanceof MathMLElement)return"mathml"}function kf(t){return nt(t)?document.querySelector(t):t}const Zn={maxRetries:3,retryDelay:1e3,timeout:1e4};let Zo=null;const nn={enabled:!0,maxCacheSize:50*1024*1024,cachePrefix:"mgpic_",version:"1.0.0",loadInterval:50,batchSize:3};class Af{constructor(){this.cache=new Map,this.totalSize=0}isSupported(){return"caches"in window}getCacheName(){return`${nn.cachePrefix}${nn.version}`}async isCached(e){if(!this.isSupported())return!1;try{return await(await caches.open(this.getCacheName())).match(e)!==void 0}catch(s){return f(":",s.message),!1}}async cacheResource(e,s){if(!this.isSupported())return!1;try{const n=await caches.open(this.getCacheName());if(await n.match(e))return f(`: ${e}`),!0;await n.put(e,s.clone());const i=s.headers.get("content-length");return i&&(this.totalSize+=parseInt(i)),f(`: ${e}`),!0}catch(n){return f(":",n.message),!1}}async getCachedResource(e){if(!this.isSupported())return null;try{return await(await caches.open(this.getCacheName())).match(e)}catch(s){return f(":",s.message),null}}async cleanupCache(){if(this.isSupported())try{const e=await caches.keys(),s=this.getCacheName();for(const n of e)n.startsWith(nn.cachePrefix)&&n!==s&&(await caches.delete(n),f(`: ${n}`))}catch(e){f(":",e.message)}}}const jt=new Af;let Vn=null;function Rf(){return Vn||(f("R2 URL"),Vn="https://pub-6f9181bda40946ea92b5e87fe84e27d4.r2.dev",Vn)}function G(t){let e=t;t.startsWith("/assets/")?e=t.slice(7):t.startsWith("@assets/")&&(e=t.slice(8));const s=Rf(),n=e.startsWith("/")?e.slice(1):e;return`${s}/${n}`}async function Ll(t,e={}){if(jt.isSupported()){const o=await jt.getCachedResource(t);if(o)return f(` Cache Storage : ${t}`),o}const{maxRetries:s=Zn.maxRetries,retryDelay:n=Zn.retryDelay}=e;for(let o=1;o<=s;o++)try{f(` (${o}/${s}): ${t}`);const i=new AbortController,a=setTimeout(()=>i.abort(),Zn.timeout),r=await fetch(t,{method:"GET",mode:"cors",credentials:"omit",cache:"no-cache",signal:i.signal,...e});if(clearTimeout(a),r.ok)return jt.isSupported()&&await jt.cacheResource(t,r),f(`: ${t}`),r;throw new Error(`HTTP ${r.status}: ${r.statusText}`)}catch(i){if(f(` (${o}/${s}): ${t}`,i.message),o===s)throw f(`: ${t}`,i.message),i;const a=n*o;f(` ${a}ms ...`),await new Promise(r=>setTimeout(r,a))}}async function $f(t=["high","medium"]){try{if(Zo){f("");const i=za(Zo,t);return f(` ${i.length}  (: ${t.join(", ")})`),i}const e=G("asset-list.json");f(` R2 CDN : ${e}`);const s=await Ll(e);if(!s.ok)throw new Error(`: HTTP ${s.status}`);const n=await s.json();Zo=n,f("");const o=za(n,t);return f(` ${o.length}  (: ${t.join(", ")})`),o}catch(e){return f(":",e.message),["logo.glb","frontend_resource/start_game.webp","frontend_resource/copper_warehouse.webp","frontend_resource/game_wiki.webp","frontend_resource/Tutorial.webp","frontend_resource/gacha.webp"]}}function za(t,e){const s=[];for(const n of e)if(t.categories&&t.categories[n]){const o=t.categories[n].resources||[];s.push(...o.map(i=>i.path))}return s}async function Mi(t=null,e=["high","medium"]){f("..."),await jt.cleanupCache();const s=await $f(e),n=nn.batchSize,o=nn.loadInterval,i=s.length;let a=0;t&&t(0,i,0);for(let r=0;r<s.length;r+=n){const l=s.slice(r,r+n);f(` ${Math.floor(r/n)+1}/${Math.ceil(s.length/n)}: ${l.length} `);const c=l.map(async(S,v)=>{const M=G(S);try{if(await jt.isCached(M))return f(`Cache Storage: ${S}`),{success:!0,path:S,cached:!0,source:"cache"};const w=new AbortController,$=setTimeout(()=>w.abort(),Zn.timeout),F=await fetch(M,{method:"GET",mode:"cors",credentials:"omit",cache:"no-cache",signal:w.signal});if(clearTimeout($),F.ok){const B=F.headers.get("x-cache")||F.headers.get("cf-cache-status")||F.type==="basic"&&!F.redirected;return jt.isSupported()&&await jt.cacheResource(M,F),f(`: ${S}${B?" ()":""}`),{success:!0,path:S,cached:!1,fromBrowserCache:!!B}}else throw new Error(`HTTP ${F.status}: ${F.statusText}`)}catch(b){return f(`: ${S}`,b.message),{success:!1,path:S,error:b.message}}}),u=await Promise.all(c);a+=l.length;const d=Math.round(a/i*100);t&&t(a,i,d);const m=u.filter(S=>S.success).length,h=u.filter(S=>S.cached).length,_=u.filter(S=>S.fromBrowserCache).length,E=u.filter(S=>!S.success).length;f(`:  ${m}, Cache Storage ${h},  ${_},  ${E}`),r+n<s.length&&(f(` ${o}ms ...`),await new Promise(S=>setTimeout(S,o)))}f(""),t&&t(i,i,100)}async function Pf(){if(!jt.isSupported())return{supported:!1,message:"API"};try{const e=await(await caches.open(jt.getCacheName())).keys();return{supported:!0,cacheName:jt.getCacheName(),resourceCount:e.length,totalSize:jt.totalSize,maxSize:nn.maxCacheSize}}catch(t){return{supported:!0,error:t.message}}}function Ro(t,e){return G(`copper/${t.toLowerCase()}/${e}/${e}.glb`)}function $o(t){return G(`enemy/${t}/${t}.glb`)}function Il(t){return G(`structure/${t}/${t}.glb`)}function Lf(t){return G(t)}const ut=(t,e)=>{const s=t.__vccOpts||t;for(const[n,o]of e)s[n]=o;return s},If={class:"hall-container"},Of=["src"],Df={__name:"Hall",props:{musicOn:{type:Boolean,default:!0},paused:{type:Boolean,default:!1}},emits:["startGame","openWarehouse","openTutorial","openEncyclopedia","toggle-music"],setup(t,{emit:e}){const s=e,n=t;function o(){s("startGame")}function i(){s("openWarehouse")}function a(){s("openTutorial")}function r(){s("openEncyclopedia")}const l=W(G("@assets/frontend_resource/start_game.webp")),c=W(G("@assets/frontend_resource/copper_warehouse.webp")),u=W(G("@assets/frontend_resource/game_wiki.webp")),d=W(G("@assets/frontend_resource/Tutorial.webp")),m=W(G("ui/Gemini_Generated_Image_gtrehogtrehogtre (1).png")),h=W(!1),_=W(null),E=G("@assets/frontend_resource/hall.mp3");return Et(()=>{setTimeout(()=>{h.value=!0,f("HallUI")},100),n.musicOn&&!n.paused&&_.value&&setTimeout(()=>{if(_.value.readyState>=2)_.value.play().then(()=>{f("[Hall] ")}).catch(v=>{f("[Hall] :",v)});else{const v=()=>{_.value.play().then(()=>{f("[Hall] ")}).catch(M=>{f("[Hall] :",M)}),_.value.removeEventListener("canplay",v)};_.value.addEventListener("canplay",v,{once:!0})}},200)}),It(()=>n.musicOn,S=>{if(_.value)if(S&&!n.paused)if(_.value.readyState>=2)_.value.play().catch(v=>{f("[Hall] :",v)});else{const v=()=>{_.value.play().catch(M=>{f("[Hall] :",M)}),_.value.removeEventListener("canplay",v)};_.value.addEventListener("canplay",v)}else _.value.pause()}),It(()=>n.paused,S=>{if(_.value){if(S)_.value.pause(),f("[Hall] ");else if(n.musicOn){if(_.value.readyState>=2)_.value.play().catch(v=>{f("[Hall] :",v)});else{const v=()=>{_.value.play().catch(M=>{f("[Hall] :",M)}),_.value.removeEventListener("canplay",v)};_.value.addEventListener("canplay",v)}f("[Hall] ")}}}),cs(()=>{_.value&&_.value.pause()}),(S,v)=>(I(),U("div",If,[p("div",{class:"hall-bg",style:Ft({backgroundImage:`url('${m.value}')`})},null,4),p("div",{class:Ye(["menu",{"menu--loaded":h.value}])},[p("button",{class:"tile tile--start",style:Ft({backgroundImage:`url('${l.value}')`}),onClick:o},[...v[0]||(v[0]=[p("div",{class:"tile__mask"},null,-1),p("div",{class:"tile__caption tile__caption--bottom"},[p("div",{class:"tile__title"},""),p("div",{class:"tile__subtitle"},"Begin Adventure")],-1)])],4),p("button",{class:"tile tile--warehouse",style:Ft({backgroundImage:`url('${c.value}')`}),onClick:i},[...v[1]||(v[1]=[p("div",{class:"tile__mask"},null,-1),p("div",{class:"tile__caption tile__caption--top"},[p("div",{class:"tile__title"},""),p("div",{class:"tile__subtitle"},"Character Collection")],-1)])],4),p("button",{class:"tile tile--wiki",style:Ft({backgroundImage:`url('${u.value}')`}),onClick:r},[...v[2]||(v[2]=[p("div",{class:"tile__mask"},null,-1),p("div",{class:"tile__caption tile__caption--bottom"},[p("div",{class:"tile__title"},""),p("div",{class:"tile__subtitle"},"Encyclopedia")],-1)])],4),p("button",{class:"tile tile--tutorial",style:Ft({backgroundImage:`url('${d.value}')`}),onClick:a},[...v[3]||(v[3]=[p("div",{class:"tile__mask"},null,-1),p("div",{class:"tile__caption tile__caption--top"},[p("div",{class:"tile__title"},""),p("div",{class:"tile__subtitle"},"Tutorial")],-1)])],4)],2),p("audio",{ref_key:"audioRef",ref:_,src:ue(E),loop:"",preload:"auto"},null,8,Of)]))}},Nf=ut(Df,[["__scopeId","data-v-4537fc51"]]),Yt={HeartCrystalDust:{name:"",icon:G("resource/heart_crystal_dust.webp")},RecallGear:{name:"",icon:G("resource/recall_gear.webp")},ResonantCrystal:{name:"",icon:G("resource/resonant_star_crystal/resonant_star_crystal.webp")},RefinedCopper:{name:"",icon:G("resource/refined_copper_ingot/refined_copper_ingot.webp")},SpiritalSpark:{name:"",icon:G("resource/spiritual_spark.webp")}};function Ki(t){var e;if(Array.isArray(t==null?void 0:t.item_type)&&t.item_type[0]==="Resource"){const s=t.item_type[1];return((e=Yt[s])==null?void 0:e.name)||s}else if(Array.isArray(t==null?void 0:t.item_type)&&t.item_type[0]==="Equipment")return"";return""}function _t(t){var e;return((e=Yt[t])==null?void 0:e.name)||t}function ss(t){var e;return((e=Yt[t])==null?void 0:e.icon)||""}const Gf="modulepreload",Hf=function(t,e){return new URL(t,e).href},Va={},Ol=function(e,s,n){let o=Promise.resolve();if(s&&s.length>0){const a=document.getElementsByTagName("link"),r=document.querySelector("meta[property=csp-nonce]"),l=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));o=Promise.allSettled(s.map(c=>{if(c=Hf(c,n),c in Va)return;Va[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(!!n)for(let _=a.length-1;_>=0;_--){const E=a[_];if(E.href===c&&(!u||E.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${d}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":Gf,u||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),u)return new Promise((_,E)=>{h.addEventListener("load",_),h.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(a){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=a,window.dispatchEvent(r),!r.defaultPrevented)throw a}return o.then(a=>{for(const r of a||[])r.status==="rejected"&&i(r.reason);return e().catch(i)})};function Uf(t){return{all:t=t||new Map,on:function(e,s){var n=t.get(e);n?n.push(s):t.set(e,[s])},off:function(e,s){var n=t.get(e);n&&(s?n.splice(n.indexOf(s)>>>0,1):t.set(e,[]))},emit:function(e,s){var n=t.get(e);n&&n.slice().map(function(o){o(s)}),(n=t.get("*"))&&n.slice().map(function(o){o(e,s)})}}}const Wi=Uf(),Pt={UPDATE_RESOURCES:"update:resources",RESOURCES_UPDATED:"resources:updated",COPPER_ID_ADDED:"copper:id:added",START_MENU_PAUSE:"menu:pause",START_MENU_RESUME:"menu:resume",START_MENU_STARTED:"menu:started",CONTROL_MODE_CHANGED:"control:mode:changed",GAME_STARTED:"game:started",GAME_ENDED:"game:ended"},js=(t,e)=>{Wi.emit(t,e)},Po=(t,e)=>{Wi.on(t,e)},qi=(t,e)=>{Wi.off(t,e)};class Ff{constructor(){this.queue=[],this.isProcessing=!1,this.handlers=new Map,this.sceneContext=null}setSceneContext(e){this.sceneContext=e}registerHandler(e,s){this.handlers.set(e,s)}enqueue(e){["handle_on_click_copper","on_game_start"].includes(e.type_msg)&&f("[MessageQueue] :",e.type_msg),this.queue.push(e),this.isProcessing||this.processNext()}async processNext(){if(this.queue.length===0){this.isProcessing=!1;return}this.isProcessing=!0;const e=50;let s=0;for(;this.queue.length>0&&s<e;){const n=this.queue.shift();s++;try{const{type_msg:o,content:i}=n,a=this.handlers.get(o);if(a){const r=JSON.parse(i),l=a(r,this.sceneContext||{});l&&typeof l.then=="function"&&await l}else f("[MessageQueue] :",o),f("[MessageQueue] :",Array.from(this.handlers.keys()))}catch(o){f("[MessageQueue] :",o),f("[MessageQueue] :",o.message),f("[MessageQueue] :",o.stack)}}this.queue.length>0?requestAnimationFrame(()=>this.processNext()):this.isProcessing=!1}}const xe=new Ff;function Kn(t,e){return t.find(s=>s.id===e)}function Ka(t){return new Promise(e=>setTimeout(e,t))}function Dl(){f("[MessageQueue] ..."),xe.registerHandler("handle_on_click_copper",async(i,a)=>{var u,d;const{copper:r,resources:l,has_attack_targets:c}=i;f(`[Handler] : ${((u=r.copper.copper_info)==null?void 0:u.name)||"Unknown"} (ID=${r.id})`),f(`[Handler] : HP=${r.now_health}/${r.copper.attribute.health}, =${r.can_move}, =${r.can_attack}, =${r.can_summon}, =${r.can_build}, =${c}`),f(`[Handler] : ${(d=r.copper)==null?void 0:d.copper_type}`),a.highlightSelectedCopper&&a.highlightSelectedCopper(r.id),a.onShowCopperInfo&&a.onShowCopperInfo(r,l,c)}),xe.registerHandler("handle_on_click_enemy",async(i,a)=>{var h,_;const{enemy:r,resources:l,has_attack_targets:c}=i,u=r.owned||!1;f(`[Handler] ${u?"":""}: ${((h=r.enemy_base)==null?void 0:h.name)||"Unknown"} (ID=${r.id})`),f(`[Handler] : HP=${r.now_health}/${r.enemy_base.health}, =${r.can_move}, =${r.can_attack}, owned=${r.owned}, =${c}`);const m={id:r.id,now_health:r.now_health,can_move:u?r.can_move:!1,can_attack:u?r.can_attack:!1,can_summon:!1,position:r.position,isEnemy:!u,isOwnedEnemy:u,copper:{copper_info:{name:((_=r.enemy_base)==null?void 0:_.name)||(u?"":"")},attribute:{health:r.enemy_base.health,attack:r.enemy_base.attack,defense:r.enemy_base.defense,speed:r.enemy_base.speed}}};a.highlightSelectedCopper&&a.highlightSelectedCopper(r.id),a.onShowCopperInfo&&a.onShowCopperInfo(m,l,c)}),xe.registerHandler("handle_on_click_structure",async(i,a)=>{var d;const{structure:r,resources:l}=i,u=r.owned||!1?"":"";f(`[Handler] ${u}: ${((d=r.structure_base)==null?void 0:d.name)||"Unknown"} (ID=${r.id})`),f(`[Handler] : HP=${r.now_health}/${r.structure_base.health}, =${r.can_move}, =${r.can_attack}, owned=${r.owned}, =${r.structure_base.has_storage}`),a.highlightSelectedCopper&&a.highlightSelectedCopper(r.id),a.onShowStructureInfo&&a.onShowStructureInfo(r,l)}),xe.registerHandler("set_copper",async(i,a)=>{const{id:r,position:l,copper:c}=i;window.__ACTUAL_COPPER_IDS__||(window.__ACTUAL_COPPER_IDS__=[]),window.__ACTUAL_COPPER_IDS__.push(c.id),js(Pt.COPPER_ID_ADDED,c.id),a.onSetCopper&&await a.onSetCopper(r,l,c)}),xe.registerHandler("set_enemy",async(i,a)=>{const{id:r,position:l,enemy:c}=i;a.onSetEnemy&&a.onSetEnemy(r,l,c),c.owned&&js(Pt.UPDATE_RESOURCES)}),xe.registerHandler("set_material",async(i,a)=>{const{id:r,position:l,material:c}=i;a.onSetMaterial&&await a.onSetMaterial(r,l,c)}),xe.registerHandler("set_structure",async(i,a)=>{const{id:r,position:l,structure:c}=i;a.onSetStructure&&await a.onSetStructure(r,l,c),c.owned&&js(Pt.UPDATE_RESOURCES)}),xe.registerHandler("remove_unit",async(i,a)=>{const{id:r}=i,l=Kn(a.models||[],r),c=l&&l.type==="enemy"&&!l.isOwned,u=c?l.position:null;if(f(`[Handler] remove_unit: ID=${r}, type=${l==null?void 0:l.type}, isOwned=${l==null?void 0:l.isOwned}, isEnemyDeath=${c}, position=${JSON.stringify(u)}`),l&&l.object){l.object.traverse(h=>{h.material&&(Array.isArray(h.material)?h.material=h.material.map(_=>_.clone()):h.material=h.material.clone())});const d=500,m=performance.now();if(await new Promise(h=>{function _(){const E=performance.now()-m,S=Math.min(E/d,1);l.object&&l.object.traverse(v=>{v.material&&(Array.isArray(v.material)?v.material.forEach(M=>{M.transparent=!0,M.opacity=1-S}):(v.material.transparent=!0,v.material.opacity=1-S))}),S<1?requestAnimationFrame(_):h()}_()}),a.scene&&a.scene.remove(l.object),l.object.traverse(h=>{h.geometry&&h.geometry.dispose(),h.material&&(Array.isArray(h.material)?h.material.forEach(_=>{_.map&&_.map.dispose(),_.lightMap&&_.lightMap.dispose(),_.bumpMap&&_.bumpMap.dispose(),_.normalMap&&_.normalMap.dispose(),_.specularMap&&_.specularMap.dispose(),_.envMap&&_.envMap.dispose(),_.alphaMap&&_.alphaMap.dispose(),_.aoMap&&_.aoMap.dispose(),_.displacementMap&&_.displacementMap.dispose(),_.emissiveMap&&_.emissiveMap.dispose(),_.metalnessMap&&_.metalnessMap.dispose(),_.roughnessMap&&_.roughnessMap.dispose(),_.dispose()}):(h.material.map&&h.material.map.dispose(),h.material.lightMap&&h.material.lightMap.dispose(),h.material.bumpMap&&h.material.bumpMap.dispose(),h.material.normalMap&&h.material.normalMap.dispose(),h.material.specularMap&&h.material.specularMap.dispose(),h.material.envMap&&h.material.envMap.dispose(),h.material.alphaMap&&h.material.alphaMap.dispose(),h.material.aoMap&&h.material.aoMap.dispose(),h.material.displacementMap&&h.material.displacementMap.dispose(),h.material.emissiveMap&&h.material.emissiveMap.dispose(),h.material.metalnessMap&&h.material.metalnessMap.dispose(),h.material.roughnessMap&&h.material.roughnessMap.dispose(),h.material.dispose()))}),a.models){const h=a.models.indexOf(l);h>-1&&a.models.splice(h,1)}a.onClearState&&a.onClearState(r),a.onRemoveHealthBar&&a.onRemoveHealthBar(r),l.type==="copper"&&a.onRemoveCopper&&a.onRemoveCopper(r)}if(c&&u){f("[Handler] ...");const d=m=>{f("[Handler] :",m),a.onShowResourceGain&&Object.keys(m).length>0&&(f("[Handler] :",u,m),a.onShowResourceGain(u,m))};Po(Pt.RESOURCES_UPDATED,d),js(Pt.UPDATE_RESOURCES),setTimeout(()=>{qi(Pt.RESOURCES_UPDATED,d)},1e3)}}),xe.registerHandler("change_direction",async(i,a)=>{const{id:r,direction:l}=i,c=Kn(a.models||[],r);if(c&&c.object){let u=0;switch(l){case"PositiveY":u=0;break;case"PositiveX":u=Math.PI/2;break;case"NegativeY":u=Math.PI;break;case"NegativeX":u=-Math.PI/2;break}let d=c.object.rotation.y;d=Math.atan2(Math.sin(d),Math.cos(d));let m=u-d;m>Math.PI?m-=2*Math.PI:m<-Math.PI&&(m+=2*Math.PI);const h=300,_=performance.now();await new Promise(E=>{function S(){const v=performance.now()-_,M=Math.min(v/h,1),b=1-Math.pow(1-M,2);c.object&&(c.object.rotation.y=d+m*b),M<1?requestAnimationFrame(S):(c.object&&(c.object.rotation.y=u),E())}S()})}}),xe.registerHandler("move_to",async(i,a)=>{const{id:r,to:l}=i,c=Kn(a.models||[],r);if(c&&c.object&&a.gridCellSize){const[u,d]=l,m=u,h=d,_=c.object.position.y;c.position=[u,d],a.onMoveStart&&a.onMoveStart(r,c),a.animateModelMove&&await new Promise(E=>{a.animateModelMove(c,{x:m,y:_,z:h},E)}),a.onMoveComplete&&a.onMoveComplete(r)}}),xe.registerHandler("display_can_move",(i,a)=>{const{id:r,can_move:l}=i,c=l==="true"||l===!0;a.onDisplayCanMove&&a.onDisplayCanMove(r,c)}),xe.registerHandler("display_can_attack",(i,a)=>{const{id:r,can_attack:l}=i,c=l==="true"||l===!0;a.onDisplayCanAttack&&a.onDisplayCanAttack(r,c)}),xe.registerHandler("display_can_summon",(i,a)=>{const{id:r,can_summon:l}=i,c=l==="true"||l===!0;f(`[Handler] display_can_summon id=${r}, can_summon=${c}`),a.onDisplayCanSummon&&a.onDisplayCanSummon(r,c)}),xe.registerHandler("update_health",(i,a)=>{const{id:r,now_health:l,max_health:c}=i;a.onUpdateHealth&&a.onUpdateHealth(r,l,c)}),xe.registerHandler("clear_state",(i,a)=>{const{id:r}=i;a.onClearState&&a.onClearState(r)}),xe.registerHandler("animate_move",async(i,a)=>{const{id:r}=i,l=Kn(a.models||[],r);if(!l){f(`[Handler] animate_move:  ID=${r}`);return}if(window.disableAutoFocus){f(`[Handler] animate_move:  ID=${r}`);return}const c=a.followEnemies!==void 0?a.followEnemies:!1;if(l.type==="enemy"&&!c){f(`[Handler] animate_move:  ID=${r}  context.followEnemies = true `);return}if(a.camera&&a.focusOnModel){const u=a.focusOnModel(l.object,a.camera,a.controls);a.focusState&&(a.focusState.focusPosition=u.focusPosition,a.focusState.focusTarget=u.focusTarget,a.focusState.lerpFactor=u.lerpFactor,f(`[Handler] animate_move:  ID=${r} (${l.name})`)),await Ka(1e3)}}),xe.registerHandler("animate_reset",async(i,a)=>{if(f("[Handler] animate_reset"),a.camera&&a.controls){const r={x:0,y:2,z:5},l={x:0,y:0,z:0};a.focusState&&(a.focusState.focusPosition=r,a.focusState.focusTarget=l,a.focusState.lerpFactor=.08),await Ka(1e3)}}),xe.registerHandler("put_map_block",(i,a)=>{const{position:r}=i;a.onPutMapBlock&&a.onPutMapBlock(r)}),xe.registerHandler("put_room_blocks",async(i,a)=>{const{room_position:r,size:l}=i,[c,u]=r;if(f(`[Handler]  : [${c}, ${u}], ${l}x${l}`),!a.onPutMapBlock){f("[Handler]  context.onPutMapBlock ");return}f("[Handler]  context.onPutMapBlock ...");const d=32,m=l*l;let h=0;for(let _=0;_<l;_++)for(let E=0;E<l;E++){const S=[c+_,u+E];a.onPutMapBlock(S),h++,h%d===0&&await new Promise(v=>requestAnimationFrame(v))}f(`[Handler]  : ${m}`)}),xe.registerHandler("put_resource_marker",(i,a)=>{const{position:r}=i;a.onPutResourceMarker&&a.onPutResourceMarker(r)}),xe.registerHandler("clear_resource_marker",(i,a)=>{const{position:r}=i;a.onClearResourceMarker&&a.onClearResourceMarker(r)});let t=0,e=0,s=0;xe.registerHandler("set_move_block",(i,a)=>{const{position:r}=i;t++,a.onSetMoveBlock&&a.onSetMoveBlock(r)}),xe.registerHandler("set_attack_block",(i,a)=>{const{position:r}=i;e++,a.onSetAttackBlock&&a.onSetAttackBlock(r),(e===1||e%10===0)&&f(`[Handler]  ${e} `)}),xe.registerHandler("set_can_summon_blocks",(i,a)=>{const{position:r}=i;s++,a.onSetCanSummonBlock&&a.onSetCanSummonBlock(r),(s===1||s%10===0)&&f(`[Handler]  ${s} `)});let n=0,o=Date.now();xe.registerHandler("clear_block",(i,a)=>{const{position:r}=i;a.onClearBlock&&a.onClearBlock(r),n++;const l=Date.now();l-o>500&&(n>1&&f(`[Handler]   ${n} `),n=0,t>0&&(f(`[Handler]  ${t} `),t=0),e>0&&(f(`[Handler]  ${e} `),e=0),s>0&&(f(`[Handler]  ${s} `),s=0)),o=l}),xe.registerHandler("attack_complete",(i,a)=>{const{id:r}=i;a.onAttackComplete&&a.onAttackComplete(r)}),xe.registerHandler("on_game_round_pass",(i,a)=>{}),xe.registerHandler("craft_success",(i,a)=>{a.onCraftResult&&a.onCraftResult(!0,i.message||"")}),xe.registerHandler("craft_failed",(i,a)=>{a.onCraftResult&&a.onCraftResult(!1,i.message||"")}),xe.registerHandler("cannot_pick_up_item",(i,a)=>{f("[Handler] :",i.message||i)}),xe.registerHandler("equipment_slot_full",(i,a)=>{f("[Handler] :",i.message||i)}),xe.registerHandler("inventory_full",(i,a)=>{f("[Handler] :",i.message||i)}),xe.registerHandler("resource_not_enough",(i,a)=>{let r="";if(i.missing&&Array.isArray(i.missing)&&i.missing.length>0){const l={HeartCrystalDust:"",RecallGear:"",SpiritalSpark:"",RefinedCopper:"",ResonantCrystal:""};r=`: ${i.missing.map(u=>{const d=l[u.type]||u.type,m=u.needed-u.current;return`${d} ( ${m})`}).join("")}`}f("[Handler] :",r),a.onResourceNotEnough&&a.onResourceNotEnough(r)}),xe.registerHandler("summon_failed",(i,a)=>{f("[Handler] :",i.message||i),a.onSummonFailed&&a.onSummonFailed(i.message||"")}),xe.registerHandler("summon_expired",(i,a)=>{const{id:r,message:l}=i;f(`[Handler] : ID=${r}, ${l}`)}),xe.registerHandler("get_summon_menu",(i,a)=>{const{contents:r}=i;f("[Handler] :",r),a.onShowSummonMenu&&a.onShowSummonMenu(r)}),xe.registerHandler("get_structure_menu",(i,a)=>{const{contents:r}=i;if(!r||r.length===0){f("[Handler]  ");return}const l=r.filter(c=>c.name!=="");f("[Handler] ",l.length,""),a.onShowStructureMenu&&a.onShowStructureMenu(l)}),xe.registerHandler("drill_resource_generate",(i,a)=>{const{position:r,resource_type:l,amount:c}=i;f(`[Handler] : =${JSON.stringify(r)}, =${l}, =${c}`);const u={[l]:parseInt(c)};a.onShowResourceGain&&a.onShowResourceGain(r,u),js(Pt.UPDATE_RESOURCES)}),xe.registerHandler("game_over",(i,a)=>{f("[Handler] "),a.onGameOver&&a.onGameOver()}),xe.registerHandler("success",(i,a)=>{f("[Handler] "),a.onGameSuccess&&a.onGameSuccess()})}const Bf=Object.freeze(Object.defineProperty({__proto__:null,messageQueue:xe,registerAllHandlers:Dl},Symbol.toStringTag,{value:"Module"}));Dl();let Le=null,us=null;us=(async()=>{try{return Le=await Ol(()=>import("./main-Bp8322Dw.js"),[],import.meta.url),f("[Glue] main.js "),Le}catch(t){return f("[Glue] main.js :",t.message),null}})();async function jf(){return await us,Le!=null&&Le.global_gacha?JSON.parse(Le.global_gacha()):{type:"error",content:""}}async function Lo(){return await us,Le!=null&&Le.global_get_resource?JSON.parse(Le.global_get_resource()):{}}async function zf(){return await us,Le!=null&&Le.global_craft?JSON.parse(Le.global_craft()):{type:"error",content:""}}async function Qn(){return await us,Le!=null&&Le.global_get_copper_list?JSON.parse(Le.global_get_copper_list()):[]}async function Vf(t){return await us,Le!=null&&Le.global_upgrade_copper?JSON.parse(Le.global_upgrade_copper(t)):{type:"error",content:""}}async function Nl(t){await us,Le!=null&&Le.global_info_subscribe?(Le.global_info_subscribe(e=>{const s=JSON.parse(e);t(s),xe.enqueue(s)}),f("[Glue] global_info_subscribe ")):f("[Glue] global_info_subscribe ")}async function Kf(t){await us,Le!=null&&Le.global_import_save&&Le.global_import_save(t)}async function Wf(){return await us,Le!=null&&Le.global_export_save?JSON.parse(Le.global_export_save()):{type:"error",content:""}}async function ke(t){await us,Le!=null&&Le.eventloop?Le.eventloop(t):f("[Glue] eventloop ")}const qf={class:"draw-screen"},Xf={class:"draw-screen__body"},Yf={class:"draw-card"},Jf={class:"card-face card-back"},Zf=["src"],Qf={class:"card-face card-front"},ep=["src"],tp={key:1,class:"card-icon"},sp=["src"],np={class:"draw-cost"},op=["src"],ip=["disabled","title"],ap={key:0,class:"toast"},rp={__name:"DrawScreen",emits:["draw"],setup(t,{emit:e}){const s=e,n=W(!1),o=W(!0),i=W(!1),a=W(""),r=W(""),l=W(""),c=W({left:0,top:0,width:0,height:0}),u=W(!1),d=W(!1),m=W(!1),h=W("");function _(M){h.value=M||"",m.value=!0,setTimeout(()=>{m.value=!1},1800)}async function E(){try{const b=await Lo(),w=Number((b==null?void 0:b.SpiritalSpark)??0);o.value=w>=10}catch{o.value=!1}}function S(){i.value=!1,u.value=!1,d.value=!1}function v(){if(n.value)return;if(E(),!o.value){_("");return}n.value=!0,f("[DrawScreen] runDrawSequence start");const M=document.querySelector(".draw-card");if(M){M.classList.add("is-shaking"),setTimeout(()=>M.classList.remove("is-shaking"),500);const b=M.getBoundingClientRect();c.value={left:Math.round(b.left),top:Math.round(b.top),width:Math.round(b.width),height:Math.round(b.height)}}setTimeout(async()=>{i.value=!0,u.value=!1,d.value=!0;try{const b=await jf();if(b&&b.type==="success"&&b.copper&&b.copper.copper_info){const w=b.copper.copper_info;a.value=w.name||"",r.value="",l.value=G(w.icon_url||""),f("[DrawScreen] tempImage resolved:",l.value),await xn(),setTimeout(()=>{d.value=!1,setTimeout(()=>{u.value=!0},350)},450),s("draw",{name:w.name,image:w.icon_url||""}),E()}else b&&b.type==="error"&&(i.value=!1,u.value=!1,d.value=!1,_(b.content||""),s("draw",{error:!0}),E())}catch{i.value=!1,u.value=!1,d.value=!1,_(""),s("draw",{error:!0}),E()}finally{setTimeout(()=>{n.value=!1},800)}},600)}return(M,b)=>(I(),U("div",qf,[p("div",Xf,[p("div",Yf,[i.value?(I(),U("div",{key:0,class:"draw-temp",onClick:S},[b[3]||(b[3]=p("div",{class:"dim-backdrop"},null,-1)),p("div",{class:"temp-stack",style:Ft({left:c.value.left+"px",top:c.value.top+"px",width:c.value.width+"px",height:c.value.height+"px"}),onClick:b[2]||(b[2]=ys(()=>{},["stop"]))},[p("div",{class:Ye(["card",{flipped:d.value}]),onClick:b[0]||(b[0]=ys(w=>d.value=!d.value,["stop"]))},[p("div",Jf,[p("img",{src:ue(G)("frontend_resource/gacha.webp"),alt:"back"},null,8,Zf)]),p("div",Qf,[l.value?(I(),U("img",{key:0,src:l.value,alt:"copper",class:"card-front-img"},null,8,ep)):(I(),U("div",tp,se(r.value||""),1))])],2),p("div",{class:Ye(["card-name-below",{show:u.value}]),onClick:b[1]||(b[1]=ys(()=>{},["stop"]))},se(a.value),3)],4)])):ye("",!0),p("img",{class:"draw-card__img",src:ue(G)("frontend_resource/gacha.webp"),alt:"card"},null,8,sp)]),p("div",np,[p("img",{class:"draw-cost__icon",src:ue(G)("resource/spiritual_spark.webp"),alt:"cost"},null,8,op),b[4]||(b[4]=p("span",{class:"draw-cost__times"},"X 10",-1))]),p("button",{class:"draw-action",disabled:n.value||!o.value,title:o.value?"":"",onClick:v},"  ",8,ip),m.value?(I(),U("div",ap,se(h.value),1)):ye("",!0)])]))}},lp=ut(rp,[["__scopeId","data-v-5ea8b534"]]);function Wa(t,e){if(e===wc)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(e===ii||e===ar){let s=t.getIndex();if(s===null){const a=[],r=t.getAttribute("position");if(r!==void 0){for(let l=0;l<r.count;l++)a.push(l);t.setIndex(a),s=t.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t}const n=s.count-2,o=[];if(e===ii)for(let a=1;a<=n;a++)o.push(s.getX(0)),o.push(s.getX(a)),o.push(s.getX(a+1));else for(let a=0;a<n;a++)a%2===0?(o.push(s.getX(a)),o.push(s.getX(a+1)),o.push(s.getX(a+2))):(o.push(s.getX(a+2)),o.push(s.getX(a+1)),o.push(s.getX(a)));o.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=t.clone();return i.setIndex(o),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),t}class Io extends rr{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(s){return new pp(s)}),this.register(function(s){return new hp(s)}),this.register(function(s){return new Tp(s)}),this.register(function(s){return new Mp(s)}),this.register(function(s){return new Cp(s)}),this.register(function(s){return new _p(s)}),this.register(function(s){return new gp(s)}),this.register(function(s){return new vp(s)}),this.register(function(s){return new yp(s)}),this.register(function(s){return new fp(s)}),this.register(function(s){return new bp(s)}),this.register(function(s){return new mp(s)}),this.register(function(s){return new Sp(s)}),this.register(function(s){return new wp(s)}),this.register(function(s){return new up(s)}),this.register(function(s){return new Ep(s)}),this.register(function(s){return new xp(s)})}load(e,s,n,o){const i=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const c=hn.extractUrlBase(e);a=hn.resolveURL(c,this.path)}else a=hn.extractUrlBase(e);this.manager.itemStart(e);const r=function(c){o?o(c):console.error(c),i.manager.itemError(e),i.manager.itemEnd(e)},l=new eo(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{i.parse(c,a,function(u){s(u),i.manager.itemEnd(e)},r)}catch(u){r(u)}},n,r)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,s,n,o){let i;const a={},r={},l=new TextDecoder;if(typeof e=="string")i=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===Gl){try{a[Oe.KHR_BINARY_GLTF]=new kp(e)}catch(d){o&&o(d);return}i=JSON.parse(a[Oe.KHR_BINARY_GLTF].content)}else i=JSON.parse(l.decode(e));else i=e;if(i.asset===void 0||i.asset.version[0]<2){o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new Fp(i,{path:s||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const d=this.pluginCallbacks[u](c);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),r[d.name]=d,a[d.name]=!0}if(i.extensionsUsed)for(let u=0;u<i.extensionsUsed.length;++u){const d=i.extensionsUsed[u],m=i.extensionsRequired||[];switch(d){case Oe.KHR_MATERIALS_UNLIT:a[d]=new dp;break;case Oe.KHR_DRACO_MESH_COMPRESSION:a[d]=new Ap(i,this.dracoLoader);break;case Oe.KHR_TEXTURE_TRANSFORM:a[d]=new Rp;break;case Oe.KHR_MESH_QUANTIZATION:a[d]=new $p;break;default:m.indexOf(d)>=0&&r[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}c.setExtensions(a),c.setPlugins(r),c.parse(n,o)}parseAsync(e,s){const n=this;return new Promise(function(o,i){n.parse(e,s,o,i)})}}function cp(){let t={};return{get:function(e){return t[e]},add:function(e,s){t[e]=s},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const Oe={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class up{constructor(e){this.parser=e,this.name=Oe.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,s=this.parser.json.nodes||[];for(let n=0,o=s.length;n<o;n++){const i=s[n];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const s=this.parser,n="light:"+e;let o=s.cache.get(n);if(o)return o;const i=s.json,l=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let c;const u=new as(16777215);l.color!==void 0&&u.setRGB(l.color[0],l.color[1],l.color[2],rs);const d=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new gs(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new Xs(u),c.distance=d;break;case"spot":c=new Sc(u),c.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),os(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=s.createUniqueName(l.name||"light_"+e),o=Promise.resolve(c),s.cache.add(n,o),o}getDependency(e,s){if(e==="light")return this._loadLight(s)}createNodeAttachment(e){const s=this,n=this.parser,i=n.json.nodes[e],r=(i.extensions&&i.extensions[this.name]||{}).light;return r===void 0?null:this._loadLight(r).then(function(l){return n._getNodeRef(s.cache,r,l)})}}class dp{constructor(){this.name=Oe.KHR_MATERIALS_UNLIT}getMaterialType(){return Ct}extendParams(e,s,n){const o=[];e.color=new as(1,1,1),e.opacity=1;const i=s.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const a=i.baseColorFactor;e.color.setRGB(a[0],a[1],a[2],rs),e.opacity=a[3]}i.baseColorTexture!==void 0&&o.push(n.assignTexture(e,"map",i.baseColorTexture,vs))}return Promise.all(o)}}class fp{constructor(e){this.parser=e,this.name=Oe.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,s){const o=this.parser.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=o.extensions[this.name].emissiveStrength;return i!==void 0&&(s.emissiveIntensity=i),Promise.resolve()}}class pp{constructor(e){this.parser=e,this.name=Oe.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:ls}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],a=o.extensions[this.name];if(a.clearcoatFactor!==void 0&&(s.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&i.push(n.assignTexture(s,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(s.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&i.push(n.assignTexture(s,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(i.push(n.assignTexture(s,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const r=a.clearcoatNormalTexture.scale;s.clearcoatNormalScale=new At(r,r)}return Promise.all(i)}}class hp{constructor(e){this.parser=e,this.name=Oe.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:ls}extendMaterialParams(e,s){const o=this.parser.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=o.extensions[this.name];return s.dispersion=i.dispersion!==void 0?i.dispersion:0,Promise.resolve()}}class mp{constructor(e){this.parser=e,this.name=Oe.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:ls}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],a=o.extensions[this.name];return a.iridescenceFactor!==void 0&&(s.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&i.push(n.assignTexture(s,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(s.iridescenceIOR=a.iridescenceIor),s.iridescenceThicknessRange===void 0&&(s.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(s.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(s.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&i.push(n.assignTexture(s,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(i)}}class _p{constructor(e){this.parser=e,this.name=Oe.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:ls}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[];s.sheenColor=new as(0,0,0),s.sheenRoughness=0,s.sheen=1;const a=o.extensions[this.name];if(a.sheenColorFactor!==void 0){const r=a.sheenColorFactor;s.sheenColor.setRGB(r[0],r[1],r[2],rs)}return a.sheenRoughnessFactor!==void 0&&(s.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&i.push(n.assignTexture(s,"sheenColorMap",a.sheenColorTexture,vs)),a.sheenRoughnessTexture!==void 0&&i.push(n.assignTexture(s,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(i)}}class gp{constructor(e){this.parser=e,this.name=Oe.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:ls}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],a=o.extensions[this.name];return a.transmissionFactor!==void 0&&(s.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&i.push(n.assignTexture(s,"transmissionMap",a.transmissionTexture)),Promise.all(i)}}class vp{constructor(e){this.parser=e,this.name=Oe.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:ls}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],a=o.extensions[this.name];s.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&i.push(n.assignTexture(s,"thicknessMap",a.thicknessTexture)),s.attenuationDistance=a.attenuationDistance||1/0;const r=a.attenuationColor||[1,1,1];return s.attenuationColor=new as().setRGB(r[0],r[1],r[2],rs),Promise.all(i)}}class yp{constructor(e){this.parser=e,this.name=Oe.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:ls}extendMaterialParams(e,s){const o=this.parser.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=o.extensions[this.name];return s.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class bp{constructor(e){this.parser=e,this.name=Oe.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:ls}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],a=o.extensions[this.name];s.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&i.push(n.assignTexture(s,"specularIntensityMap",a.specularTexture));const r=a.specularColorFactor||[1,1,1];return s.specularColor=new as().setRGB(r[0],r[1],r[2],rs),a.specularColorTexture!==void 0&&i.push(n.assignTexture(s,"specularColorMap",a.specularColorTexture,vs)),Promise.all(i)}}class wp{constructor(e){this.parser=e,this.name=Oe.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:ls}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],a=o.extensions[this.name];return s.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&i.push(n.assignTexture(s,"bumpMap",a.bumpTexture)),Promise.all(i)}}class Sp{constructor(e){this.parser=e,this.name=Oe.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:ls}extendMaterialParams(e,s){const n=this.parser,o=n.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],a=o.extensions[this.name];return a.anisotropyStrength!==void 0&&(s.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(s.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&i.push(n.assignTexture(s,"anisotropyMap",a.anisotropyTexture)),Promise.all(i)}}class Tp{constructor(e){this.parser=e,this.name=Oe.KHR_TEXTURE_BASISU}loadTexture(e){const s=this.parser,n=s.json,o=n.textures[e];if(!o.extensions||!o.extensions[this.name])return null;const i=o.extensions[this.name],a=s.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return s.loadTextureImage(e,i.source,a)}}class Mp{constructor(e){this.parser=e,this.name=Oe.EXT_TEXTURE_WEBP}loadTexture(e){const s=this.name,n=this.parser,o=n.json,i=o.textures[e];if(!i.extensions||!i.extensions[s])return null;const a=i.extensions[s],r=o.images[a.source];let l=n.textureLoader;if(r.uri){const c=n.options.manager.getHandler(r.uri);c!==null&&(l=c)}return n.loadTextureImage(e,a.source,l)}}class Cp{constructor(e){this.parser=e,this.name=Oe.EXT_TEXTURE_AVIF}loadTexture(e){const s=this.name,n=this.parser,o=n.json,i=o.textures[e];if(!i.extensions||!i.extensions[s])return null;const a=i.extensions[s],r=o.images[a.source];let l=n.textureLoader;if(r.uri){const c=n.options.manager.getHandler(r.uri);c!==null&&(l=c)}return n.loadTextureImage(e,a.source,l)}}class Ep{constructor(e){this.name=Oe.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const s=this.parser.json,n=s.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const o=n.extensions[this.name],i=this.parser.getDependency("buffer",o.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(r){const l=o.byteOffset||0,c=o.byteLength||0,u=o.count,d=o.byteStride,m=new Uint8Array(r,l,c);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(u,d,m,o.mode,o.filter).then(function(h){return h.buffer}):a.ready.then(function(){const h=new ArrayBuffer(u*d);return a.decodeGltfBuffer(new Uint8Array(h),u,d,m,o.mode,o.filter),h})})}else return null}}class xp{constructor(e){this.name=Oe.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const s=this.parser.json,n=s.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const o=s.meshes[n.mesh];for(const c of o.primitives)if(c.mode!==Ut.TRIANGLES&&c.mode!==Ut.TRIANGLE_STRIP&&c.mode!==Ut.TRIANGLE_FAN&&c.mode!==void 0)return null;const a=n.extensions[this.name].attributes,r=[],l={};for(const c in a)r.push(this.parser.getDependency("accessor",a[c]).then(u=>(l[c]=u,l[c])));return r.length<1?null:(r.push(this.parser.createNodeMesh(e)),Promise.all(r).then(c=>{const u=c.pop(),d=u.isGroup?u.children:[u],m=c[0].count,h=[];for(const _ of d){const E=new zs,S=new Ae,v=new an,M=new Ae(1,1,1),b=new lr(_.geometry,_.material,m);for(let w=0;w<m;w++)l.TRANSLATION&&S.fromBufferAttribute(l.TRANSLATION,w),l.ROTATION&&v.fromBufferAttribute(l.ROTATION,w),l.SCALE&&M.fromBufferAttribute(l.SCALE,w),b.setMatrixAt(w,E.compose(S,v,M));for(const w in l)if(w==="_COLOR_0"){const $=l[w];b.instanceColor=new Tc($.array,$.itemSize,$.normalized)}else w!=="TRANSLATION"&&w!=="ROTATION"&&w!=="SCALE"&&_.geometry.setAttribute(w,l[w]);cr.prototype.copy.call(b,_),this.parser.assignFinalMaterial(b),h.push(b)}return u.isGroup?(u.clear(),u.add(...h),u):h[0]}))}}const Gl="glTF",fn=12,qa={JSON:1313821514,BIN:5130562};class kp{constructor(e){this.name=Oe.KHR_BINARY_GLTF,this.content=null,this.body=null;const s=new DataView(e,0,fn),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:s.getUint32(4,!0),length:s.getUint32(8,!0)},this.header.magic!==Gl)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const o=this.header.length-fn,i=new DataView(e,fn);let a=0;for(;a<o;){const r=i.getUint32(a,!0);a+=4;const l=i.getUint32(a,!0);if(a+=4,l===qa.JSON){const c=new Uint8Array(e,fn+a,r);this.content=n.decode(c)}else if(l===qa.BIN){const c=fn+a;this.body=e.slice(c,c+r)}a+=r}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ap{constructor(e,s){if(!s)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Oe.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=s,this.dracoLoader.preload()}decodePrimitive(e,s){const n=this.json,o=this.dracoLoader,i=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,r={},l={},c={};for(const u in a){const d=Ci[u]||u.toLowerCase();r[d]=a[u]}for(const u in e.attributes){const d=Ci[u]||u.toLowerCase();if(a[u]!==void 0){const m=n.accessors[e.attributes[u]],h=on[m.componentType];c[d]=h.name,l[d]=m.normalized===!0}}return s.getDependency("bufferView",i).then(function(u){return new Promise(function(d,m){o.decodeDracoFile(u,function(h){for(const _ in h.attributes){const E=h.attributes[_],S=l[_];S!==void 0&&(E.normalized=S)}d(h)},r,c,rs,m)})})}}class Rp{constructor(){this.name=Oe.KHR_TEXTURE_TRANSFORM}extendTexture(e,s){return(s.texCoord===void 0||s.texCoord===e.channel)&&s.offset===void 0&&s.rotation===void 0&&s.scale===void 0||(e=e.clone(),s.texCoord!==void 0&&(e.channel=s.texCoord),s.offset!==void 0&&e.offset.fromArray(s.offset),s.rotation!==void 0&&(e.rotation=s.rotation),s.scale!==void 0&&e.repeat.fromArray(s.scale),e.needsUpdate=!0),e}}class $p{constructor(){this.name=Oe.KHR_MESH_QUANTIZATION}}class Hl extends Wc{constructor(e,s,n,o){super(e,s,n,o)}copySampleValue_(e){const s=this.resultBuffer,n=this.sampleValues,o=this.valueSize,i=e*o*3+o;for(let a=0;a!==o;a++)s[a]=n[i+a];return s}interpolate_(e,s,n,o){const i=this.resultBuffer,a=this.sampleValues,r=this.valueSize,l=r*2,c=r*3,u=o-s,d=(n-s)/u,m=d*d,h=m*d,_=e*c,E=_-c,S=-2*h+3*m,v=h-m,M=1-S,b=v-m+d;for(let w=0;w!==r;w++){const $=a[E+w+r],F=a[E+w+l]*u,B=a[_+w+r],ee=a[_+w]*u;i[w]=M*$+b*F+S*B+v*ee}return i}}const Pp=new an;class Lp extends Hl{interpolate_(e,s,n,o){const i=super.interpolate_(e,s,n,o);return Pp.fromArray(i).normalize().toArray(i),i}}const Ut={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},on={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Xa={9728:dr,9729:ai,9984:Ac,9985:kc,9986:xc,9987:ur},Ya={33071:$c,33648:Rc,10497:ri},Qo={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ci={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ms={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Ip={CUBICSPLINE:void 0,LINEAR:hr,STEP:zc},ei={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Op(t){return t.DefaultMaterial===void 0&&(t.DefaultMaterial=new $t({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Kc})),t.DefaultMaterial}function Us(t,e,s){for(const n in s.extensions)t[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=s.extensions[n])}function os(t,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Dp(t,e,s){let n=!1,o=!1,i=!1;for(let c=0,u=e.length;c<u;c++){const d=e[c];if(d.POSITION!==void 0&&(n=!0),d.NORMAL!==void 0&&(o=!0),d.COLOR_0!==void 0&&(i=!0),n&&o&&i)break}if(!n&&!o&&!i)return Promise.resolve(t);const a=[],r=[],l=[];for(let c=0,u=e.length;c<u;c++){const d=e[c];if(n){const m=d.POSITION!==void 0?s.getDependency("accessor",d.POSITION):t.attributes.position;a.push(m)}if(o){const m=d.NORMAL!==void 0?s.getDependency("accessor",d.NORMAL):t.attributes.normal;r.push(m)}if(i){const m=d.COLOR_0!==void 0?s.getDependency("accessor",d.COLOR_0):t.attributes.color;l.push(m)}}return Promise.all([Promise.all(a),Promise.all(r),Promise.all(l)]).then(function(c){const u=c[0],d=c[1],m=c[2];return n&&(t.morphAttributes.position=u),o&&(t.morphAttributes.normal=d),i&&(t.morphAttributes.color=m),t.morphTargetsRelative=!0,t})}function Np(t,e){if(t.updateMorphTargets(),e.weights!==void 0)for(let s=0,n=e.weights.length;s<n;s++)t.morphTargetInfluences[s]=e.weights[s];if(e.extras&&Array.isArray(e.extras.targetNames)){const s=e.extras.targetNames;if(t.morphTargetInfluences.length===s.length){t.morphTargetDictionary={};for(let n=0,o=s.length;n<o;n++)t.morphTargetDictionary[s[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Gp(t){let e;const s=t.extensions&&t.extensions[Oe.KHR_DRACO_MESH_COMPRESSION];if(s?e="draco:"+s.bufferView+":"+s.indices+":"+ti(s.attributes):e=t.indices+":"+ti(t.attributes)+":"+t.mode,t.targets!==void 0)for(let n=0,o=t.targets.length;n<o;n++)e+=":"+ti(t.targets[n]);return e}function ti(t){let e="";const s=Object.keys(t).sort();for(let n=0,o=s.length;n<o;n++)e+=s[n]+":"+t[s[n]]+";";return e}function Ei(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Hp(t){return t.search(/\.jpe?g($|\?)/i)>0||t.search(/^data\:image\/jpeg/)===0?"image/jpeg":t.search(/\.webp($|\?)/i)>0||t.search(/^data\:image\/webp/)===0?"image/webp":t.search(/\.ktx2($|\?)/i)>0||t.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const Up=new zs;class Fp{constructor(e={},s={}){this.json=e,this.extensions={},this.plugins={},this.options=s,this.cache=new cp,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,o=-1,i=!1,a=-1;if(typeof navigator<"u"){const r=navigator.userAgent;n=/^((?!chrome|android).)*safari/i.test(r)===!0;const l=r.match(/Version\/(\d+)/);o=n&&l?parseInt(l[1],10):-1,i=r.indexOf("Firefox")>-1,a=i?r.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||n&&o<17||i&&a<98?this.textureLoader=new Mc(this.options.manager):this.textureLoader=new Cc(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new eo(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,s){const n=this,o=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(a){const r={scene:a[0][o.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:o.asset,parser:n,userData:{}};return Us(i,r,o),os(r,o),Promise.all(n._invokeAll(function(l){return l.afterRoot&&l.afterRoot(r)})).then(function(){for(const l of r.scenes)l.updateMatrixWorld();e(r)})}).catch(s)}_markDefs(){const e=this.json.nodes||[],s=this.json.skins||[],n=this.json.meshes||[];for(let o=0,i=s.length;o<i;o++){const a=s[o].joints;for(let r=0,l=a.length;r<l;r++)e[a[r]].isBone=!0}for(let o=0,i=e.length;o<i;o++){const a=e[o];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(n[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,s){s!==void 0&&(e.refs[s]===void 0&&(e.refs[s]=e.uses[s]=0),e.refs[s]++)}_getNodeRef(e,s,n){if(e.refs[s]<=1)return n;const o=n.clone(),i=(a,r)=>{const l=this.associations.get(a);l!=null&&this.associations.set(r,l);for(const[c,u]of a.children.entries())i(u,r.children[c])};return i(n,o),o.name+="_instance_"+e.uses[s]++,o}_invokeOne(e){const s=Object.values(this.plugins);s.push(this);for(let n=0;n<s.length;n++){const o=e(s[n]);if(o)return o}return null}_invokeAll(e){const s=Object.values(this.plugins);s.unshift(this);const n=[];for(let o=0;o<s.length;o++){const i=e(s[o]);i&&n.push(i)}return n}getDependency(e,s){const n=e+":"+s;let o=this.cache.get(n);if(!o){switch(e){case"scene":o=this.loadScene(s);break;case"node":o=this._invokeOne(function(i){return i.loadNode&&i.loadNode(s)});break;case"mesh":o=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(s)});break;case"accessor":o=this.loadAccessor(s);break;case"bufferView":o=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(s)});break;case"buffer":o=this.loadBuffer(s);break;case"material":o=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(s)});break;case"texture":o=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(s)});break;case"skin":o=this.loadSkin(s);break;case"animation":o=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(s)});break;case"camera":o=this.loadCamera(s);break;default:if(o=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(e,s)}),!o)throw new Error("Unknown type: "+e);break}this.cache.add(n,o)}return o}getDependencies(e){let s=this.cache.get(e);if(!s){const n=this,o=this.json[e+(e==="mesh"?"es":"s")]||[];s=Promise.all(o.map(function(i,a){return n.getDependency(e,a)})),this.cache.add(e,s)}return s}loadBuffer(e){const s=this.json.buffers[e],n=this.fileLoader;if(s.type&&s.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+s.type+" buffer type is not supported.");if(s.uri===void 0&&e===0)return Promise.resolve(this.extensions[Oe.KHR_BINARY_GLTF].body);const o=this.options;return new Promise(function(i,a){n.load(hn.resolveURL(s.uri,o.path),i,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+s.uri+'".'))})})}loadBufferView(e){const s=this.json.bufferViews[e];return this.getDependency("buffer",s.buffer).then(function(n){const o=s.byteLength||0,i=s.byteOffset||0;return n.slice(i,i+o)})}loadAccessor(e){const s=this,n=this.json,o=this.json.accessors[e];if(o.bufferView===void 0&&o.sparse===void 0){const a=Qo[o.type],r=on[o.componentType],l=o.normalized===!0,c=new r(o.count*a);return Promise.resolve(new mn(c,a,l))}const i=[];return o.bufferView!==void 0?i.push(this.getDependency("bufferView",o.bufferView)):i.push(null),o.sparse!==void 0&&(i.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(i).then(function(a){const r=a[0],l=Qo[o.type],c=on[o.componentType],u=c.BYTES_PER_ELEMENT,d=u*l,m=o.byteOffset||0,h=o.bufferView!==void 0?n.bufferViews[o.bufferView].byteStride:void 0,_=o.normalized===!0;let E,S;if(h&&h!==d){const v=Math.floor(m/h),M="InterleavedBuffer:"+o.bufferView+":"+o.componentType+":"+v+":"+o.count;let b=s.cache.get(M);b||(E=new c(r,v*h,o.count*h/u),b=new Ec(E,h/u),s.cache.add(M,b)),S=new Vc(b,l,m%h/u,_)}else r===null?E=new c(o.count*l):E=new c(r,m,o.count*l),S=new mn(E,l,_);if(o.sparse!==void 0){const v=Qo.SCALAR,M=on[o.sparse.indices.componentType],b=o.sparse.indices.byteOffset||0,w=o.sparse.values.byteOffset||0,$=new M(a[1],b,o.sparse.count*v),F=new c(a[2],w,o.sparse.count*l);r!==null&&(S=new mn(S.array.slice(),S.itemSize,S.normalized)),S.normalized=!1;for(let B=0,ee=$.length;B<ee;B++){const Q=$[B];if(S.setX(Q,F[B*l]),l>=2&&S.setY(Q,F[B*l+1]),l>=3&&S.setZ(Q,F[B*l+2]),l>=4&&S.setW(Q,F[B*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}S.normalized=_}return S})}loadTexture(e){const s=this.json,n=this.options,i=s.textures[e].source,a=s.images[i];let r=this.textureLoader;if(a.uri){const l=n.manager.getHandler(a.uri);l!==null&&(r=l)}return this.loadTextureImage(e,i,r)}loadTextureImage(e,s,n){const o=this,i=this.json,a=i.textures[e],r=i.images[s],l=(r.uri||r.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(s,n).then(function(u){u.flipY=!1,u.name=a.name||r.name||"",u.name===""&&typeof r.uri=="string"&&r.uri.startsWith("data:image/")===!1&&(u.name=r.uri);const m=(i.samplers||{})[a.sampler]||{};return u.magFilter=Xa[m.magFilter]||ai,u.minFilter=Xa[m.minFilter]||ur,u.wrapS=Ya[m.wrapS]||ri,u.wrapT=Ya[m.wrapT]||ri,u.generateMipmaps=!u.isCompressedTexture&&u.minFilter!==dr&&u.minFilter!==ai,o.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,s){const n=this,o=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const a=o.images[e],r=self.URL||self.webkitURL;let l=a.uri||"",c=!1;if(a.bufferView!==void 0)l=n.getDependency("bufferView",a.bufferView).then(function(d){c=!0;const m=new Blob([d],{type:a.mimeType});return l=r.createObjectURL(m),l});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(d){return new Promise(function(m,h){let _=m;s.isImageBitmapLoader===!0&&(_=function(E){const S=new ta(E);S.needsUpdate=!0,m(S)}),s.load(hn.resolveURL(d,i.path),_,void 0,h)})}).then(function(d){return c===!0&&r.revokeObjectURL(l),os(d,a),d.userData.mimeType=a.mimeType||Hp(a.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),d});return this.sourceCache[e]=u,u}assignTexture(e,s,n,o){const i=this;return this.getDependency("texture",n.index).then(function(a){if(!a)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(a=a.clone(),a.channel=n.texCoord),i.extensions[Oe.KHR_TEXTURE_TRANSFORM]){const r=n.extensions!==void 0?n.extensions[Oe.KHR_TEXTURE_TRANSFORM]:void 0;if(r){const l=i.associations.get(a);a=i.extensions[Oe.KHR_TEXTURE_TRANSFORM].extendTexture(a,r),i.associations.set(a,l)}}return o!==void 0&&(a.colorSpace=o),e[s]=a,a})}assignFinalMaterial(e){const s=e.geometry;let n=e.material;const o=s.attributes.tangent===void 0,i=s.attributes.color!==void 0,a=s.attributes.normal===void 0;if(e.isPoints){const r="PointsMaterial:"+n.uuid;let l=this.cache.get(r);l||(l=new Pc,Ho.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,l.sizeAttenuation=!1,this.cache.add(r,l)),n=l}else if(e.isLine){const r="LineBasicMaterial:"+n.uuid;let l=this.cache.get(r);l||(l=new Lc,Ho.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,this.cache.add(r,l)),n=l}if(o||i||a){let r="ClonedMaterial:"+n.uuid+":";o&&(r+="derivative-tangents:"),i&&(r+="vertex-colors:"),a&&(r+="flat-shading:");let l=this.cache.get(r);l||(l=n.clone(),i&&(l.vertexColors=!0),a&&(l.flatShading=!0),o&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(r,l),this.associations.set(l,this.associations.get(n))),n=l}e.material=n}getMaterialType(){return $t}loadMaterial(e){const s=this,n=this.json,o=this.extensions,i=n.materials[e];let a;const r={},l=i.extensions||{},c=[];if(l[Oe.KHR_MATERIALS_UNLIT]){const d=o[Oe.KHR_MATERIALS_UNLIT];a=d.getMaterialType(),c.push(d.extendParams(r,i,s))}else{const d=i.pbrMetallicRoughness||{};if(r.color=new as(1,1,1),r.opacity=1,Array.isArray(d.baseColorFactor)){const m=d.baseColorFactor;r.color.setRGB(m[0],m[1],m[2],rs),r.opacity=m[3]}d.baseColorTexture!==void 0&&c.push(s.assignTexture(r,"map",d.baseColorTexture,vs)),r.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,r.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(c.push(s.assignTexture(r,"metalnessMap",d.metallicRoughnessTexture)),c.push(s.assignTexture(r,"roughnessMap",d.metallicRoughnessTexture))),a=this._invokeOne(function(m){return m.getMaterialType&&m.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(m){return m.extendMaterialParams&&m.extendMaterialParams(e,r)})))}i.doubleSided===!0&&(r.side=ks);const u=i.alphaMode||ei.OPAQUE;if(u===ei.BLEND?(r.transparent=!0,r.depthWrite=!1):(r.transparent=!1,u===ei.MASK&&(r.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&a!==Ct&&(c.push(s.assignTexture(r,"normalMap",i.normalTexture)),r.normalScale=new At(1,1),i.normalTexture.scale!==void 0)){const d=i.normalTexture.scale;r.normalScale.set(d,d)}if(i.occlusionTexture!==void 0&&a!==Ct&&(c.push(s.assignTexture(r,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(r.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&a!==Ct){const d=i.emissiveFactor;r.emissive=new as().setRGB(d[0],d[1],d[2],rs)}return i.emissiveTexture!==void 0&&a!==Ct&&c.push(s.assignTexture(r,"emissiveMap",i.emissiveTexture,vs)),Promise.all(c).then(function(){const d=new a(r);return i.name&&(d.name=i.name),os(d,i),s.associations.set(d,{materials:e}),i.extensions&&Us(o,d,i),d})}createUniqueName(e){const s=Ic.sanitizeNodeName(e||"");return s in this.nodeNamesUsed?s+"_"+ ++this.nodeNamesUsed[s]:(this.nodeNamesUsed[s]=0,s)}loadGeometries(e){const s=this,n=this.extensions,o=this.primitiveCache;function i(r){return n[Oe.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(r,s).then(function(l){return Ja(l,r,s)})}const a=[];for(let r=0,l=e.length;r<l;r++){const c=e[r],u=Gp(c),d=o[u];if(d)a.push(d.promise);else{let m;c.extensions&&c.extensions[Oe.KHR_DRACO_MESH_COMPRESSION]?m=i(c):m=Ja(new fr,c,s),o[u]={primitive:c,promise:m},a.push(m)}}return Promise.all(a)}loadMesh(e){const s=this,n=this.json,o=this.extensions,i=n.meshes[e],a=i.primitives,r=[];for(let l=0,c=a.length;l<c;l++){const u=a[l].material===void 0?Op(this.cache):this.getDependency("material",a[l].material);r.push(u)}return r.push(s.loadGeometries(a)),Promise.all(r).then(function(l){const c=l.slice(0,l.length-1),u=l[l.length-1],d=[];for(let h=0,_=u.length;h<_;h++){const E=u[h],S=a[h];let v;const M=c[h];if(S.mode===Ut.TRIANGLES||S.mode===Ut.TRIANGLE_STRIP||S.mode===Ut.TRIANGLE_FAN||S.mode===void 0)v=i.isSkinnedMesh===!0?new Oc(E,M):new et(E,M),v.isSkinnedMesh===!0&&v.normalizeSkinWeights(),S.mode===Ut.TRIANGLE_STRIP?v.geometry=Wa(v.geometry,ar):S.mode===Ut.TRIANGLE_FAN&&(v.geometry=Wa(v.geometry,ii));else if(S.mode===Ut.LINES)v=new Dc(E,M);else if(S.mode===Ut.LINE_STRIP)v=new Nc(E,M);else if(S.mode===Ut.LINE_LOOP)v=new Gc(E,M);else if(S.mode===Ut.POINTS)v=new Hc(E,M);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+S.mode);Object.keys(v.geometry.morphAttributes).length>0&&Np(v,i),v.name=s.createUniqueName(i.name||"mesh_"+e),os(v,i),S.extensions&&Us(o,v,S),s.assignFinalMaterial(v),d.push(v)}for(let h=0,_=d.length;h<_;h++)s.associations.set(d[h],{meshes:e,primitives:h});if(d.length===1)return i.extensions&&Us(o,d[0],i),d[0];const m=new Xt;i.extensions&&Us(o,m,i),s.associations.set(m,{meshes:e});for(let h=0,_=d.length;h<_;h++)m.add(d[h]);return m})}loadCamera(e){let s;const n=this.json.cameras[e],o=n[n.type];if(!o){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?s=new Ln(pr.radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):n.type==="orthographic"&&(s=new Uc(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),n.name&&(s.name=this.createUniqueName(n.name)),os(s,n),Promise.resolve(s)}loadSkin(e){const s=this.json.skins[e],n=[];for(let o=0,i=s.joints.length;o<i;o++)n.push(this._loadNodeShallow(s.joints[o]));return s.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",s.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(o){const i=o.pop(),a=o,r=[],l=[];for(let c=0,u=a.length;c<u;c++){const d=a[c];if(d){r.push(d);const m=new zs;i!==null&&m.fromArray(i.array,c*16),l.push(m)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',s.joints[c])}return new Fc(r,l)})}loadAnimation(e){const s=this.json,n=this,o=s.animations[e],i=o.name?o.name:"animation_"+e,a=[],r=[],l=[],c=[],u=[];for(let d=0,m=o.channels.length;d<m;d++){const h=o.channels[d],_=o.samplers[h.sampler],E=h.target,S=E.node,v=o.parameters!==void 0?o.parameters[_.input]:_.input,M=o.parameters!==void 0?o.parameters[_.output]:_.output;E.node!==void 0&&(a.push(this.getDependency("node",S)),r.push(this.getDependency("accessor",v)),l.push(this.getDependency("accessor",M)),c.push(_),u.push(E))}return Promise.all([Promise.all(a),Promise.all(r),Promise.all(l),Promise.all(c),Promise.all(u)]).then(function(d){const m=d[0],h=d[1],_=d[2],E=d[3],S=d[4],v=[];for(let b=0,w=m.length;b<w;b++){const $=m[b],F=h[b],B=_[b],ee=E[b],Q=S[b];if($===void 0)continue;$.updateMatrix&&$.updateMatrix();const q=n._createAnimationTracks($,F,B,ee,Q);if(q)for(let P=0;P<q.length;P++)v.push(q[P])}const M=new Bc(i,void 0,v);return os(M,o),M})}createNodeMesh(e){const s=this.json,n=this,o=s.nodes[e];return o.mesh===void 0?null:n.getDependency("mesh",o.mesh).then(function(i){const a=n._getNodeRef(n.meshCache,o.mesh,i);return o.weights!==void 0&&a.traverse(function(r){if(r.isMesh)for(let l=0,c=o.weights.length;l<c;l++)r.morphTargetInfluences[l]=o.weights[l]}),a})}loadNode(e){const s=this.json,n=this,o=s.nodes[e],i=n._loadNodeShallow(e),a=[],r=o.children||[];for(let c=0,u=r.length;c<u;c++)a.push(n.getDependency("node",r[c]));const l=o.skin===void 0?Promise.resolve(null):n.getDependency("skin",o.skin);return Promise.all([i,Promise.all(a),l]).then(function(c){const u=c[0],d=c[1],m=c[2];m!==null&&u.traverse(function(h){h.isSkinnedMesh&&h.bind(m,Up)});for(let h=0,_=d.length;h<_;h++)u.add(d[h]);return u})}_loadNodeShallow(e){const s=this.json,n=this.extensions,o=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const i=s.nodes[e],a=i.name?o.createUniqueName(i.name):"",r=[],l=o._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&r.push(l),i.camera!==void 0&&r.push(o.getDependency("camera",i.camera).then(function(c){return o._getNodeRef(o.cameraCache,i.camera,c)})),o._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){r.push(c)}),this.nodeCache[e]=Promise.all(r).then(function(c){let u;if(i.isBone===!0?u=new jc:c.length>1?u=new Xt:c.length===1?u=c[0]:u=new cr,u!==c[0])for(let d=0,m=c.length;d<m;d++)u.add(c[d]);if(i.name&&(u.userData.name=i.name,u.name=a),os(u,i),i.extensions&&Us(n,u,i),i.matrix!==void 0){const d=new zs;d.fromArray(i.matrix),u.applyMatrix4(d)}else i.translation!==void 0&&u.position.fromArray(i.translation),i.rotation!==void 0&&u.quaternion.fromArray(i.rotation),i.scale!==void 0&&u.scale.fromArray(i.scale);if(!o.associations.has(u))o.associations.set(u,{});else if(i.mesh!==void 0&&o.meshCache.refs[i.mesh]>1){const d=o.associations.get(u);o.associations.set(u,{...d})}return o.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const s=this.extensions,n=this.json.scenes[e],o=this,i=new Xt;n.name&&(i.name=o.createUniqueName(n.name)),os(i,n),n.extensions&&Us(s,i,n);const a=n.nodes||[],r=[];for(let l=0,c=a.length;l<c;l++)r.push(o.getDependency("node",a[l]));return Promise.all(r).then(function(l){for(let u=0,d=l.length;u<d;u++)i.add(l[u]);const c=u=>{const d=new Map;for(const[m,h]of o.associations)(m instanceof Ho||m instanceof ta)&&d.set(m,h);return u.traverse(m=>{const h=o.associations.get(m);h!=null&&d.set(m,h)}),d};return o.associations=c(i),i})}_createAnimationTracks(e,s,n,o,i){const a=[],r=e.name?e.name:e.uuid,l=[];Ms[i.path]===Ms.weights?e.traverse(function(m){m.morphTargetInfluences&&l.push(m.name?m.name:m.uuid)}):l.push(r);let c;switch(Ms[i.path]){case Ms.weights:c=na;break;case Ms.rotation:c=oa;break;case Ms.translation:case Ms.scale:c=sa;break;default:switch(n.itemSize){case 1:c=na;break;case 2:case 3:default:c=sa;break}break}const u=o.interpolation!==void 0?Ip[o.interpolation]:hr,d=this._getArrayFromAccessor(n);for(let m=0,h=l.length;m<h;m++){const _=new c(l[m]+"."+Ms[i.path],s.array,d,u);o.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(_),a.push(_)}return a}_getArrayFromAccessor(e){let s=e.array;if(e.normalized){const n=Ei(s.constructor),o=new Float32Array(s.length);for(let i=0,a=s.length;i<a;i++)o[i]=s[i]*n;s=o}return s}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const o=this instanceof oa?Lp:Hl;return new o(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Bp(t,e,s){const n=e.attributes,o=new wt;if(n.POSITION!==void 0){const r=s.json.accessors[n.POSITION],l=r.min,c=r.max;if(l!==void 0&&c!==void 0){if(o.set(new Ae(l[0],l[1],l[2]),new Ae(c[0],c[1],c[2])),r.normalized){const u=Ei(on[r.componentType]);o.min.multiplyScalar(u),o.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=e.targets;if(i!==void 0){const r=new Ae,l=new Ae;for(let c=0,u=i.length;c<u;c++){const d=i[c];if(d.POSITION!==void 0){const m=s.json.accessors[d.POSITION],h=m.min,_=m.max;if(h!==void 0&&_!==void 0){if(l.setX(Math.max(Math.abs(h[0]),Math.abs(_[0]))),l.setY(Math.max(Math.abs(h[1]),Math.abs(_[1]))),l.setZ(Math.max(Math.abs(h[2]),Math.abs(_[2]))),m.normalized){const E=Ei(on[m.componentType]);l.multiplyScalar(E)}r.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(r)}t.boundingBox=o;const a=new qc;o.getCenter(a.center),a.radius=o.min.distanceTo(o.max)/2,t.boundingSphere=a}function Ja(t,e,s){const n=e.attributes,o=[];function i(a,r){return s.getDependency("accessor",a).then(function(l){t.setAttribute(r,l)})}for(const a in n){const r=Ci[a]||a.toLowerCase();r in t.attributes||o.push(i(n[a],r))}if(e.indices!==void 0&&!t.index){const a=s.getDependency("accessor",e.indices).then(function(r){t.setIndex(r)});o.push(a)}return li.workingColorSpace!==rs&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${li.workingColorSpace}" not supported.`),os(t,e),Bp(t,e,s),Promise.all(o).then(function(){return e.targets!==void 0?Dp(t,e.targets,s):t})}const si=new WeakMap;class Oo extends rr{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,s,n,o){const i=new eo(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,a=>{this.parse(a,s,o)},n,o)}parse(e,s,n=()=>{}){this.decodeDracoFile(e,s,null,null,vs,n).catch(n)}decodeDracoFile(e,s,n,o,i=rs,a=()=>{}){const r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:o||this.defaultAttributeTypes,useUniqueIDs:!!n,vertexColorSpace:i};return this.decodeGeometry(e,r).then(s).catch(a)}decodeGeometry(e,s){const n=JSON.stringify(s);if(si.has(e)){const l=si.get(e);if(l.key===n)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let o;const i=this.workerNextTaskID++,a=e.byteLength,r=this._getWorker(i,a).then(l=>(o=l,new Promise((c,u)=>{o._callbacks[i]={resolve:c,reject:u},o.postMessage({type:"decode",id:i,taskConfig:s,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return r.catch(()=>!0).then(()=>{o&&i&&this._releaseTask(o,i)}),si.set(e,{key:n,promise:r}),r}_createGeometry(e){const s=new fr;e.index&&s.setIndex(new mn(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const o=e.attributes[n],i=o.name,a=o.array,r=o.itemSize,l=new mn(a,r);i==="color"&&(this._assignVertexColorSpace(l,o.vertexColorSpace),l.normalized=!(a instanceof Float32Array)),s.setAttribute(i,l)}return s}_assignVertexColorSpace(e,s){if(s!==vs)return;const n=new as;for(let o=0,i=e.count;o<i;o++)n.fromBufferAttribute(e,o),li.colorSpaceToWorking(n,vs),e.setXYZ(o,n.r,n.g,n.b)}_loadLibrary(e,s){const n=new eo(this.manager);return n.setPath(this.decoderPath),n.setResponseType(s),n.setWithCredentials(this.withCredentials),new Promise((o,i)=>{n.load(e,o,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",s=[];return e?s.push(this._loadLibrary("draco_decoder.js","text")):(s.push(this._loadLibrary("draco_wasm_wrapper.js","text")),s.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(s).then(n=>{const o=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const i=jp.toString(),a=["/* draco decoder */",o,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(e,s){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const o=new Worker(this.workerSourceURL);o._callbacks={},o._taskCosts={},o._taskLoad=0,o.postMessage({type:"init",decoderConfig:this.decoderConfig}),o.onmessage=function(i){const a=i.data;switch(a.type){case"decode":o._callbacks[a.id].resolve(a);break;case"error":o._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(o)}else this.workerPool.sort(function(o,i){return o._taskLoad>i._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=s,n._taskLoad+=s,n})}_releaseTask(e,s){e._taskLoad-=e._taskCosts[s],delete e._callbacks[s],delete e._taskCosts[s]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function jp(){let t,e;onmessage=function(a){const r=a.data;switch(r.type){case"init":t=r.decoderConfig,e=new Promise(function(u){t.onModuleLoaded=function(d){u({draco:d})},DracoDecoderModule(t)});break;case"decode":const l=r.buffer,c=r.taskConfig;e.then(u=>{const d=u.draco,m=new d.Decoder;try{const h=s(d,m,new Int8Array(l),c),_=h.attributes.map(E=>E.array.buffer);h.index&&_.push(h.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:h},_)}catch(h){console.error(h),self.postMessage({type:"error",id:r.id,error:h.message})}finally{d.destroy(m)}});break}};function s(a,r,l,c){const u=c.attributeIDs,d=c.attributeTypes;let m,h;const _=r.GetEncodedGeometryType(l);if(_===a.TRIANGULAR_MESH)m=new a.Mesh,h=r.DecodeArrayToMesh(l,l.byteLength,m);else if(_===a.POINT_CLOUD)m=new a.PointCloud,h=r.DecodeArrayToPointCloud(l,l.byteLength,m);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!h.ok()||m.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+h.error_msg());const E={index:null,attributes:[]};for(const S in u){const v=self[d[S]];let M,b;if(c.useUniqueIDs)b=u[S],M=r.GetAttributeByUniqueId(m,b);else{if(b=r.GetAttributeId(m,a[u[S]]),b===-1)continue;M=r.GetAttribute(m,b)}const w=o(a,r,m,S,v,M);S==="color"&&(w.vertexColorSpace=c.vertexColorSpace),E.attributes.push(w)}return _===a.TRIANGULAR_MESH&&(E.index=n(a,r,m)),a.destroy(m),E}function n(a,r,l){const u=l.num_faces()*3,d=u*4,m=a._malloc(d);r.GetTrianglesUInt32Array(l,d,m);const h=new Uint32Array(a.HEAPF32.buffer,m,u).slice();return a._free(m),{array:h,itemSize:1}}function o(a,r,l,c,u,d){const m=d.num_components(),_=l.num_points()*m,E=_*u.BYTES_PER_ELEMENT,S=i(a,u),v=a._malloc(E);r.GetAttributeDataArrayForAllPoints(l,d,S,E,v);const M=new u(a.HEAPF32.buffer,v,_).slice();return a._free(v),{name:c,array:M,itemSize:m}}function i(a,r){switch(r){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}class zp{constructor(){this.gltfCache=new Map,this.modelPool=new Map,this.instancedMeshes=new Map,this.gltfLoader=null,this.dracoLoader=null,this.maxCacheSize=50,this.maxInstancesPerModel=1e3,this.preloadStatus=new Map,this.preloadQueue=[],this.initLoaders()}initLoaders(){this.gltfLoader||(this.gltfLoader=new Io,this.gltfLoader.setCrossOrigin("anonymous"),this.dracoLoader=new Oo,this.dracoLoader.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),this.dracoLoader.setCrossOrigin("anonymous"),this.gltfLoader.setDRACOLoader(this.dracoLoader),f("[ModelCache] GLTFDraco"))}async loadModel(e,s=!0){if(s&&this.modelPool.has(e)){const i=this.modelPool.get(e);return f(`[ModelCache] : ${e}`),i.clone(!0)}let n;if(this.gltfCache.has(e))f(`[ModelCache] GLTF: ${e}`),n=this.gltfCache.get(e);else try{const a=await(await Ll(e)).arrayBuffer();f(`[ModelCache] GLTF: ${e}`),n=await new Promise((r,l)=>{this.gltfLoader.parse(a,"",c=>r(c),c=>l(c))}),this.cacheGLTF(e,n)}catch(i){throw f(`[ModelCache] : ${e}`,i),i}const o=n.scene.clone(!0);return s&&this.addToModelPool(e,o),o}async createInstancedMesh(e,s=100){if(this.instancedMeshes.has(e))return f(`[ModelCache] : ${e}`),this.instancedMeshes.get(e);const n=await this.loadModel(e,!0),o=[];if(n.traverse(l=>{l.isMesh&&o.push(l)}),o.length===0)throw new Error(`[ModelCache] : ${e}`);const i=o[0],a=new lr(i.geometry,i.material,s),r=new zs;for(let l=0;l<s;l++)r.setPosition(0,-1e3,0),a.setMatrixAt(l,r);return a.instanceMatrix.needsUpdate=!0,this.instancedMeshes.set(e,a),f(`[ModelCache] : ${e}, : ${s}`),a}updateInstancedMeshInstance(e,s,n,o,i){const a=this.instancedMeshes.get(e);if(!a){f(`[ModelCache] : ${e}`);return}if(s>=a.count){f(`[ModelCache] : ${s}/${a.count}`);return}const r=new zs;r.compose(n,new an().setFromEuler(o),i),a.setMatrixAt(s,r),a.instanceMatrix.needsUpdate=!0}hideInstancedMeshInstance(e,s){const n=this.instancedMeshes.get(e);if(!n)return;const o=new zs;o.setPosition(0,-1e3,0),n.setMatrixAt(s,o),n.instanceMatrix.needsUpdate=!0}cacheGLTF(e,s){if(this.gltfCache.size>=this.maxCacheSize){const n=this.gltfCache.keys().next().value;this.gltfCache.delete(n),f(`[ModelCache] GLTF: ${n}`)}this.gltfCache.set(e,s),f(`[ModelCache] GLTF: ${e}`)}addToModelPool(e,s){if(this.modelPool.size>=this.maxCacheSize){const n=this.modelPool.keys().next().value,o=this.modelPool.get(n);this.disposeModel(o),this.modelPool.delete(n),f(`[ModelCache] : ${n}`)}this.modelPool.set(e,s),f(`[ModelCache] : ${e}`)}async preloadModels(e,s=null){f(`[ModelCache]  ${e.length} `);const n=e.length;let o=0;const i=e.filter(r=>{const l=this.preloadStatus.get(r);return!l||l==="failed"});f(`[ModelCache]  ${i.length} `);const a=3;for(let r=0;r<i.length;r+=a){const c=i.slice(r,r+a).map(async u=>{try{this.preloadStatus.set(u,"loading"),await this.loadModel(u,!0),this.preloadStatus.set(u,"loaded"),o++,s&&s(o,n,Math.round(o/n*100)),f(`[ModelCache] : ${u} (${o}/${n})`)}catch(d){f(`[ModelCache] : ${u}`,d),this.preloadStatus.set(u,"failed"),o++,s&&s(o,n,Math.round(o/n*100))}});await Promise.all(c),r+a<i.length&&await new Promise(u=>setTimeout(u,100))}f(`[ModelCache] : ${o}/${n} `)}isPreloaded(e){return this.preloadStatus.get(e)==="loaded"}getPreloadStatus(){const e={total:this.preloadStatus.size,loaded:0,loading:0,failed:0};for(const s of this.preloadStatus.values())e[s]++;return e}disposeModel(e){e&&e.traverse(s=>{s.isMesh&&(s.geometry&&s.geometry.dispose(),s.material&&(Array.isArray(s.material)?s.material.forEach(n=>{n.map&&n.map.dispose(),n.dispose&&n.dispose()}):(s.material.map&&s.material.map.dispose(),s.material.dispose&&s.material.dispose())))})}clearCache(){f("[ModelCache] ..."),this.modelPool.forEach(e=>{this.disposeModel(e)}),this.modelPool.clear(),this.instancedMeshes.forEach(e=>{this.disposeModel(e)}),this.instancedMeshes.clear(),this.gltfCache.clear(),this.preloadStatus.clear(),f("[ModelCache] ")}getCacheStatus(){return{gltfCacheSize:this.gltfCache.size,modelPoolSize:this.modelPool.size,instancedMeshesSize:this.instancedMeshes.size,preloadStatus:this.getPreloadStatus(),maxCacheSize:this.maxCacheSize,maxInstancesPerModel:this.maxInstancesPerModel,gltfLoaderInitialized:!!this.gltfLoader,dracoLoaderInitialized:!!this.dracoLoader}}updateConfig(e){e.maxCacheSize!==void 0&&(this.maxCacheSize=Math.max(10,e.maxCacheSize)),e.maxInstancesPerModel!==void 0&&(this.maxInstancesPerModel=Math.max(10,e.maxInstancesPerModel)),f("[ModelCache] :",this.getCacheStatus())}}const Ot=new zp,Vp={class:"model-wrapper"},Kp={key:0,class:"model-loading"},Wp={__name:"PuppetModelView",props:{puppet:{type:Object,default:null}},setup(t){const e=t,s=W(null),n=W(!1);let o=null,i=null,a=null,r=0,l=null,c=null,u=new Yc,d=null,m=null,h=0,_=!1;window.__GLTF_MEMORY_CACHE__||(window.__GLTF_MEMORY_CACHE__=new Map,f("[PuppetModelView] Initialized global GLTF memory cache"));function E(){if(_)return;const b=s.value;if(!b){f("[PuppetModelView] Container not ready for Three.js initialization");return}f("[PuppetModelView] Initializing Three.js..."),i=new _o,a=new Ln(45,1,.1,1e3),a.position.set(0,1,3),o=new go({antialias:!0,alpha:!0}),o.setPixelRatio(window.devicePixelRatio||1),o.outputColorSpace=vs,m=new Oo,m.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),m.setCrossOrigin("anonymous"),f("[PuppetModelView] Draco loader initialized:",!!m),b.innerHTML="",b.appendChild(o.domElement);const w=new vo(16777215,1.2),$=new gs(16777215,1.5);$.position.set(3,5,2);const F=new gs(16777215,.8);F.position.set(-2,3,4);const B=new Xs(16777215,1,10);B.position.set(0,2,3),i.add(w,$,F,B);const ee=()=>{if(!b||!o)return;let q=b.clientWidth,P=b.clientHeight;if(!q||!P){const L=b.getBoundingClientRect();if(q=L.width||200,P=L.height||200,!L.width||!L.height){requestAnimationFrame(ee);return}}o.setSize(q,P,!0),a.aspect=q/Math.max(1,P),a.updateProjectionMatrix()};ee(),d=new ResizeObserver(ee),d.observe(b),requestAnimationFrame(()=>{ee(),requestAnimationFrame(()=>{ee(),requestAnimationFrame(ee)})});const Q=()=>{if(!o||!i||!a)return;r=requestAnimationFrame(Q);const q=u.getDelta();c&&c.update(q),l&&(l.rotation.y+=q*.6),o.render(i,a)};Q(),_=!0,f("[PuppetModelView] Three.js initialized successfully, container size:",b.clientWidth,"x",b.clientHeight)}function S(){c&&(c.stopAllAction(),c=null),l&&(i.remove(l),l.traverse(b=>{b.isMesh&&(b.geometry&&b.geometry.dispose(),Array.isArray(b.material)?b.material.forEach(w=>{w.map&&w.map.dispose(),w&&w.dispose&&w.dispose()}):b.material&&(b.material.map&&b.material.map.dispose(),b.material.dispose&&b.material.dispose()))}),l=null)}function v(b){const w=new wt().setFromObject(b),$=new Ae,F=new Ae;w.getSize($),w.getCenter(F),b.position.sub(F),b.position.add(new Ae(0,0,0)),b.scale.multiplyScalar(.8);const ee=o==null?void 0:o.domElement,Q=ee?ee.clientWidth||ee.width:200,q=ee?ee.clientHeight||ee.height:200,P=Math.max(1e-6,Q/Math.max(1,q)),L=a.fov*(Math.PI/180),fe=2*Math.atan(Math.tan(L/2)*P),Te=1.05,Ce=$.y/2/Math.tan(L/2),ve=$.x/2/Math.tan(fe/2),X=Te*Math.max(Ce,ve,.1);a.position.set(0,0,X),a.lookAt(0,0,0)}async function M(b){var F;if(!b)return;f("[PuppetModelView] Loading puppet:",b.name),n.value=!0,E(),S();const w=++h;f("[PuppetModelView] ");let $=b.modelUrl||"";if(f("[PuppetModelView] Original modelUrl:",$),f("[PuppetModelView] Puppet image:",b.image),f("[PuppetModelView] Puppet name:",b.name),f("[PuppetModelView] Puppet data:",b),!$||$.trim()===""){f("[PuppetModelView] No model URL found");return}f("[PuppetModelView] Final Model URL:",$);try{f("[PuppetModelView] Starting to load:",$),f("[PuppetModelView] Cache status:",Ot.getCacheStatus());const B=await Ot.loadModel($);if(f("[PuppetModelView] Model loaded from cache manager:",B),w!==h){f("[PuppetModelView] Ignoring outdated load result for:",b.name),gltf&&gltf.scene&&gltf.scene.traverse(ee=>{ee.isMesh&&(ee.geometry&&ee.geometry.dispose(),Array.isArray(ee.material)?ee.material.forEach(Q=>{Q.map&&Q.map.dispose(),Q.dispose&&Q.dispose()}):ee.material&&(ee.material.map&&ee.material.map.dispose(),ee.material.dispose&&ee.material.dispose()))});return}if(f("[PuppetModelView] Applying model for:",b.name),!i){f("[PuppetModelView] Scene not ready, initializing..."),E();let ee=0;for(;!i&&ee<40;)await new Promise(Q=>setTimeout(Q,50)),ee++;if(!i){f("[PuppetModelView] Scene initialization timeout");return}}if(l=B,!l){f("[PuppetModelView] No model instance received");return}i.add(l),v(l),f("[PuppetModelView] Model loaded successfully:",b.name,"Scene children:",i.children.length),n.value=!1}catch(B){if(f("[PuppetModelView] Load failed:",B),f("[PuppetModelView] Failed URL:",$),f("[PuppetModelView] Puppet data:",b),typeof(B==null?void 0:B.message)=="string"&&B.message.includes("DRACOLoader")){f("[PuppetModelView] Retrying without Draco decoder...");try{const ee=new Io;ee.setCrossOrigin("anonymous");const Q=await ee.loadAsync($);if(w===h&&(l=Q.scene||((F=Q.scenes)==null?void 0:F[0]),l)){i.add(l),Q.animations&&Q.animations.length&&(c=new Xc(l),c.clipAction(Q.animations[0]).play()),v(l),f("[PuppetModelView] Model loaded successfully without Draco:",b.name);return}}catch(ee){f("[PuppetModelView] Fallback load also failed:",ee)}}if(w===h){const ee=new qt(1,1,1),Q=new $t({color:8947967});l=new et(ee,Q),i.add(l),v(l)}n.value=!1}}return It(()=>e.puppet,async b=>{await xn(),M(b)},{immediate:!1}),Et(()=>{f("[PuppetModelView] Component mounted"),xn(()=>{s.value&&(E(),e.puppet&&setTimeout(()=>{M(e.puppet)},0))})}),cs(()=>{if(f("[PuppetModelView] Cleaning up..."),cancelAnimationFrame(r),S(),d&&s.value)try{d.unobserve(s.value)}catch{}const b=i,w=o;o=null,i=null,a=null,_=!1,h=0;const $=()=>{if(f("[PuppetModelView] Starting deferred cleanup..."),b&&b.traverse(F=>{if(F.isMesh)try{if(F.geometry&&F.geometry.dispose(),Array.isArray(F.material))F.material.forEach(B=>{try{B.map&&B.map.dispose(),B.dispose&&B.dispose()}catch{}});else if(F.material)try{F.material.map&&F.material.map.dispose(),F.material.dispose&&F.material.dispose()}catch{}}catch{}}),w)try{w.dispose(),w.forceContextLoss&&w.forceContextLoss()}catch{}f("[PuppetModelView] Deferred cleanup completed")};typeof window<"u"&&window.requestIdleCallback?window.requestIdleCallback($,{timeout:1e3}):setTimeout($,100),f("[PuppetModelView] Quick cleanup completed, heavy cleanup deferred")}),(b,w)=>(I(),U("div",Vp,[p("div",{ref_key:"mountEl",ref:s,class:"model-canvas"},null,512),n.value?(I(),U("div",Kp,[...w[0]||(w[0]=[p("div",{class:"loading-spinner"},null,-1)])])):ye("",!0)]))}},qp=ut(Wp,[["__scopeId","data-v-0e860b93"]]),Xp={class:"warehouse"},Yp={class:"warehouse__resources"},Jp={class:"resource-icon"},Zp=["src","alt"],Qp={class:"resource-value"},eh={class:"resource-tooltip"},th={key:0,class:"warehouse__main"},sh={class:"warehouse__sidebar"},nh={class:"puppet-list"},oh=["onClick","onMouseenter"],ih={class:"puppet-card__quantity"},ah={class:"puppet-card__image"},rh=["src","alt"],lh={class:"puppet-card__info"},ch={class:"puppet-card__name"},uh={class:"puppet-card__level"},dh={class:"puppet-detail__header"},fh={class:"puppet-detail__name"},ph={class:"puppet-detail__content"},hh={class:"puppet-detail__row"},mh={class:"puppet-detail__model"},_h={class:"puppet-detail__description"},gh={class:"puppet-detail__row"},vh={class:"puppet-detail__stats"},yh={class:"stats-section"},bh={class:"stat-item"},wh={class:"stat-value"},Sh={class:"stat-item"},Th={class:"stat-value"},Mh={class:"stat-item"},Ch={class:"stat-value"},Eh={class:"stat-item"},xh={class:"stat-value"},kh={class:"stat-item"},Ah={class:"stat-value"},Rh={class:"stat-item"},$h={class:"stat-value"},Ph={class:"stat-item"},Lh={class:"stat-value"},Ih={class:"equipment-section"},Oh={class:"equipment-slots"},Dh=["src","alt"],Nh=["src"],Gh=["src"],Hh={key:3,class:"equipment-icon"},Uh={key:0,class:"skill-section"},Fh={class:"skill-info"},Bh={class:"skill-text"},jh={class:"skill-name"},zh={class:"skill-cooldown"},Vh={class:"skill-effect"},Kh={class:"skill-icon"},Wh=["src","alt"],qh={key:1},Xh={class:"puppet-detail__upgrade"},Yh={class:"upgrade-cost"},Jh=["src"],Zh={class:"cost-amount"},Qh=["disabled"],em=["src"],tm={class:"warehouse__placeholder",key:"placeholder"},sm=["src"],nm={__name:"Warehouse",props:{musicOn:{type:Boolean,default:!0}},setup(t,{expose:e}){Kt(X=>({v9925b07e:Te,bf2e7e24:fe,bf31385e:q,bf304fa0:P,bf2f66e2:L}));const s=t,n=["SpiritalSpark","RecallGear","ResonantCrystal","RefinedCopper","HeartCrystalDust"];function o(X){return n.map(A=>({icon:Yt[A].icon,name:Yt[A].name,value:Number((X==null?void 0:X[A])??0)}))}const i={IronWall:"",Arcanist:"",CraftsMan:"",Mechanic:"",Resonator:""};function a(X){const A=Number(X??1);return A===1?5:A===2?10:A===3?20:A===4?30:0}function r(X){return(X||[]).map((A,de)=>{var j,H,N,K,oe,Y;const V=(A==null?void 0:A.copper_info)||{},O=(V==null?void 0:V.skill)||{},Z=(A==null?void 0:A.equipment_slot)||{},re=(Z==null?void 0:Z.slot1)||null,Ee=(Z==null?void 0:Z.slot2)||null,Ge=(A==null?void 0:A.attribute)||{},Ue=((j=re==null?void 0:re.equipment_base)==null?void 0:j.attribute)||{},De=((H=Ee==null?void 0:Ee.equipment_base)==null?void 0:H.attribute)||{},Ze=Number(Ue.attack||0)+Number(De.attack||0),ot=Number(Ue.defense||0)+Number(De.defense||0),st=Number(Ue.dodge||0)+Number(De.dodge||0),xt=A==null?void 0:A.copper_type,g=(A==null?void 0:A.level)??1,T=(V==null?void 0:V.model_url)||"",R=T?G(T):"";return{id:Number((A==null?void 0:A.id)??de+1),name:(V==null?void 0:V.name)??"",level:g,suffix:(A==null?void 0:A.suffix)??0,image:G((V==null?void 0:V.icon_url)||""),modelUrl:R,quantity:1,description:(V==null?void 0:V.description)||"",stats:{level:`${g}/5`,health:Number(Ge.health||0),live_left:Number((A==null?void 0:A.live_left)??0),attack:{base:Number(Ge.attack||0),bonus:Ze},defense:{base:Number(Ge.defense||0),bonus:ot},dodge:{base:Number(Ge.dodge||0),bonus:st},class:i[xt]||""},equipment:[re?{name:((N=re.equipment_base)==null?void 0:N.name)||"",icon:G(((K=re.equipment_base)==null?void 0:K.resource_url)||""),equipped:!0,locked:!1}:{name:"",icon:"",equipped:!1,locked:!1},Z!=null&&Z.is_slot2_locked?{name:"",icon:"",equipped:!1,locked:!0}:Ee?{name:((oe=Ee.equipment_base)==null?void 0:oe.name)||"",icon:G(((Y=Ee.equipment_base)==null?void 0:Y.resource_url)||""),equipped:!0,locked:!1}:{name:"",icon:"",equipped:!1,locked:!1}],skill:{name:(O==null?void 0:O.name)||"",cooldown:(O==null?void 0:O.cool_down)!=null?`${O.cool_down}`:"",effect:(O==null?void 0:O.description)||"",icon:G((O==null?void 0:O.resource_url)||"")},upgradeCost:a(g)}})}function l(X,A,de=[]){if(!X||typeof X!="object")return null;if(Object.prototype.hasOwnProperty.call(X,A))return[...de,A];if(Array.isArray(X)){for(let V=0;V<X.length;V++){const O=l(X[V],A,[...de,V]);if(O)return O}return null}for(const V of Object.keys(X)){const O=l(X[V],A,[...de,V]);if(O)return O}return null}function c(X,A){return A.reduce((de,V)=>de!=null?de[V]:void 0,X)}const u=W([]);async function d(){try{const X=await Lo();X&&(u.value=o(X))}catch(X){console.error("[Warehouse] :",X),u.value=o({})}}Et(()=>{d(),Po(Pt.UPDATE_RESOURCES,d)});function m(X){let A=X;if(typeof X=="string")try{A=JSON.parse(X)}catch{}A&&A.type_msg&&(A.type_msg==="upgrade_cost_error"?alert(A.content||""):f("[GlobalInfo]",A))}Et(()=>{try{Nl(m)}catch{}s.musicOn&&Ce.value&&setTimeout(()=>{if(Ce.value.readyState>=2)Ce.value.play().then(()=>{f("[Warehouse] ")}).catch(A=>{f("[Warehouse] :",A)});else{const A=()=>{Ce.value.play().then(()=>{f("[Warehouse] ")}).catch(de=>{f("[Warehouse] :",de)}),Ce.value.removeEventListener("canplay",A)};Ce.value.addEventListener("canplay",A,{once:!0})}},200)}),It(()=>s.musicOn,X=>{if(Ce.value)if(X)if(Ce.value.readyState>=2)Ce.value.play().catch(A=>{f("[Warehouse] :",A)});else{const A=()=>{Ce.value.play().catch(de=>{f("[Warehouse] :",de)}),Ce.value.removeEventListener("canplay",A)};Ce.value.addEventListener("canplay",A)}else Ce.value.pause()}),cs(()=>{Ce.value&&Ce.value.pause(),qi(Pt.UPDATE_RESOURCES,d)});const h=W([]);Et(async()=>{try{const X=await Qn();let A=X&&Array.isArray(X.coppers)?X.coppers:[];if(!Array.isArray(A)){const de=l(X,"coppers");if(f("[Warehouse] copper key path:",de),de){const V=c(X,de);f("[Warehouse] copper found by path:",V),Array.isArray(V)&&(A=V)}!Array.isArray(A)&&X&&X.entries&&f("[Warehouse] copper entries sample:",X.entries)}Array.isArray(A)||f("[Warehouse] copper list not array"),h.value=r(A),Array.isArray(h.value)&&h.value.length>0&&(_.value=h.value[0]),!_.value&&Array.isArray(h.value)&&h.value.length>0&&(_.value=h.value[0])}catch{h.value=[]}});const _=W(null),E=W([]),S=W(null),v=W(null),M=W(null);function b(X,A){X&&(E.value[A]=X)}async function w(X,A){_.value=X,await xn();const de=E.value[A];if(de&&typeof de.scrollIntoView=="function"&&de.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"}),S.value=A,v.value)try{v.value.scrollTo({top:0,behavior:"smooth"})}catch{v.value.scrollTop=0}setTimeout(()=>{S.value===A&&(S.value=null)},320)}const $=W(!1);function F(){$.value=!0}function B(){return $.value?($.value=!1,!0):!1}e({handleBack:B});async function ee(X){try{await d();const A=await Qn(),de=Array.isArray(A==null?void 0:A.coppers)?A.coppers:[];h.value=r(de)}catch{}}async function Q(){if(!_.value)return;if(Number(_.value.level||0)>=5){alert("");return}const X=_.value.id,A=await Vf(X);if(!A||A.type!=="success"){alert(A&&A.content?A.content:"");return}try{await d();const de=await Qn(),V=Array.isArray(de==null?void 0:de.coppers)?de.coppers:[];h.value=r(V);const O=h.value.find(Z=>Z.id===X);O&&(_.value=O)}catch{}}const q=`url('${G("@assets/ui/panel2.png")}')`,P=`url('${G("@assets/ui/panel3.png")}')`,L=`url('${G("@assets/ui/panel4.png")}')`,fe=`url('${G("@assets/ui/panel5.png")}')`,Te=`url('${G("@assets/frontend_resource/Gemini_Generated_Image_e03q5oe03q5oe03q.png")}')`,Ce=W(null),ve=G("assets/warehouse.mp3");return(X,A)=>(I(),U("div",Xp,[p("div",Yp,[(I(!0),U(We,null,Vt(u.value,de=>(I(),U("div",{class:"resource-item",key:de.name},[p("div",Jp,[p("img",{src:de.icon,alt:de.name},null,8,Zp)]),p("div",Qp,se(de.value),1),p("div",eh,se(de.name),1)]))),128))]),$.value?ye("",!0):(I(),U("div",th,[p("div",sh,[A[2]||(A[2]=p("div",{class:"warehouse__title"},"",-1)),p("div",nh,[(I(!0),U(We,null,Vt(h.value,(de,V)=>{var O;return I(),U("div",{class:Ye(["puppet-card",{"puppet-card--selected":((O=_.value)==null?void 0:O.id)===de.id,"puppet-card--pulse":S.value===V,"puppet-card--hover":M.value===V}]),key:de.id,ref_for:!0,ref:Z=>b(Z,V),onClick:Z=>w(de,V),onMouseenter:Z=>M.value=V,onMouseleave:A[0]||(A[0]=Z=>M.value=null)},[p("div",ih,se(de.level),1),p("div",ah,[p("img",{src:de.image,alt:de.name},null,8,rh)]),p("div",lh,[p("div",ch,se(de.name)+se(de.suffix),1),p("div",uh,se(de.level)+"",1)])],42,oh)}),128)),p("div",{class:"puppet-card puppet-card--add",onClick:F},[...A[1]||(A[1]=[p("div",{class:"puppet-card__add-icon"},"+",-1),p("div",{class:"puppet-card__add-text"},"",-1)])])])]),p("div",{class:"warehouse__detail",ref_key:"detailWrap",ref:v},[tt(nf,{name:"fade-slide",mode:"out-in"},{default:Wr(()=>{var de,V,O,Z;return[_.value?(I(),U("div",{class:"puppet-detail",key:((de=_.value)==null?void 0:de.id)||"none"},[p("div",dh,[p("h2",fh,se(_.value.name),1)]),p("div",ph,[p("div",hh,[p("div",mh,[tt(qp,{puppet:_.value},null,8,["puppet"])]),p("div",_h,se(_.value.description),1)]),p("div",gh,[p("div",vh,[p("div",yh,[p("div",bh,[A[3]||(A[3]=p("span",{class:"stat-label"},":",-1)),p("span",wh,se(_.value.stats.health),1)]),p("div",Sh,[A[4]||(A[4]=p("span",{class:"stat-label"},":",-1)),p("span",Th,se(_.value.stats.level),1)]),p("div",Mh,[A[5]||(A[5]=p("span",{class:"stat-label"},":",-1)),p("span",Ch,se(_.value.stats.live_left),1)]),p("div",Eh,[A[6]||(A[6]=p("span",{class:"stat-label"},":",-1)),p("span",xh,se(_.value.stats.attack.base),1)]),p("div",kh,[A[7]||(A[7]=p("span",{class:"stat-label"},":",-1)),p("span",Ah,se(_.value.stats.defense.base),1)]),p("div",Rh,[A[8]||(A[8]=p("span",{class:"stat-label"},":",-1)),p("span",$h,se(_.value.stats.dodge.base)+"% ",1)]),p("div",Ph,[A[9]||(A[9]=p("span",{class:"stat-label"},":",-1)),p("span",Lh,se(_.value.stats.class),1)])])]),p("div",Ih,[A[10]||(A[10]=p("h4",{class:"section-title"},"",-1)),p("div",Oh,[(I(!0),U(We,null,Vt(_.value.equipment,(re,Ee)=>(I(),U("div",{key:Ee,class:Ye(["equipment-slot",{"equipment-slot--empty":!re.equipped&&!re.locked,"equipment-slot--locked":re.locked}])},[re.equipped&&re.icon&&(re.icon.startsWith("/")||re.icon.startsWith("http"))?(I(),U("img",{key:0,src:re.icon,alt:re.name,class:"equipment-icon"},null,8,Dh)):re.locked?(I(),U("img",{key:1,src:ue(G)("@assets/ui/lock.png"),alt:"",class:"equipment-icon"},null,8,Nh)):re.icon===""?(I(),U("img",{key:2,src:ue(G)("@assets/ui/jia.png"),alt:"",class:"equipment-icon"},null,8,Gh)):(I(),U("span",Hh,se(re.icon),1))],2))),128))])])]),((O=(V=_.value)==null?void 0:V.stats)==null?void 0:O.class)!==""?(I(),U("div",Uh,[A[11]||(A[11]=p("h4",{class:"section-title"},"",-1)),p("div",Fh,[p("div",Bh,[p("div",jh,se(_.value.skill.name),1),p("div",zh," : "+se(_.value.skill.cooldown),1),p("div",Vh,se(_.value.skill.effect),1)]),p("div",Kh,[_.value.skill.icon&&(_.value.skill.icon.startsWith("/")||_.value.skill.icon.startsWith("http"))?(I(),U("img",{key:0,src:_.value.skill.icon,alt:_.value.skill.name,class:"skill-icon-img"},null,8,Wh)):(I(),U("span",qh,se(_.value.skill.icon),1))])])])):ye("",!0)]),p("div",Xh,[p("div",Yh,[_.value.level<5?(I(),U("img",{key:0,src:ue(Yt).SpiritalSpark.icon,alt:"",class:"cost-icon-img"},null,8,Jh)):ye("",!0),p("span",Zh,se(_.value.level>=5?"":"X "+_.value.upgradeCost),1)]),p("button",{class:"upgrade-btn",onClick:Q,disabled:((Z=_.value)==null?void 0:Z.level)>=5},[p("img",{src:ue(G)("@assets/ui/upgrade.png"),class:"upgrade-icon",alt:""},null,8,em)],8,Qh)])])):(I(),U("div",tm,[...A[12]||(A[12]=[p("p",null,"",-1)])]))]}),_:1})],512)])),$.value?(I(),Lt(lp,{key:1,onDraw:ee})):ye("",!0),p("audio",{ref_key:"audioRef",ref:Ce,src:ue(ve),loop:"",preload:"auto"},null,8,sm)]))}},om=ut(nm,[["__scopeId","data-v-228931f6"]]),im={class:"panel",style:{left:"24px",right:"auto"}},am=["title"],rm={key:0,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},lm={key:1,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},cm={class:"sr-only"},um={__name:"TopLeftPanel",props:{musicOn:{type:Boolean,default:!0}},emits:["back","open-settings","toggle-music"],setup(t,{emit:e}){return(s,n)=>(I(),U("div",im,[p("button",{class:"btn",onClick:n[0]||(n[0]=o=>s.$emit("back")),title:""},[...n[3]||(n[3]=[p("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[p("path",{d:"M15 18L9 12L15 6",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),p("span",{class:"sr-only"},"",-1)])]),p("button",{class:"btn",onClick:n[1]||(n[1]=o=>s.$emit("toggle-music")),title:t.musicOn?"":""},[t.musicOn?(I(),U("svg",rm,[...n[4]||(n[4]=[p("path",{d:"M9 18V5L21 3V16",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),p("circle",{cx:"6",cy:"18",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1),p("circle",{cx:"18",cy:"16",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1)])])):(I(),U("svg",lm,[...n[5]||(n[5]=[p("path",{d:"M9 18V5L21 3V16",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),p("circle",{cx:"6",cy:"18",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1),p("circle",{cx:"18",cy:"16",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1),p("line",{x1:"2",y1:"2",x2:"22",y2:"22",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round"},null,-1)])])),p("span",cm,se(t.musicOn?"":""),1)],8,am),p("button",{class:"btn",onClick:n[2]||(n[2]=o=>s.$emit("open-settings")),title:""},[...n[6]||(n[6]=[p("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[p("path",{d:"M12 15.5C13.933 15.5 15.5 13.933 15.5 12C15.5 10.067 13.933 8.5 12 8.5C10.067 8.5 8.5 10.067 8.5 12C8.5 13.933 10.067 15.5 12 15.5Z",stroke:"#ffffff","stroke-width":"2"}),p("path",{d:"M19.4 15A7.964 7.964 0 0 0 20 12C20 11.49 19.95 10.99 19.86 10.5L22 8.5L20 5.5L17.34 6.07C16.78 5.58 16.14 5.18 15.44 4.9L15 2H9L8.56 4.9C7.86 5.18 7.22 5.58 6.66 6.07L4 5.5L2 8.5L4.14 10.5C4.05 10.99 4 11.49 4 12C4 12.51 4.05 13.01 4.14 13.5L2 15.5L4 18.5L6.66 17.93C7.22 18.42 7.86 18.82 8.56 19.1L9 22H15L15.44 19.1C16.14 18.82 16.78 18.42 17.34 17.93L20 18.5L22 15.5L19.86 13.5C19.95 13.01 20 12.51 20 12",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),p("span",{class:"sr-only"},"",-1)])])]))}},Za=ut(um,[["__scopeId","data-v-8380a348"]]),dm=["automatic_loading_gun","charging_coil","heart_source_mineral_drill","mirro_light_refraction_tower","repair_workshop","resonance_alarm_bell","rivet_barrier","steam_mining_car","storm_anvil"];function fm(){const t=[],e=[{type:"arcanist",name:"bubble"},{type:"craftsman",name:"coil"},{type:"iron_wall",name:"bell"},{type:"mechanic",name:"gyro"},{type:"resonator",name:"clawster"}];for(const n of e){const o=Ro(n.type,n.name);t.push(o)}const s=["goblin","guard","demon"];for(const n of s){const o=$o(n);t.push(o)}return f(`[ModelPreloadConfig]  ${t.length} URL`),t}function pm(){const t=[],e=[{type:"arcanist",name:"glimmer"},{type:"arcanist",name:"spark"},{type:"craftsman",name:"artifex"},{type:"craftsman",name:"wrench"},{type:"iron_wall",name:"chief"},{type:"iron_wall",name:"rocky"},{type:"mechanic",name:"karin"},{type:"mechanic",name:"tricky"},{type:"resonator",name:"diggs"},{type:"resonator",name:"hive"}];for(const n of e){const o=Ro(n.type,n.name);t.push(o)}const s=["assassin","boxer","cruiser","devourer","glutton"];for(const n of s){const o=$o(n);t.push(o)}return f(`[ModelPreloadConfig]  ${t.length} URL`),t}function hm(){const t=[],e=[{type:"arcanist",name:"syrup"},{type:"arcanist",name:"turner"},{type:"craftsman",name:"drillbit"},{type:"craftsman",name:"quickhand"},{type:"iron_wall",name:"tumble"},{type:"iron_wall",name:"wesley"},{type:"mechanic",name:"pendulum"},{type:"mechanic",name:"yoyo"},{type:"resonator",name:"melody"},{type:"resonator",name:"murmur"}];for(const n of e){const o=Ro(n.type,n.name);t.push(o)}const s=["horn","mirror","scout","shatra","variant"];for(const n of s){const o=$o(n);t.push(o)}for(const n of dm){const o=Il(n);t.push(o)}return f(`[ModelPreloadConfig]  ${t.length} URL`),t}function mm(t=["high","medium"]){const e=[];for(const n of t)switch(n){case"high":e.push(...fm());break;case"medium":e.push(...pm());break;case"low":e.push(...hm());break}const s=[...new Set(e)];return f(`[ModelPreloadConfig]  ${t.join(", ")}  ${s.length} URL`),s}class _m{constructor(){this.isPreloading=!1,this.preloadProgress=0,this.preloadCallbacks=[]}async startPreload(e=["high","medium"],s=null){if(this.isPreloading){f("[ModelPreloadManager] ");return}this.isPreloading=!0,this.preloadProgress=0;try{const n=mm(e);f(`[ModelPreloadManager]  ${n.length}  (: ${e.join(", ")})`),s&&this.preloadCallbacks.push(s),await Ot.preloadModels(n,(o,i,a)=>{this.preloadProgress=a,this.notifyProgress(o,i,a)}),f("[ModelPreloadManager] ")}catch(n){f("[ModelPreloadManager] :",n)}finally{this.isPreloading=!1,this.preloadCallbacks=[]}}notifyProgress(e,s,n){this.preloadCallbacks.forEach(o=>{try{o(e,s,n)}catch(i){f("[ModelPreloadManager] :",i)}})}getStatus(){return{isPreloading:this.isPreloading,progress:this.preloadProgress,cacheStatus:Ot.getCacheStatus()}}isModelPreloaded(e){return Ot.isPreloaded(e)}async preloadModel(e){try{await Ot.loadModel(e,!0),f(`[ModelPreloadManager] : ${e}`)}catch(s){f(`[ModelPreloadManager] : ${e}`,s)}}async preloadModels(e){const s=e.map(n=>this.preloadModel(n));await Promise.all(s),f(`[ModelPreloadManager] : ${e.length} `)}}const Qa=new _m,Ul="mgpic_game_settings",er={controlMode:"touchpad",mouseSensitivity:.002};function Do(){try{const t=localStorage.getItem(Ul);if(t){const e=JSON.parse(t);return{...er,...e}}}catch(t){console.error("[GameSettings] :",t)}return{...er}}function gm(t){try{return localStorage.setItem(Ul,JSON.stringify(t)),!0}catch(e){return console.error("[GameSettings] :",e),!1}}function tr(t){return Do()[t]}function Fl(t,e){const s=Do();return s[t]=e,gm(s)}const vm={class:"startmenu"},ym={key:0,class:"settings-local"},bm={class:"settings-local__card"},wm={class:"settings-local__content"},Sm={class:"settings-local__row"},Tm={class:"setting-options"},Mm={__name:"StartMenu",props:{visible:{type:Boolean,default:!0}},emits:["started"],setup(t,{emit:e}){Kt(P=>({v21ff84e0:E}));const s=t,n=W(null);let o=null,i=null,a=null,r=null,l=null,c=1.2;const u=W(!1),d=W(!1),m=W(!1),h=W("touchpad"),_=W(G("ui/Gemini_Generated_Image_gtrehogtrehogtre (1).png")),E=`url('${G("@assets/ui/panel4.png")}')`,S=e;It(()=>s.visible,P=>{P&&o&&l?w():P||b()});function v(){if(r=requestAnimationFrame(v),l){const P=Date.now()*.001;l.position.y=Math.sin(P*.8)*.1,l.rotation.y=Math.sin(P*.6)*.1;const L=c+Math.sin(P*1.2)*.04;l.scale.setScalar(L)}a&&a.render(o,i)}function M(){!a||!i||(i.aspect=window.innerWidth/window.innerHeight,i.updateProjectionMatrix(),a.setSize(window.innerWidth,window.innerHeight))}function b(){r&&(cancelAnimationFrame(r),r=null),a&&a.setAnimationLoop(null)}function w(){r||v()}function $(){try{b()}catch{}try{window.removeEventListener("resize",M)}catch{}try{o&&(o.traverse(P=>{if(P.isMesh){P.geometry&&P.geometry.dispose&&P.geometry.dispose();const L=P.material;Array.isArray(L)?L.forEach(fe=>fe&&fe.dispose&&fe.dispose()):L&&L.dispose&&L.dispose()}}),o.clear())}catch{}try{if(a){a.clear(!0,!0,!0),a.dispose();const P=a.getContext&&a.getContext(),L=P&&P.getExtension&&P.getExtension("WEBGL_lose_context");L&&L.loseContext&&L.loseContext()}}catch{}o=null,i=null,a=null,l=null}async function F(P=null){try{window.getAssetUrl=G,window.precacheAllResources=Mi,window.getCacheStatus=Pf}catch{}if(!o||!a){f("[StartMenu] Scene or renderer not initialized in onMounted");return}if(P&&P(0,100,20),!o.children.some(Te=>Te.isLight)){const Te=new vo(4210752,.4);o.add(Te);const Ce=new gs(16777215,12.5);Ce.position.set(-5,-2,1),o.add(Ce)}P&&P(0,100,50);const fe=G("logo.glb");try{P&&P(0,100,60),f("[StartMenu] Logo...");const Te=await Ot.loadModel(fe,!0);P&&P(0,100,80),Te.position.set(0,0,0),o.add(Te);const ve=new wt().setFromObject(Te).getCenter(new Ae);Te.position.set(-ve.x,-ve.y,-ve.z-.3);try{Te.scale.setScalar(c)}catch{}l=Te,P&&P(0,100,80),f("[StartMenu] Logo ...");try{await Qa.startPreload(["high","medium"],(X,A,de)=>{const V=80+de*.15;P&&P(0,100,Math.round(V)),f(`[StartMenu] : ${X}/${A} (${de}%)`)}),f("[StartMenu] ")}catch(X){f("[StartMenu] :",X)}P&&P(0,100,100),u.value=!0,f("[StartMenu] "),d.value=!0}catch(Te){f("[StartMenu] 3D",Te);const Ce=new qt(1,1,1),ve=new Ct({color:16096779}),X=new et(Ce,ve);o.add(X),l=X,f("[StartMenu] ...");try{await Qa.startPreload(["high","medium"],(A,de,V)=>{const O=80+V*.15;P&&P(0,100,Math.round(O)),f(`[StartMenu] : ${A}/${de} (${V}%)`)}),f("[StartMenu] ")}catch(A){f("[StartMenu] :",A)}P&&P(0,100,100),u.value=!0,f("[StartMenu] "),d.value=!0}window.__START_MENU_PAUSE__=()=>b(),window.__START_MENU_RESUME__=()=>w()}function B(){S("started"),b()}function ee(){const P=Do();h.value=P.controlMode,m.value=!0}function Q(){m.value=!1}function q(P){h.value=P,Fl("controlMode",P),window.updateControlMode&&window.updateControlMode(P),f(`[StartMenu] : ${P}`)}return Et(()=>{d.value=!1,u.value=!1,f("[StartMenu] ..."),!o&&n.value?(o=new _o,o.background=null,i=new Ln(50,window.innerWidth/window.innerHeight,.1,1e3),i.position.set(-3.655,.2,-.006),i.rotation.set(-1.618275,-1.538307,-1.6183,"XYZ"),a=new go({antialias:!0,alpha:!0,canvas:n.value}),a.setSize(window.innerWidth,window.innerHeight),a.setPixelRatio(window.devicePixelRatio),a.setClearColor(0,0),window.addEventListener("resize",M),v(),f("[StartMenu] ")):o&&!l?f("[StartMenu] "):l&&(f("[StartMenu] Logo"),d.value=!0,u.value=!0),window.__INIT_THREE_SCENE__=async P=>{if(o&&l){f("[StartMenu] Logo"),d.value=!0,u.value=!0;return}f("[StartMenu] 3D..."),await F(P)}}),cs(()=>{$()}),(P,L)=>(I(),U("div",vm,[p("div",{class:"startmenu__bg",style:Ft({backgroundImage:`url('${_.value}')`})},null,4),p("canvas",{ref_key:"canvasRef",ref:n,class:"startmenu__canvas"},null,512),qr(p("div",{class:Ye(["startmenu-ui",{"fade-in":d.value}])},[p("button",{id:"start-btn",class:"startmenu-btn","aria-label":"",onClick:B},"  "),p("button",{id:"settings-btn",class:"startmenu-btn","aria-label":"",onClick:ee},"  ")],2),[[$l,d.value]]),m.value?(I(),U("div",ym,[p("div",bm,[p("div",{class:"settings-local__header"},[L[2]||(L[2]=p("div",{class:"settings-local__title"},"",-1)),p("button",{class:"settings-local__close",onClick:Q,"aria-label":""},"  ")]),p("div",wm,[p("div",Sm,[L[5]||(L[5]=p("div",{class:"setting-label"},"",-1)),p("div",Tm,[p("button",{class:Ye(["option-btn",{active:h.value==="touchpad"}]),onClick:L[0]||(L[0]=fe=>q("touchpad"))},[...L[3]||(L[3]=[p("span",{class:"option-title"},"",-1),p("span",{class:"option-desc"},"",-1)])],2),p("button",{class:Ye(["option-btn",{active:h.value==="mouse"}]),onClick:L[1]||(L[1]=fe=>q("mouse"))},[...L[4]||(L[4]=[p("span",{class:"option-title"},"",-1),p("span",{class:"option-desc"},"",-1)])],2)])])])])])):ye("",!0)]))}},Cm=ut(Mm,[["__scopeId","data-v-2b74aa33"]]),sr={type:"change"},Xi={type:"start"},Bl={type:"end"},Wn=new Zc,nr=new mr,Em=Math.cos(70*pr.DEG2RAD),ct=new Ae,kt=2*Math.PI,Ve={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},ni=1e-6;class xm extends Jc{constructor(e,s=null){super(e,s),this.state=Ve.NONE,this.target=new Ae,this.cursor=new Ae,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Js.ROTATE,MIDDLE:Js.DOLLY,RIGHT:Js.PAN},this.touches={ONE:Ys.ROTATE,TWO:Ys.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new Ae,this._lastQuaternion=new an,this._lastTargetPosition=new Ae,this._quat=new an().setFromUnitVectors(e.up,new Ae(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new ia,this._sphericalDelta=new ia,this._scale=1,this._panOffset=new Ae,this._rotateStart=new At,this._rotateEnd=new At,this._rotateDelta=new At,this._panStart=new At,this._panEnd=new At,this._panDelta=new At,this._dollyStart=new At,this._dollyEnd=new At,this._dollyDelta=new At,this._dollyDirection=new Ae,this._mouse=new At,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Am.bind(this),this._onPointerDown=km.bind(this),this._onPointerUp=Rm.bind(this),this._onContextMenu=Nm.bind(this),this._onMouseWheel=Lm.bind(this),this._onKeyDown=Im.bind(this),this._onTouchStart=Om.bind(this),this._onTouchMove=Dm.bind(this),this._onMouseDown=$m.bind(this),this._onMouseMove=Pm.bind(this),this._interceptControlDown=Gm.bind(this),this._interceptControlUp=Hm.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(sr),this.update(),this.state=Ve.NONE}update(e=null){const s=this.object.position;ct.copy(s).sub(this.target),ct.applyQuaternion(this._quat),this._spherical.setFromVector3(ct),this.autoRotate&&this.state===Ve.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,o=this.maxAzimuthAngle;isFinite(n)&&isFinite(o)&&(n<-Math.PI?n+=kt:n>Math.PI&&(n-=kt),o<-Math.PI?o+=kt:o>Math.PI&&(o-=kt),n<=o?this._spherical.theta=Math.max(n,Math.min(o,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+o)/2?Math.max(n,this._spherical.theta):Math.min(o,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let i=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const a=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),i=a!=this._spherical.radius}if(ct.setFromSpherical(this._spherical),ct.applyQuaternion(this._quatInverse),s.copy(this.target).add(ct),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let a=null;if(this.object.isPerspectiveCamera){const r=ct.length();a=this._clampDistance(r*this._scale);const l=r-a;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),i=!!l}else if(this.object.isOrthographicCamera){const r=new Ae(this._mouse.x,this._mouse.y,0);r.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),i=l!==this.object.zoom;const c=new Ae(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(r),this.object.updateMatrixWorld(),a=ct.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;a!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(a).add(this.object.position):(Wn.origin.copy(this.object.position),Wn.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(Wn.direction))<Em?this.object.lookAt(this.target):(nr.setFromNormalAndCoplanarPoint(this.object.up,this.target),Wn.intersectPlane(nr,this.target))))}else if(this.object.isOrthographicCamera){const a=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),a!==this.object.zoom&&(this.object.updateProjectionMatrix(),i=!0)}return this._scale=1,this._performCursorZoom=!1,i||this._lastPosition.distanceToSquared(this.object.position)>ni||8*(1-this._lastQuaternion.dot(this.object.quaternion))>ni||this._lastTargetPosition.distanceToSquared(this.target)>ni?(this.dispatchEvent(sr),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?kt/60*this.autoRotateSpeed*e:kt/60/60*this.autoRotateSpeed}_getZoomScale(e){const s=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*s)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,s){ct.setFromMatrixColumn(s,0),ct.multiplyScalar(-e),this._panOffset.add(ct)}_panUp(e,s){this.screenSpacePanning===!0?ct.setFromMatrixColumn(s,1):(ct.setFromMatrixColumn(s,0),ct.crossVectors(this.object.up,ct)),ct.multiplyScalar(e),this._panOffset.add(ct)}_pan(e,s){const n=this.domElement;if(this.object.isPerspectiveCamera){const o=this.object.position;ct.copy(o).sub(this.target);let i=ct.length();i*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*i/n.clientHeight,this.object.matrix),this._panUp(2*s*i/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(s*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,s){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),o=e-n.left,i=s-n.top,a=n.width,r=n.height;this._mouse.x=o/a*2-1,this._mouse.y=-(i/r)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const s=this.domElement;this._rotateLeft(kt*this._rotateDelta.x/s.clientHeight),this._rotateUp(kt*this._rotateDelta.y/s.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let s=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(kt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),s=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-kt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),s=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(kt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),s=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-kt*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),s=!0;break}s&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const s=this._getSecondPointerPosition(e),n=.5*(e.pageX+s.x),o=.5*(e.pageY+s.y);this._rotateStart.set(n,o)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const s=this._getSecondPointerPosition(e),n=.5*(e.pageX+s.x),o=.5*(e.pageY+s.y);this._panStart.set(n,o)}}_handleTouchStartDolly(e){const s=this._getSecondPointerPosition(e),n=e.pageX-s.x,o=e.pageY-s.y,i=Math.sqrt(n*n+o*o);this._dollyStart.set(0,i)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),o=.5*(e.pageX+n.x),i=.5*(e.pageY+n.y);this._rotateEnd.set(o,i)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const s=this.domElement;this._rotateLeft(kt*this._rotateDelta.x/s.clientHeight),this._rotateUp(kt*this._rotateDelta.y/s.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const s=this._getSecondPointerPosition(e),n=.5*(e.pageX+s.x),o=.5*(e.pageY+s.y);this._panEnd.set(n,o)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const s=this._getSecondPointerPosition(e),n=e.pageX-s.x,o=e.pageY-s.y,i=Math.sqrt(n*n+o*o);this._dollyEnd.set(0,i),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const a=(e.pageX+s.x)*.5,r=(e.pageY+s.y)*.5;this._updateZoomParameters(a,r)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let s=0;s<this._pointers.length;s++)if(this._pointers[s]==e.pointerId){this._pointers.splice(s,1);return}}_isTrackingPointer(e){for(let s=0;s<this._pointers.length;s++)if(this._pointers[s]==e.pointerId)return!0;return!1}_trackPointer(e){let s=this._pointerPositions[e.pointerId];s===void 0&&(s=new At,this._pointerPositions[e.pointerId]=s),s.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const s=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[s]}_customWheelEvent(e){const s=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(s){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function km(t){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(t.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(t)&&(this._addPointer(t),t.pointerType==="touch"?this._onTouchStart(t):this._onMouseDown(t)))}function Am(t){this.enabled!==!1&&(t.pointerType==="touch"?this._onTouchMove(t):this._onMouseMove(t))}function Rm(t){switch(this._removePointer(t),this._pointers.length){case 0:this.domElement.releasePointerCapture(t.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(Bl),this.state=Ve.NONE;break;case 1:const e=this._pointers[0],s=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:s.x,pageY:s.y});break}}function $m(t){let e;switch(t.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Js.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(t),this.state=Ve.DOLLY;break;case Js.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(t),this.state=Ve.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(t),this.state=Ve.ROTATE}break;case Js.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(t),this.state=Ve.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(t),this.state=Ve.PAN}break;default:this.state=Ve.NONE}this.state!==Ve.NONE&&this.dispatchEvent(Xi)}function Pm(t){switch(this.state){case Ve.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(t);break;case Ve.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(t);break;case Ve.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(t);break}}function Lm(t){this.enabled===!1||this.enableZoom===!1||this.state!==Ve.NONE||(t.preventDefault(),this.dispatchEvent(Xi),this._handleMouseWheel(this._customWheelEvent(t)),this.dispatchEvent(Bl))}function Im(t){this.enabled!==!1&&this._handleKeyDown(t)}function Om(t){switch(this._trackPointer(t),this._pointers.length){case 1:switch(this.touches.ONE){case Ys.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(t),this.state=Ve.TOUCH_ROTATE;break;case Ys.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(t),this.state=Ve.TOUCH_PAN;break;default:this.state=Ve.NONE}break;case 2:switch(this.touches.TWO){case Ys.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(t),this.state=Ve.TOUCH_DOLLY_PAN;break;case Ys.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(t),this.state=Ve.TOUCH_DOLLY_ROTATE;break;default:this.state=Ve.NONE}break;default:this.state=Ve.NONE}this.state!==Ve.NONE&&this.dispatchEvent(Xi)}function Dm(t){switch(this._trackPointer(t),this.state){case Ve.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(t),this.update();break;case Ve.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(t),this.update();break;case Ve.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(t),this.update();break;case Ve.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(t),this.update();break;default:this.state=Ve.NONE}}function Nm(t){this.enabled!==!1&&t.preventDefault()}function Gm(t){t.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Hm(t){t.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const Um={class:"startgame-modal"},Fm={class:"card"},Bm={class:"card__header"},jm=["src"],zm={class:"card__body"},Vm={class:"card__content"},Km={key:0,class:"loading"},Wm={key:1,class:"error"},qm={key:2,class:"list"},Xm=["onClick"],Ym={class:"item__img"},Jm=["src","alt"],Zm={class:"item__meta"},Qm={class:"item__name"},e_={class:"item__level"},t_={class:"preview"},s_={class:"preview__info"},n_={key:0,class:"preview__empty"},o_={key:1,class:"preview__names"},i_={class:"preview__name-number"},a_={class:"preview__name-text"},r_={class:"card__footer"},l_=["disabled"],c_=["src"],u_={__name:"StartGame",props:{musicOn:{type:Boolean,default:!0},paused:{type:Boolean,default:!1}},emits:["confirm","close"],setup(t,{emit:e}){Kt(O=>({aa824e20:fe,aa807ca4:Ce,aa7b0830:de,a5e82c30:V,aa7dc26a:ve,aa7bf0ee:A,aa816562:Te,aa7cd9ac:X}));const s=e,n=t,o=W(!0),i=W(""),a=W([]),r=W(new Set),l=W(null),c=W(null),u=G("@assets/frontend_resource/startgame.mp3");let d,m,h,_,E;const S=new Map,v=Pe(()=>r.value.size===3),M=Pe(()=>a.value.filter(O=>r.value.has(O.id)));function b(){if(!l.value)return;d=new _o,d.background=new as(1710618),m=new Ln(45,l.value.clientWidth/l.value.clientHeight,.1,100),m.position.set(0,3,8),h=new go({antialias:!0}),h.setSize(l.value.clientWidth,l.value.clientHeight),h.setPixelRatio(window.devicePixelRatio),l.value.appendChild(h.domElement),_=new xm(m,h.domElement),_.enableDamping=!0,_.dampingFactor=.05,_.target.set(0,1,0);const O=new vo(16777215,.5);d.add(O);const Z=new gs(16777215,1);Z.position.set(0,5,10),d.add(Z);const re=new gs(11193599,.4);re.position.set(-5,3,5),d.add(re);const Ee=new gs(16764074,.4);Ee.position.set(5,3,5),d.add(Ee);const Ge=new gs(16777215,.3);Ge.position.set(0,5,-5),d.add(Ge);const Ue=new to(20,20),De=new $t({color:2763306,side:ks}),Ze=new et(Ue,De);Ze.rotation.x=-Math.PI/2,Ze.position.y=0,d.add(Ze),E=new Io;const ot=new Oo;ot.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),E.setDRACOLoader(ot),w(),window.addEventListener("resize",$)}function w(){requestAnimationFrame(w),_&&_.update(),h&&d&&m&&h.render(d,m)}function $(){!l.value||!m||!h||(m.aspect=l.value.clientWidth/l.value.clientHeight,m.updateProjectionMatrix(),h.setSize(l.value.clientWidth,l.value.clientHeight))}function F(O){const Z=r.value;if(Z.has(O))Z.delete(O);else{if(Z.size>=3)return;Z.add(O)}r.value=new Set(Z)}async function B(O,Z){if(!d||!E)return;let re=O.modelUrl;f(`[StartGame] model_url: ${O.name}, URL: ${re}`);try{const Ee=await Ot.loadModel(re,!0);f(`[StartGame] : ${O.name}`);const Ue=new wt().setFromObject(Ee).getSize(new Ae),De=new Xt;De.add(Ee);const Ze=2.5,ot=-(M.value.length-1)*Ze/2;De.position.set(ot+Z*Ze,0,0),De.scale.set(1,1,1),De.rotation.y=-Math.PI/2;const st=new wt().setFromObject(De);De.position.y=-st.min.y,d.add(De),S.set(O.id,De),f(`[StartGame] : ${O.name}`)}catch(Ee){f(`[StartGame] : ${O.name}`,Ee),ee(O,Z)}}function ee(O,Z){if(!d)return;const re=new qt(.8,.8,.8),Ee=new $t({color:4491519}),Ge=new et(re,Ee),Ue=2.5,De=-(M.value.length-1)*Ue/2;Ge.position.set(De+Z*Ue,.8,0),Ge.rotation.y=-Math.PI/2,d.add(Ge),S.set(O.id,Ge)}function Q(){d&&(S.forEach(O=>{d.remove(O),O.geometry&&O.geometry.dispose(),O.material&&(Array.isArray(O.material)?O.material.forEach(Z=>Z.dispose()):O.material.dispose())}),S.clear(),M.value.forEach((O,Z)=>{B(O,Z)}))}async function q(){o.value=!0,i.value="";try{const O=await Qn(),Z=Array.isArray(O==null?void 0:O.coppers)?O.coppers:[];a.value=(Z||[]).map((re,Ee)=>{var Ue,De,Ze,ot,st,xt;const Ge=(Ue=re==null?void 0:re.copper_info)==null?void 0:Ue.model_url;return f(`[StartGame] Copper ${((De=re==null?void 0:re.copper_info)==null?void 0:De.name)||Ee+1}: model_url=${Ge}`),{id:Number((re==null?void 0:re.id)??Ee+1),name:((Ze=re==null?void 0:re.copper_info)==null?void 0:Ze.name)||`#${Ee+1}`,icon:G(((ot=re==null?void 0:re.copper_info)==null?void 0:ot.icon_url)||""),level:Number((re==null?void 0:re.level)??1),copperType:(re==null?void 0:re.copper_type)||"Arcanist",modelName:((xt=(st=re==null?void 0:re.copper_info)==null?void 0:st.name)==null?void 0:xt.toLowerCase())||"",modelUrl:Ge?G(Ge):""}})}catch(O){f("[StartGame] ",O),i.value=""}finally{o.value=!1}}async function P(){if(r.value.size!==3)return;const O=Array.from(r.value).map(Z=>String(Z));window.__ACTUAL_COPPER_IDS__=O,f("[StartGame] ID:",O),s("confirm",{ids:O})}function L(){s("close")}It(M,()=>{Q()},{deep:!0}),Et(()=>{q(),setTimeout(()=>{b()},100),n.musicOn&&!n.paused&&c.value&&setTimeout(()=>{if(c.value.readyState>=2)c.value.play().then(()=>{f("[StartGame] ")}).catch(Z=>{f("[StartGame] :",Z)});else{const Z=()=>{c.value.play().then(()=>{f("[StartGame] ")}).catch(re=>{f("[StartGame] :",re)}),c.value.removeEventListener("canplay",Z)};c.value.addEventListener("canplay",Z,{once:!0})}},200)}),It(()=>n.musicOn,O=>{if(c.value)if(O&&!n.paused)if(c.value.readyState>=2)c.value.play().catch(Z=>{f("[StartGame] :",Z)});else{const Z=()=>{c.value.play().catch(re=>{f("[StartGame] :",re)}),c.value.removeEventListener("canplay",Z)};c.value.addEventListener("canplay",Z)}else c.value.pause()}),It(()=>n.paused,O=>{if(c.value){if(O)c.value.pause(),f("[StartGame] ");else if(n.musicOn){if(c.value.readyState>=2)c.value.play().catch(Z=>{f("[StartGame] :",Z)});else{const Z=()=>{c.value.play().catch(re=>{f("[StartGame] :",re)}),c.value.removeEventListener("canplay",Z)};c.value.addEventListener("canplay",Z)}f("[StartGame] ")}}}),cs(()=>{window.removeEventListener("resize",$),c.value&&c.value.pause(),S.forEach(O=>{d&&d.remove(O)}),S.clear(),h&&h.dispose(),_&&_.dispose()});const fe=`url('${G("@assets/ui/panel1.png")}')`,Te=`url('${G("@assets/ui/panel2.png")}')`,Ce=`url('${G("@assets/ui/panel3.png")}')`,ve=`url('${G("@assets/ui/panel6.png")}')`,X=`url('${G("@assets/ui/panel7.png")}')`,A=`url('${G("@assets/ui/panel8.png")}')`,de=`url('${G("@assets/ui/panel9.png")}')`,V=`url('${G("@assets/ui/panel10.png")}')`;return(O,Z)=>(I(),U("div",Um,[p("div",Fm,[p("div",Bm,[Z[0]||(Z[0]=p("div",{class:"card__title"},"",-1)),p("button",{class:"card__close",onClick:L,"aria-label":""},[p("img",{src:ue(G)("@assets/ui/close.png"),alt:""},null,8,jm)])]),p("div",zm,[p("div",Vm,[o.value?(I(),U("div",Km,"...")):i.value?(I(),U("div",Wm,se(i.value),1)):(I(),U("div",qm,[(I(!0),U(We,null,Vt(a.value,re=>(I(),U("div",{key:re.id,class:Ye(["item",{"item--selected":r.value.has(re.id)}]),onClick:Ee=>F(re.id)},[p("div",Ym,[p("img",{src:re.icon,alt:re.name},null,8,Jm)]),p("div",Zm,[p("div",Qm,se(re.name),1),p("div",e_,"Lv. "+se(re.level),1)])],10,Xm))),128))])),Z[1]||(Z[1]=p("div",{class:"hint"},"3",-1))]),p("div",t_,[Z[2]||(Z[2]=p("div",{class:"preview__title"},"",-1)),p("div",{ref_key:"previewContainer",ref:l,class:"preview__scene"},null,512),p("div",s_,[M.value.length===0?(I(),U("div",n_,"  ")):(I(),U("div",o_,[(I(!0),U(We,null,Vt(M.value,(re,Ee)=>(I(),U("div",{key:re.id,class:"preview__name"},[p("span",i_,se(Ee+1),1),p("span",a_,se(re.name),1)]))),128))]))])])]),p("div",r_,[p("button",{class:"btn btn--primary",disabled:!v.value,onClick:P},"  ",8,l_),p("button",{class:"btn",onClick:L},"")])]),p("audio",{ref_key:"audioRef",ref:c,src:ue(u),loop:"",preload:"auto"},null,8,c_)]))}},d_=ut(u_,[["__scopeId","data-v-5e159611"]]),f_={:"spark",:"syrup",:"bubble",:"glimmer",:"turner",:"wrench",:"artifex",:"coil",:"drillbit",:"quickhand",:"rocky",:"wesley",:"bell",:"tumble",:"chief",:"gyro",:"tricky",:"pendulum",:"yoyo",:"karin",:"murmur",:"melody",:"clawster",:"diggs",:"hive"},p_={IronWall:"iron_wall",Arcanist:"arcanist",Mechanic:"mechanic",Resonator:"resonator",CraftsMan:"craftsman"};function h_(t){return f_[t]||t.toLowerCase()}function m_(t){return p_[t]||t.toLowerCase()}const __={:"rivet_barrier",:"gear_arrow_tower",:"heart_source_mineral_drill",:"steam_mining_car",:"charging_coil",:"repair_workshop",:"mirro_light_refraction_tower",:"resonance_alarm_bell",:"storm_anvil",:"automatic_loading_gun"};function g_(t){return __[t]||t.toLowerCase().replace(/\s+/g,"_")}function v_(t,e){const s=new Map;function n(c,u,d){if(s.has(c)){const $=s.get(c);$.maxHp=d,o(c,u,d);return}const m=1,h=.1,_=new to(m,h),E=new Ct({color:4456448,side:ks,depthTest:!1,depthWrite:!1,transparent:!1,toneMapped:!1}),S=new et(_,E),v=new to(m,h),M=new Ct({color:i(u,d),side:ks,depthTest:!1,depthWrite:!1,transparent:!1,toneMapped:!1}),b=new et(v,M);b.position.z=.001;const w=new Xt;w.add(S),w.add(b),w.renderOrder=999,S.renderOrder=999,b.renderOrder=1e3,t.add(w),s.set(c,{bar:b,background:S,container:w,maxHp:d}),o(c,u,d)}function o(c,u,d){const m=s.get(c);if(!m)return;const{bar:h}=m,_=Math.max(0,Math.min(1,u/d));h.scale.x=_,h.position.x=-(1-_)*.5,h.material.color.setHex(i(u,d))}function i(c,u){const d=c/u;return d>.6?65280:d>.3?16776960:16711680}function a(c){const u=s.get(c);if(!u)return;const{bar:d,background:m,container:h}=u;d.geometry.dispose(),d.material.dispose(),m.geometry.dispose(),m.material.dispose(),t.remove(h),s.delete(c)}function r(c){s.forEach((u,d)=>{const m=c.find(h=>h.id===d);if(m&&m.object){const{container:h}=u,_=m.object.position.clone();_.y+=1.5,h.position.copy(_),h.lookAt(e.position)}})}function l(){s.forEach((c,u)=>{a(u)}),s.clear()}return{healthBars:s,createOrUpdateHealthBar:n,updateHealthBarValue:o,removeHealthBar:a,updateHealthBarsPosition:r,dispose:l}}function y_(t){const e={move:[],attack:[],summon:[]},s={move:{color:4521796,opacity:.6},attack:{color:16729156,opacity:.6},summon:{color:16776960,opacity:.6}};function n(c,u="move"){const[d,m]=c,h=s[u]||s.move,_=new to(.9,.9),E=new Ct({color:h.color,side:ks,transparent:!0,opacity:h.opacity}),S=new et(_,E);return S.rotation.x=-Math.PI/2,S.position.set(d,.08,m),S.userData={position:c,type:u},t.add(S),e[u].push(S),S}function o(c){const[u,d]=c;let m=!1;return Object.keys(e).forEach(h=>{const _=e[h].findIndex(E=>{const S=E.userData.position;return S[0]===u&&S[1]===d});if(_!==-1){const E=e[h][_];t.remove(E),E.geometry.dispose(),E.material.dispose(),e[h].splice(_,1),m=!0}}),m}function i(c){e[c]&&(e[c].forEach(u=>{t.remove(u),u.geometry.dispose(),u.material.dispose()}),e[c]=[])}function a(){Object.keys(e).forEach(c=>{i(c)})}function r(c,u){var h;const[d,m]=c;return(h=e[u])==null?void 0:h.some(_=>{const E=_.userData.position;return E[0]===d&&E[1]===m})}function l(){a()}return{indicators:e,createIndicator:n,clearIndicatorAt:o,clearIndicators:i,clearAllIndicators:a,hasIndicatorAt:r,dispose:l}}function b_(){const t={geometries:[],materials:[],meshes:[],maxSize:10},e={geometries:[],materials:[],meshes:[],maxSize:10};function s(r){let l;if(t.meshes.length>0)l=t.meshes.pop(),l.geometry.dispose(),l.geometry=new so(.05,.05,r,8),l.material.opacity=.9;else{const c=new so(.05,.05,r,8),u=new Ct({color:16729156,transparent:!0,opacity:.9,emissive:16729156,emissiveIntensity:.5});l=new et(c,u)}return l}function n(r){t.meshes.length<t.maxSize?t.meshes.push(r):(r.geometry.dispose(),r.material.dispose())}function o(){let r;if(e.meshes.length>0)r=e.meshes.pop(),r.scale.set(1,1,1),r.material.opacity=.8;else{const l=new ci(.2,.4,32),c=new Ct({color:16711680,side:ks,transparent:!0,opacity:.8,emissive:16711680,emissiveIntensity:.5});r=new et(l,c),r.rotation.x=-Math.PI/2}return r}function i(r){e.meshes.length<e.maxSize?e.meshes.push(r):(r.geometry.dispose(),r.material.dispose())}function a(){t.meshes.forEach(r=>{r.geometry.dispose(),r.material.dispose()}),t.meshes=[],t.geometries=[],t.materials=[],e.meshes.forEach(r=>{r.geometry.dispose(),r.material.dispose()}),e.meshes=[],e.geometries=[],e.materials=[]}return{getAttackRay:s,recycleAttackRay:n,getExplosionRing:o,recycleExplosionRing:i,dispose:a}}function w_(t){const e=b_();function s(i,a){const r=new Ae(i[0],.5,i[1]),l=new Ae(a[0],.5,a[1]),c=r.distanceTo(l),u=e.getAttackRay(c),d=new Ae().addVectors(r,l).multiplyScalar(.5);u.position.copy(d);const m=new Ae().subVectors(l,r).normalize(),h=new an;h.setFromUnitVectors(new Ae(0,1,0),m),u.quaternion.copy(h),t.add(u);let _=.9;const E=()=>{_-=.05,u.material.opacity=_,_<=0?(t.remove(u),e.recycleAttackRay(u)):requestAnimationFrame(E)};setTimeout(E,300);const S=e.getExplosionRing();S.position.set(a[0],.1,a[1]),t.add(S);let v=1,M=.8;const b=()=>{v+=.1,M-=.08,S.scale.set(v,v,1),S.material.opacity=M,M<=0?(t.remove(S),e.recycleExplosionRing(S)):requestAnimationFrame(b)};b()}function n(i,a){const r=Object.entries(a).filter(([w,$])=>$>0).map(([w,$])=>{const F=_t(w);return`+${$} ${F}`});if(r.length===0)return;const l=r.join(`
`),c=document.createElement("canvas"),u=c.getContext("2d");c.width=512,c.height=256,u.fillStyle="rgba(0, 0, 0, 0)",u.fillRect(0,0,c.width,c.height),u.font="bold 48px Arial",u.fillStyle="#ffff00",u.strokeStyle="#000000",u.lineWidth=4,u.textAlign="center",u.textBaseline="middle";const d=l.split(`
`),m=60,h=c.height/2-(d.length-1)*m/2;d.forEach((w,$)=>{const F=h+$*m;u.strokeText(w,c.width/2,F),u.fillText(w,c.width/2,F)});const _=new Qc(c),E=new eu({map:_,transparent:!0,opacity:1}),S=new tu(E);S.scale.set(2,1,1),S.position.set(i[0],1.5,i[1]),t.add(S);let v=1.5,M=1;const b=()=>{v+=.02,M-=.01,S.position.y=v,S.material.opacity=M,M<=0?(t.remove(S),S.material.map.dispose(),S.material.dispose()):requestAnimationFrame(b)};b()}function o(){e.dispose()}return{createAttackEffect:s,createResourceGainEffect:n,dispose:o}}const S_={key:0,class:"diamond-name"},T_={class:"diamond-row diamond-row--top"},M_=["title","aria-disabled"],C_={class:"diamond border-orange-red"},E_={class:"diamond-content"},x_={class:"diamond-text"},k_={class:"diamond-value"},A_={class:"diamond-row diamond-row--bottom"},R_={class:"diamond border-orange-red"},$_={class:"diamond-content"},P_={class:"diamond-text"},L_={class:"diamond-value"},I_={class:"diamond border-green"},O_={class:"diamond-content"},D_={class:"diamond-text"},N_={class:"diamond-value"},G_={class:"diamond border-blue"},H_={class:"diamond-content"},U_={class:"diamond-text"},F_={class:"diamond-value"},B_={__name:"DiamondPanel",props:{copperInfo:{type:Object,required:!0},inventoryItems:{type:Array,default:()=>[]},inventoryCapacity:{type:Number,default:5}},emits:["inventory-click"],setup(t,{emit:e}){Kt(v=>({v2b14f7a8:m,v6dc22a41:s,v740cabaa:n,v4ea1daaa:o}));const s=`url('${G("ui/border-blue.png")}')`,n=`url('${G("ui/border-green.png")}')`,o=`url('${G("ui/border-orange-red.png")}')`,i=t,a=e,r=Pe(()=>{var v;return(((v=i.copperInfo)==null?void 0:v.name)||"").trim()}),l=Pe(()=>{var v,M;return((v=i.copperInfo)==null?void 0:v.isOwnedEnemy)===!0||((M=i.copperInfo)==null?void 0:M.isEnemy)===!0}),c=Pe(()=>l.value&&r.value!==""),u=Pe(()=>{var M;const v=(M=i.copperInfo)==null?void 0:M.position;return!Array.isArray(v)||v.length<2?"--":`${v[0]},${v[1]}`}),d=Pe(()=>l.value===!0),m=`url('${G("@assets/ui/panel4.png")}')`,h=W({SpiritalSpark:0,RecallGear:0,ResonantCrystal:0,RefinedCopper:0,HeartCrystalDust:0});async function _(){try{const v=await Lo();v&&Object.keys(h.value).forEach(M=>{h.value[M]=v[M]||0})}catch(v){console.error("[DiamondPanel] :",v)}}Pe(()=>Object.values(h.value).filter(v=>v>0).length);function E(){d.value||a("inventory-click")}const S=W(null);return Et(async()=>{if(_(),Po(Pt.UPDATE_RESOURCES,_),!S.value)return;function v(b){return new Promise((w,$)=>{const F=new Image;F.onload=()=>w(F),F.onerror=()=>$(),F.src=b})}function M(b,w){S.value&&S.value.style.setProperty(b,String(w))}try{const[b,w,$]=await Promise.all([v(G("ui/border-blue.png")),v(G("ui/border-green.png")),v(G("ui/border-orange-red.png"))]),F=Math.max(3,Math.round(b.naturalHeight/4)),B=Math.max(3,Math.round(w.naturalHeight/4)),ee=Math.max(3,Math.round($.naturalHeight/4));M("--border-blue-slice",F),M("--border-green-slice",B),M("--border-orange-red-slice",ee)}catch{M("--border-blue-slice","8"),M("--border-green-slice","8"),M("--border-orange-red-slice","8")}}),(v,M)=>(I(),U("div",{ref_key:"diamondPanelRef",ref:S,class:"diamond-panel"},[c.value?(I(),U("div",S_,se(r.value),1)):ye("",!0),p("div",T_,[p("div",{class:Ye(["diamond","border-blue",{"diamond--disabled":d.value}]),onClick:E,title:d.value?"":"","aria-disabled":d.value?"true":"false"},[...M[0]||(M[0]=[p("div",{class:"diamond-content"},[p("div",{class:"diamond-text"},[p("div",{class:"diamond-label"},"")])],-1)])],10,M_),p("div",C_,[p("div",E_,[p("div",x_,[M[1]||(M[1]=p("div",{class:"diamond-label"},"",-1)),p("div",k_,se(u.value),1)])])])]),p("div",A_,[p("div",R_,[p("div",$_,[p("div",P_,[M[2]||(M[2]=p("div",{class:"diamond-label"},"",-1)),p("div",L_,se(t.copperInfo.attack),1)])])]),p("div",I_,[p("div",O_,[p("div",D_,[M[3]||(M[3]=p("div",{class:"diamond-label"},"",-1)),p("div",N_,se(t.copperInfo.defense),1)])])]),p("div",G_,[p("div",H_,[p("div",U_,[M[4]||(M[4]=p("div",{class:"diamond-label"},"",-1)),p("div",F_,se(t.copperInfo.speed),1)])])])])],512))}},j_=ut(B_,[["__scopeId","data-v-94197fa6"]]),z_={class:"minecraft-inventory"},V_={class:"inventory-layout"},K_={class:"inventory-section"},W_={class:"equipment-header-mc"},q_={class:"copper-name"},X_={class:"inventory-grid"},Y_={class:"slot-icon"},J_=["src","alt"],Z_=["src"],Q_=["src"],eg={key:3,class:"equipment-icon"},tg={class:"slot-tooltip"},sg={class:"tooltip-name"},ng={__name:"InventoryModal",props:{visible:{type:Boolean,default:!1},copperName:{type:String,default:""},equipment:{type:Array,default:()=>[]}},emits:["close"],setup(t,{emit:e}){const s=t,n=Pe(()=>s.equipment||[]),o=e;function i(){o("close")}return(a,r)=>t.visible?(I(),U("div",{key:0,class:"inventory-modal",onClick:ys(i,["self"])},[p("div",z_,[p("div",V_,[p("div",K_,[p("div",W_,[p("h4",null,[p("span",q_,se(t.copperName),1),r[0]||(r[0]=Ps("  ",-1))])]),p("div",X_,[(I(),U(We,null,Vt(2,(l,c)=>{var u,d,m,h,_,E,S,v,M,b;return p("div",{key:c,class:Ye(["inv-slot",{"has-item":c<n.value.length&&((u=n.value[c])==null?void 0:u.equipped),"slot-locked":(d=n.value[c])==null?void 0:d.locked}])},[c<n.value.length?(I(),U(We,{key:0},[p("div",Y_,[(m=n.value[c])!=null&&m.equipped&&((h=n.value[c])!=null&&h.icon)&&n.value[c].icon!==""&&(n.value[c].icon.startsWith("/")||n.value[c].icon.startsWith("http")||n.value[c].icon.includes("."))?(I(),U("img",{key:0,src:n.value[c].icon,alt:((_=n.value[c])==null?void 0:_.name)||"",class:"equipment-icon"},null,8,J_)):(E=n.value[c])!=null&&E.locked?(I(),U("img",{key:1,src:ue(G)("@assets/ui/lock.png"),alt:"",class:"equipment-icon"},null,8,Z_)):((S=n.value[c])==null?void 0:S.icon)===""?(I(),U("img",{key:2,src:ue(G)("@assets/ui/jia.png"),alt:"",class:"equipment-icon"},null,8,Q_)):(I(),U("span",eg,se(((v=n.value[c])==null?void 0:v.icon)||""),1))]),p("div",tg,[p("div",sg,se(((M=n.value[c])==null?void 0:M.name)||((b=n.value[c])!=null&&b.locked?"":"")),1)])],64)):ye("",!0)],2)}),64))])])])])])):ye("",!0)}},og=ut(ng,[["__scopeId","data-v-87970a7f"]]),ig={class:"health-bar","aria-label":"Health Bar"},ag={class:"health-bar__border"},rg={class:"health-bar__border-left"},lg=["src"],cg={class:"health-bar__border-right"},ug=["src"],dg={class:"health-bar__text"},fg={__name:"HealthBar",props:{hp:{type:Number,default:0},maxHp:{type:Number,default:100}},setup(t){Kt(l=>({v3bf30af6:o,v3ceb41be:i}));const e=t,s=G("ui/blood-border-left.png"),n=G("ui/blood-border-right.png"),o=`url('${G("ui/blood-border-middle.png")}')`,i=`url('${G("ui/blood-bar.png")}')`,a=Pe(()=>{if(!e.maxHp||e.maxHp===0)return 0;const c=Math.max(0,Math.min(e.hp,e.maxHp))/e.maxHp*100;return Math.max(0,Math.min(100,c))}),r=Pe(()=>{const l=Math.max(0,Math.min(e.hp,e.maxHp)),c=e.maxHp||100;return`${Math.round(l)}/${Math.round(c)}`});return(l,c)=>(I(),U("div",ig,[p("div",ag,[p("div",rg,[p("img",{src:ue(s),alt:""},null,8,lg)]),c[0]||(c[0]=p("div",{class:"health-bar__border-middle"},null,-1)),p("div",cg,[p("img",{src:ue(n),alt:""},null,8,ug)]),p("div",{class:"health-bar__fill",style:Ft({width:`calc(${a.value}% + 20px)`})},null,4),p("div",dg,se(r.value),1)])]))}},pg=ut(fg,[["__scopeId","data-v-7b5f9ec2"]]),hg={class:"tri-panel"},mg={class:"diamond","aria-label":""},_g=["src"],gg=["src"],vg=["title"],yg=["src"],bg=["src"],wg=["title"],Sg=["src"],Tg=["src","alt"],Mg={__name:"TriPanel",props:{copperType:{type:String,default:""},canMove:{type:Boolean,default:!0},canAttack:{type:Boolean,default:!0},canSummon:{type:Boolean,default:!1}},emits:["move","wait","attack","summon","build"],setup(t,{emit:e}){const s=t,n=e,o=Pe(()=>s.copperType==="CraftsMan"?"build":s.copperType==="Resonator"?"summon":"attack"),i=Pe(()=>o.value==="build"?s.canSummon?"":"":o.value==="summon"?s.canSummon?"":"":s.canAttack?"":""),a=Pe(()=>o.value==="build"||o.value==="summon"?!s.canSummon:!s.canAttack),r=G("ui/your-image.png"),l=G("ui/boot.png"),c=G("ui/mushroom.png"),u=G("ui/sword.png"),d=G("@assets/ui/summon.png"),m=G("@assets/ui/build.png");function h(){s.canMove&&n("move")}function _(){n("wait")}function E(){if(o.value==="build"){if(!s.canSummon)return;n("build")}else if(o.value==="summon"){if(!s.canSummon)return;n("summon")}else{if(!s.canAttack)return;n("attack")}}return(S,v)=>(I(),U("div",hg,[p("div",mg,[p("div",{class:"hex top",title:"",onClick:_},[p("img",{class:"hex-bg",src:ue(r),alt:""},null,8,_g),p("img",{class:"hex-icon",src:ue(l),alt:""},null,8,gg)]),p("div",{class:Ye(["hex left",{"is-locked":t.canMove===!1}]),title:t.canMove?"":"",onClick:h},[p("img",{class:"hex-bg",src:ue(r),alt:""},null,8,yg),p("img",{class:"hex-icon",src:ue(c),alt:""},null,8,bg)],10,vg),p("div",{class:Ye(["hex right",{"is-locked":a.value}]),title:i.value,onClick:E},[p("img",{class:"hex-bg",src:ue(r),alt:""},null,8,Sg),p("img",{class:"hex-icon",src:o.value==="build"?ue(m):o.value==="summon"?ue(d):ue(u),alt:o.value==="build"?"":o.value==="summon"?"":""},null,8,Tg)],10,wg)])]))}},Cg=ut(Mg,[["__scopeId","data-v-38a09e87"]]),Eg={class:"modal-header"},xg=["src"],kg={class:"modal-info"},Ag={class:"info-text"},Rg={class:"copper-name"},$g={class:"modal-body"},Pg={class:"structure-list"},Lg=["onClick"],Ig={class:"structure-header"},Og={class:"structure-name-row"},Dg={class:"structure-name"},Ng={class:"structure-type"},Gg={class:"structure-stats"},Hg={class:"stat"},Ug={class:"stat-value"},Fg={class:"stat"},Bg={class:"stat-value"},jg={class:"stat"},zg={class:"stat-value"},Vg={class:"stat"},Kg={class:"stat-value"},Wg={class:"structure-cost"},qg={class:"cost-value"},Xg={class:"structure-desc"},Yg={key:0,class:"selected-badge"},Jg={class:"modal-footer"},Zg=["disabled"],Qg={__name:"BuildModal",props:{visible:{type:Boolean,default:!1},copperName:{type:String,default:""},structureList:{type:Array,default:()=>[]},position:{type:Array,default:null}},emits:["close","build"],setup(t,{emit:e}){Kt(S=>({b71f15e0:d,v26ebd2fa:_,v26e918c0:h,v26ea017e:m,b71e2d22:E}));const s=t,n=e,o=W(null),i=Pe(()=>[...s.structureList].sort((S,v)=>{const M=b=>{var $;const w=(($=b.cost)==null?void 0:$.cost)||b.cost;return!Array.isArray(w)||w.length===0?0:Array.isArray(w[0])?w[0][1]:w[0].count};return M(S)-M(v)}));function a(S){o.value=S}function r(){if(!o.value){f("[BuildModal] ");return}f("[BuildModal] :",o.value.name),n("build",o.value.name),l()}function l(){o.value=null,n("close")}function c(S){return{:"",:"",:"",:""}[S]||""}function u(S){if(!S)return"";const v=S.cost||S;return!Array.isArray(v)||v.length===0?"":v.map(M=>{var b;if(Array.isArray(M)){const w=M[0],$=M[1];return`${((b=Yt[w])==null?void 0:b.name)||w} x${$}`}return`${Ki(M)} x${M.count}`}).join(", ")}const d=`url('${G("@assets/ui/panel11.png")}')`,m=`url('${G("@assets/ui/panel7.png")}')`,h=`url('${G("@assets/ui/panel8.png")}')`,_=`url('${G("@assets/ui/panel5.png")}')`,E=`url('${G("@assets/ui/panel12.png")}')`;return(S,v)=>(I(),Lt(Zr,{to:"body"},[t.visible?(I(),U("div",{key:0,class:"modal-overlay",onClick:ys(l,["self"])},[p("div",{class:"build-modal",onClick:v[0]||(v[0]=ys(()=>{},["stop"]))},[p("div",Eg,[v[1]||(v[1]=p("h2",{class:"modal-title"}," ",-1)),p("button",{class:"close-btn",onClick:l,title:""},[p("img",{src:ue(G)("@assets/ui/close.png"),alt:""},null,8,xg)])]),p("div",kg,[p("p",Ag,[p("span",Rg,se(t.copperName),1),v[2]||(v[2]=Ps("  ",-1))]),v[3]||(v[3]=p("p",{class:"tip-text"},"   ",-1))]),p("div",$g,[p("div",Pg,[(I(!0),U(We,null,Vt(i.value,M=>{var b,w,$;return I(),U("div",{key:M.name,class:Ye(["structure-card",{selected:((b=o.value)==null?void 0:b.name)===M.name}]),onClick:F=>a(M)},[p("div",Ig,[p("div",Og,[p("span",Dg,se(M.name),1)]),p("span",Ng,se(c(M.name)),1)]),p("div",Gg,[p("div",Hg,[v[4]||(v[4]=p("span",{class:"stat-label"},"",-1)),p("span",Ug,se(M.health),1)]),p("div",Fg,[v[5]||(v[5]=p("span",{class:"stat-label"},"",-1)),p("span",Bg,se(((w=M.attribute)==null?void 0:w.attack)||""),1)]),p("div",jg,[v[6]||(v[6]=p("span",{class:"stat-label"},"",-1)),p("span",zg,se(M.has_storage?"":""),1)]),p("div",Vg,[v[7]||(v[7]=p("span",{class:"stat-label"},"",-1)),p("span",Kg,se(M.attack_range||""),1)])]),p("div",Wg,[v[8]||(v[8]=p("span",{class:"cost-label"}," ",-1)),p("span",qg,se(u(M.cost)),1)]),p("div",Xg,se(M.description),1),(($=o.value)==null?void 0:$.name)===M.name?(I(),U("div",Yg,"  ")):ye("",!0)],10,Lg)}),128))])]),p("div",Jg,[p("button",{class:"btn btn-cancel",onClick:l},""),p("button",{class:"btn btn-confirm",disabled:!o.value,onClick:r},"  ",8,Zg)])])])):ye("",!0)]))}},ev=ut(Qg,[["__scopeId","data-v-96b14c10"]]),tv={key:0,class:"copper-panel-parent"},sv={key:0,class:"minimized-content"},nv=["src"],ov={class:"minimized-info"},iv={class:"minimized-name"},av={class:"minimized-action"},rv=["src"],lv={class:"panel-content"},cv={key:0,class:"resources"},uv={class:"resources-list"},dv=["onClick"],fv={class:"resource-name"},pv={class:"resource-count"},hv={key:2,class:"enemy-info-tip"},mv={__name:"ActionPanel",props:{copper:{type:Object,default:null},resources:{type:Array,default:()=>[]},hasAttackTargets:{type:Boolean,default:!0},onSelectCopper:{type:Function,default:null}},emits:["close","action","selectCopper"],setup(t,{expose:e,emit:s}){Kt(V=>({a4d8c7e2:i.value,e0fd0632:a.value,v58bba3fc:r.value,v1ac48a75:l.value,v27e0a61e:u.value,v0e219880:c.value}));const n=t,o=s,i=Pe(()=>`url('${G("ui/sword.png")}')`),a=Pe(()=>`url('${G("ui/red.png")}')`),r=Pe(()=>`url('${G("ui/boot.png")}')`),l=Pe(()=>`url('${G("ui/green.png")}')`),c=Pe(()=>`url('${G("@assets/ui/build.png")}')`),u=Pe(()=>`url('${G("@assets/ui/summon.png")}')`),d=G("@assets/ui/close.png"),m=W("full"),h=W(null),_=W(!1),E=W(!1),S=W([]),v=Pe(()=>{var O,Z,re,Ee,Ge,Ue,De,Ze,ot,st,xt,g,T,R,j,H,N,K,oe,Y,z,_e,le,pe,ce,ge,ie,Me,qe,Qe,dt,ft,Nt,es,it;if(!n.copper)return null;const V=((Z=(O=n.copper.copper)==null?void 0:O.copper_info)==null?void 0:Z.name)||((Ee=(re=n.copper.enemy)==null?void 0:re.enemy_base)==null?void 0:Ee.name)||((Ge=n.copper.enemy_base)==null?void 0:Ge.name)||n.copper.name||` #${n.copper.id}`;return{id:n.copper.id,name:V,level:((Ue=n.copper.copper)==null?void 0:Ue.level)??((De=n.copper.enemy)==null?void 0:De.level)??((Ze=n.copper.enemy_base)==null?void 0:Ze.level)??1,hp:n.copper.now_health,maxHp:((st=(ot=n.copper.copper)==null?void 0:ot.attribute)==null?void 0:st.health)??((g=(xt=n.copper.enemy)==null?void 0:xt.enemy_base)==null?void 0:g.health)??((T=n.copper.enemy_base)==null?void 0:T.health)??100,attack:((j=(R=n.copper.copper)==null?void 0:R.attribute)==null?void 0:j.attack)??((N=(H=n.copper.enemy)==null?void 0:H.enemy_base)==null?void 0:N.attack)??((K=n.copper.enemy_base)==null?void 0:K.attack)??0,defense:((Y=(oe=n.copper.copper)==null?void 0:oe.attribute)==null?void 0:Y.defense)??((_e=(z=n.copper.enemy)==null?void 0:z.enemy_base)==null?void 0:_e.defense)??((le=n.copper.enemy_base)==null?void 0:le.defense)??0,speed:((ce=(pe=n.copper.copper)==null?void 0:pe.attribute)==null?void 0:ce.speed)??((ie=(ge=n.copper.enemy)==null?void 0:ge.enemy_base)==null?void 0:ie.speed)??((Me=n.copper.enemy_base)==null?void 0:Me.speed)??0,canMove:n.copper.can_move,canAttack:n.copper.can_attack,canSummon:n.copper.can_summon,position:Array.isArray(n.copper.position)&&n.copper.position.length>=2?n.copper.position:Array.isArray((qe=n.copper.enemy)==null?void 0:qe.position)&&n.copper.enemy.position.length>=2?n.copper.enemy.position:Array.isArray((Qe=n.copper.enemy_base)==null?void 0:Qe.position)&&n.copper.enemy_base.position.length>=2?n.copper.enemy_base.position:[0,0],inventoryCapacity:((dt=n.copper.inventory)==null?void 0:dt.capacity)||0,copperType:((ft=n.copper.copper)==null?void 0:ft.copper_type)||((es=(Nt=n.copper.enemy)==null?void 0:Nt.enemy_base)==null?void 0:es.enemy_type)||((it=n.copper.enemy_base)==null?void 0:it.enemy_type)||"",isOwnedEnemy:n.copper.isOwnedEnemy===!0,isEnemy:n.copper.isEnemy===!0}}),M=Pe(()=>{var re,Ee,Ge,Ue,De;if(!n.copper)return[];const V=((re=n.copper.copper)==null?void 0:re.equipment_slot)||{},O=(V==null?void 0:V.slot1)||null,Z=(V==null?void 0:V.slot2)||null;return[O?{name:((Ee=O.equipment_base)==null?void 0:Ee.name)||"",icon:G(((Ge=O.equipment_base)==null?void 0:Ge.resource_url)||""),equipped:!0,locked:!1}:{name:"",icon:"",equipped:!1,locked:!1},V!=null&&V.is_slot2_locked?{name:"",icon:"",equipped:!1,locked:!0}:Z?{name:((Ue=Z.equipment_base)==null?void 0:Ue.name)||"",icon:G(((De=Z.equipment_base)==null?void 0:De.resource_url)||""),equipped:!0,locked:!1}:{name:"",icon:"",equipped:!1,locked:!1}]});It(()=>{var V;return(V=n.copper)==null?void 0:V.id},(V,O)=>{V!==O&&(m.value="full",h.value=null,_.value=!1,E.value=!1)});async function b(){if(!v.value.canMove)return;f("[ActionPanel] ");const V=n.copper.isOwnedEnemy===!0,O=V?"on_enemy_move_start":"on_move_start";f(`[ActionPanel] : ${V?"":""}, : ${O}`);const Z=JSON.stringify({type:O,content:{id:String(v.value.id)}});await ke(Z),m.value="minimized",h.value="moving",o("action",{type:"moveStart",copperId:v.value.id})}async function w(){if(f("[ActionPanel] ",{canAttack:v.value.canAttack,copperId:v.value.id,name:v.value.name}),!v.value.canAttack){f("[ActionPanel] : ");return}f("[ActionPanel] ");const V=n.copper.isOwnedEnemy===!0,O=V?"on_enemy_attack_start":"on_attack_start";f(`[ActionPanel] : ${V?"":""}, : ${O}`);const Z=JSON.stringify({type:O,content:{id:String(v.value.id)}});await ke(Z),m.value="minimized",h.value="attacking",o("action",{type:"attackStart",copperId:v.value.id})}async function $(){if(f("[ActionPanel] ",{canSummon:v.value.canSummon,copperId:v.value.id,name:v.value.name}),!v.value.canSummon){f("[ActionPanel] : ");return}f("[ActionPanel] ");const V=JSON.stringify({type:"on_summon_start",content:{id:String(v.value.id)}});await ke(V),m.value="minimized",h.value="summoning",o("action",{type:"summonStart",copperId:v.value.id})}async function F(){if(f("[ActionPanel] ",{copperId:v.value.id,name:v.value.name}),!v.value.canSummon){f("[ActionPanel] : /");return}o("action",{type:"buildRequest",copperId:v.value.id})}function B(V){f("[ActionPanel] ",(V==null?void 0:V.length)||0,""),S.value=V||[],E.value=!0}async function ee(V){f("[ActionPanel] :",V),E.value=!1;const O=JSON.stringify({type:"on_structure_build_start",content:{id:String(v.value.id),name:V}});await ke(O),m.value="minimized",h.value="building",o("action",{type:"buildStart",copperId:v.value.id,structureName:V})}function Q(){f("[ActionPanel] "),_.value=!0}async function q(V){f(`[ActionPanel] : index=${V}`);const O=JSON.stringify({type:"on_copper_pick_up",content:{id:String(v.value.id),index:String(V)}});await ke(O),await fe()}async function P(){f("[ActionPanel] ");const V=JSON.stringify({type:"on_copper_craft",content:{id:String(v.value.id)}});await ke(V),await fe()}async function L(){await P()}async function fe(){const O=n.copper.isOwnedEnemy===!0?"on_click_enemy":"on_click_copper",Z=JSON.stringify({type:O,content:{id:String(v.value.id)}});await ke(Z)}function Te(){f("[ActionPanel] "),o("action",{type:"wait",copperId:v.value.id})}function Ce(){m.value="full",h.value=null,_.value=!1,o("close")}function ve(){_.value=!1}function X(){m.value="full",h.value=null,o("action",{type:"cancel",copperId:v.value.id})}function A(){X(),Ce()}async function de(V){n.onSelectCopper?await n.onSelectCopper(V):o("selectCopper",V)}return e({cancelAction:X,handleSelectCopper:de,showBuildMenu:B}),(V,O)=>{var Z,re,Ee,Ge,Ue,De,Ze,ot;return I(),U(We,null,[t.copper?(I(),U("div",tv,[tt(j_,{"copper-info":v.value,"inventory-items":[],"inventory-capacity":5,onInventoryClick:Q},null,8,["copper-info"]),tt(pg,{hp:((Z=v.value)==null?void 0:Z.hp)||0,"max-hp":((re=v.value)==null?void 0:re.maxHp)||100},null,8,["hp","max-hp"]),m.value==="minimized"||t.resources&&t.resources.length>0&&m.value==="full"?(I(),U("div",{key:0,class:Ye(["copper-panel",{"copper-panel--minimized":m.value==="minimized","copper-panel--min-attack":m.value==="minimized"&&h.value==="attacking","copper-panel--min-move":m.value==="minimized"&&h.value==="moving","copper-panel--min-summon":m.value==="minimized"&&h.value==="summoning","copper-panel--min-build":m.value==="minimized"&&h.value==="building"}]),onClick:O[0]||(O[0]=ys(()=>{},["stop"]))},[m.value==="minimized"?(I(),U("div",sv,[p("button",{class:"minimized-close",type:"button",onClick:A,title:""},[p("img",{src:ue(d),alt:""},null,8,nv)]),p("div",ov,[p("span",iv,se(v.value.name),1),p("span",av,se(h.value==="moving"?"...":h.value==="attacking"?"...":h.value==="summoning"?"...":h.value==="building"?"...":""),1)])])):(I(),U(We,{key:1},[p("button",{class:"close-btn",onClick:Ce,title:""},[p("img",{src:ue(d),alt:""},null,8,rv)]),p("div",lv,[t.resources&&t.resources.length>0?(I(),U("div",cv,[O[3]||(O[3]=p("div",{class:"resources-header"}," ",-1)),p("div",uv,[(I(!0),U(We,null,Vt(t.resources,(st,xt)=>(I(),U("div",{key:xt,class:"resource-item",onClick:g=>q(xt),title:""},[p("span",fv,se(ue(Ki)(st)),1),p("span",pv,"x"+se(st.count||1),1),O[2]||(O[2]=p("span",{class:"resource-pickup"},"",-1))],8,dv))),128))])])):ye("",!0)])],64))],2)):ye("",!0),n.copper.isEnemy?ye("",!0):(I(),Lt(Cg,{key:1,"copper-type":(Ee=v.value)==null?void 0:Ee.copperType,"can-move":((Ge=v.value)==null?void 0:Ge.canMove)!==!1,"can-attack":((Ue=v.value)==null?void 0:Ue.canAttack)!==!1,"can-summon":((De=v.value)==null?void 0:De.canSummon)!==!1,onMove:b,onWait:Te,onAttack:w,onSummon:$,onBuild:F},null,8,["copper-type","can-move","can-attack","can-summon"])),n.copper.isEnemy?(I(),U("div",hv,[...O[4]||(O[4]=[p("span",null," ",-1)])])):ye("",!0)])):ye("",!0),tt(og,{visible:_.value,"copper-name":((Ze=v.value)==null?void 0:Ze.name)||"",equipment:M.value,onClose:ve,onCraft:L},null,8,["visible","copper-name","equipment"]),tt(ev,{visible:E.value,"copper-name":((ot=v.value)==null?void 0:ot.name)||"","structure-list":S.value,onClose:O[1]||(O[1]=st=>E.value=!1),onBuild:ee},null,8,["visible","copper-name","structure-list"])],64)}}},_v=ut(mv,[["__scopeId","data-v-3fc53dbe"]]),gv={class:"panel"},vv={class:"panel-inner"},yv={class:"section section-header"},bv=["aria-label"],wv={class:"section section-body"},Sv={class:"current-doll",role:"status","aria-live":"polite"},Tv={key:0},Mv={class:"section section-choices",role:"group","aria-label":"Character Queue"},Cv=["aria-pressed","data-copper-id","title","onClick"],Ev=["alt","src","data-default-src","data-selected-src"],xv={class:"actions"},kv=["disabled"],Av=["disabled"],Rv={__name:"TurnSystem",props:{currentCopperId:{type:Number,default:null},copperList:{type:Array,default:()=>[]},roundNumber:{type:Number,default:1},isEnemyMoving:{type:Boolean,default:!1}},emits:["nextCopper","endRound","selectCopper"],setup(t,{emit:e}){Kt(M=>({v47a453cf:r,v1e3f2614:c,c03019fe:l,v4742a9d0:u,v0776a3a9:d,v9cd100b8:m,baf36480:h}));const s=t,n=e,o=W(null),i=G("ui/choice.png"),a=G("ui/choice-active.png"),r=`url('${G("ui/ribbon-left.png")}')`,l=`url('${G("ui/ribbon-middle.png")}')`,c=`url('${G("ui/ribbon-right.png")}')`,u=`url('${G("ui/panel.png")}')`,d=`url('${G("ui/round1.png")}')`,m=`url('${G("ui/currentcupper.png")}')`,h=`url('${G("ui/btn.png")}')`,_=Pe(()=>{if(!s.currentCopperId)return null;const M=s.copperList.find(b=>b.id===s.currentCopperId);return M?{id:M.id,name:M.name||` #${M.id}`,level:M.level??0,isSummon:M.type==="summon"}:null});function E(){n("nextCopper")}async function S(){const M=JSON.stringify({type:"on_game_round_pass"});await ke(M),n("endRound")}function v(M){n("selectCopper",M)}return Et(async()=>{if(!o.value)return;function M(w){return new Promise(($,F)=>{const B=new Image;B.onload=()=>$(B),B.onerror=ee=>{f(":",w,ee),F(ee)},B.src=w})}function b(w,$){o.value&&(o.value.style.setProperty(w,String($)),f(` CSS  ${w} = ${$}`))}try{const[w,$,F]=await Promise.all([M(G("ui/panel.png")),M(G("ui/btn.png")),M(G("ui/currentcupper.png"))]),B=Math.max(4,Math.round(w.naturalHeight/4)),ee=Math.max(3,Math.round($.naturalHeight/3)),Q=Math.max(3,Math.round(F.naturalHeight/4));f(":",{panelSlice:B,btnSlice:ee,currentSlice:Q,currentImgSize:`${F.naturalWidth}x${F.naturalHeight}`}),b("--panel-slice",B),b("--btn-slice",ee),b("--current-slice",Q),setTimeout(()=>{const q=getComputedStyle(o.value);f("CSS :",{"--current-slice":q.getPropertyValue("--current-slice"),"--panel-slice":q.getPropertyValue("--panel-slice"),"--btn-slice":q.getPropertyValue("--btn-slice")})},100)}catch(w){f(":",w),b("--panel-slice","8"),b("--btn-slice","11"),b("--current-slice","8")}}),(M,b)=>(I(),U("div",{ref_key:"turnSystemRef",ref:o,class:"turn-system"},[b[0]||(b[0]=p("div",{class:"ribbon","aria-hidden":"true"},[p("div",{class:"ribbon-cap left"}),p("div",{class:"ribbon-fill"},"CONTROL"),p("div",{class:"ribbon-cap right"})],-1)),p("div",gv,[p("div",vv,[p("section",yv,[p("div",{class:"round-header",role:"img","aria-label":`Round ${t.roundNumber}`}," Round "+se(t.roundNumber),9,bv)]),p("section",wv,[p("div",Sv,[p("span",null,se(_.value?`${_.value.name||` #${t.currentCopperId}`}`:""),1),_.value&&!_.value.isSummon?(I(),U("span",Tv," Lv."+se(_.value.level??0)+" ",1)):ye("",!0)])]),p("section",Mv,[(I(!0),U(We,null,Vt(t.copperList,w=>(I(),U("button",{key:w.id,class:"choice",type:"button","aria-pressed":String(w.id===t.currentCopperId),"data-copper-id":w.id,title:w.name||` #${w.id}`,onClick:$=>v(w.id)},[p("img",{alt:w.name||`Character ${w.id}`,src:w.id===t.currentCopperId?ue(a):ue(i),"data-default-src":ue(i),"data-selected-src":ue(a)},null,8,Ev)],8,Cv))),128))])])]),p("div",xv,[p("button",{class:"btn btn-primary",onClick:E,disabled:!t.currentCopperId||t.isEnemyMoving},"  ",8,kv),p("button",{class:"btn btn-secondary",onClick:S,disabled:t.isEnemyMoving},"  ",8,Av)])],512))}},$v=ut(Rv,[["__scopeId","data-v-a62c4b3a"]]),Pv={class:"modal-info"},Lv={class:"info-text"},Iv={class:"copper-name"},Ov={class:"cost-text"},Dv=["src"],Nv={class:"modal-body"},Gv={class:"enemy-list"},Hv=["onClick"],Uv={class:"enemy-header"},Fv={class:"enemy-name-row"},Bv={class:"enemy-name"},jv={class:"enemy-level"},zv={class:"enemy-type"},Vv={class:"enemy-stats"},Kv={class:"stat"},Wv={class:"stat-value"},qv={class:"stat"},Xv={class:"stat-value"},Yv={class:"stat"},Jv={class:"stat-value"},Zv={class:"stat"},Qv={class:"stat-value"},ey={class:"stat"},ty={class:"stat-value"},sy={class:"enemy-desc"},ny={key:0,class:"selected-badge"},oy={class:"modal-footer"},iy=["disabled"],ay={__name:"SummonModal",props:{visible:{type:Boolean,default:!1},copperName:{type:String,default:""},enemyList:{type:Array,default:()=>[]},position:{type:Array,default:null}},emits:["close","summon"],setup(t,{emit:e}){Kt(d=>({v30033463:s}));const s=`url('${G("@assets/ui/panel6.png")}')`,n=t,o=e,i=W(null),a=Pe(()=>[...n.enemyList].sort((d,m)=>d.level-m.level));function r(d){i.value=d}function l(){if(!i.value){f("[SummonModal] ");return}f("[SummonModal] :",i.value.name),o("summon",i.value.name),c()}function c(){i.value=null,o("close")}function u(d){return{goblin:"",cruiser:"",scout:"",boxer:"",horn:"",assassin:"",devourer:"",mirror:"",guard:"",demon:"",variant:"",shatra:"BOSS",glutton:"BOSS"}[d]||d}return(d,m)=>(I(),Lt(Zr,{to:"body"},[t.visible?(I(),U("div",{key:0,class:"modal-overlay",onClick:ys(c,["self"])},[p("div",{class:"summon-modal",onClick:m[0]||(m[0]=ys(()=>{},["stop"]))},[p("div",{class:"modal-header"},[m[1]||(m[1]=p("h2",{class:"modal-title"}," ",-1)),p("button",{class:"close-btn",onClick:c,title:""},"")]),p("div",Pv,[p("p",Lv,[p("span",Iv,se(t.copperName),1),m[2]||(m[2]=Ps("  ",-1))]),p("p",Ov,[p("img",{class:"cost-icon",src:ue(G)("resource/spiritual_spark.webp"),alt:""},null,8,Dv),m[3]||(m[3]=Ps(" ",-1)),m[4]||(m[4]=p("strong",null,"1 ",-1))])]),p("div",Nv,[p("div",Gv,[(I(!0),U(We,null,Vt(a.value,h=>{var _,E;return I(),U("div",{key:h.name,class:Ye(["enemy-card",{selected:((_=i.value)==null?void 0:_.name)===h.name}]),onClick:S=>r(h)},[p("div",Uv,[p("div",Fv,[p("span",Bv,se(h.name),1),p("span",jv,"Lv."+se(h.level),1)]),p("span",zv,se(u(h.enemy_type)),1)]),p("div",Vv,[p("div",Kv,[m[5]||(m[5]=p("span",{class:"stat-label"},"",-1)),p("span",Wv,se(h.health),1)]),p("div",qv,[m[6]||(m[6]=p("span",{class:"stat-label"},"",-1)),p("span",Xv,se(h.attack),1)]),p("div",Yv,[m[7]||(m[7]=p("span",{class:"stat-label"},"",-1)),p("span",Jv,se(h.defense),1)]),p("div",Zv,[m[8]||(m[8]=p("span",{class:"stat-label"},"",-1)),p("span",Qv,se(h.attack_range),1)]),p("div",ey,[m[9]||(m[9]=p("span",{class:"stat-label"},"",-1)),p("span",ty,se(h.move_range),1)])]),p("div",sy,se(h.description),1),((E=i.value)==null?void 0:E.name)===h.name?(I(),U("div",ny,"   ")):ye("",!0)],10,Hv)}),128))])]),p("div",oy,[p("button",{class:"btn btn-cancel",onClick:c},""),p("button",{class:"btn btn-confirm",disabled:!i.value,onClick:l},"  ",8,iy)])])])):ye("",!0)]))}},ry=ut(ay,[["__scopeId","data-v-4a0a4142"]]),ly={key:0,class:"minimized-content"},cy={class:"minimized-info"},uy={class:"minimized-name"},dy={class:"minimized-action"},fy={key:1},py={class:"structure-panel__header"},hy={class:"structure-panel__title"},my={class:"structure-panel__body"},_y={class:"structure-panel__health"},gy={class:"structure-panel__health-bar"},vy={class:"structure-panel__health-text"},yy={key:0,class:"structure-panel__storage"},by={class:"structure-panel__storage-content"},wy={key:0,class:"structure-panel__storage-item"},Sy={class:"structure-panel__storage-name"},Ty={class:"structure-panel__storage-count"},My={key:1,class:"structure-panel__storage-empty"},Cy={key:1,class:"structure-panel__ground-resources"},Ey={class:"structure-panel__ground-list"},xy={class:"structure-panel__resource-name"},ky={class:"structure-panel__resource-count"},Ay={key:2,class:"structure-panel__actions"},Ry={__name:"StructurePanel",props:{structure:{type:Object,required:!0},resources:{type:Array,default:()=>[]},actionMode:{type:String,default:null}},emits:["close","action","cancel"],setup(t,{emit:e}){Kt(w=>({v31b4b180:_}));const s=t,n=e,o=Pe(()=>{var w;return((w=s.structure.structure_base)==null?void 0:w.name)||""}),i=Pe(()=>s.structure.owned||!1),a=Pe(()=>{var w;return((w=s.structure.structure_base)==null?void 0:w.has_storage)||!1}),r=Pe(()=>s.structure.storage||null),l=Pe(()=>s.structure.can_move||!1),c=Pe(()=>s.structure.can_attack||!1),u=Pe(()=>s.structure.now_health||0),d=Pe(()=>{var w;return((w=s.structure.structure_base)==null?void 0:w.health)||100}),m=Pe(()=>d.value===0?0:Math.max(0,Math.min(100,u.value/d.value*100))),h=Pe(()=>{const w=m.value;return w>60?"#4ade80":w>30?"#facc15":"#ef4444"});G("@assets/ui/panel.png");const _=`url('${G("@assets/ui/panel11.png")}')`,E=Pe(()=>s.actionMode!==null),S=Pe(()=>s.actionMode==="move"?"...":s.actionMode==="attack"?"...":s.actionMode==="extract"?"...":s.actionMode==="transfer"?"...":"");function v(w){f(`[StructurePanel] : ${w}`),n("action",{type:w})}function M(){f("[StructurePanel] "),n("cancel")}function b(){n("close")}return(w,$)=>(I(),U("div",{class:Ye(["structure-panel",{"structure-panel--minimized":E.value}])},[E.value?(I(),U("div",ly,[p("div",cy,[p("span",uy,se(o.value),1),p("span",dy,se(S.value),1)]),p("div",{class:"minimized-actions"},[p("button",{class:"mini-btn mini-btn--cancel",onClick:M,title:""},"  ")])])):(I(),U("div",fy,[p("div",py,[p("div",hy,[Ps(se(o.value)+" ",1),p("span",{class:Ye(["structure-panel__badge",{"structure-panel__badge--owned":i.value}])},se(i.value?"":""),3)]),p("button",{class:"structure-panel__close",onClick:b,"aria-label":""},"  ")]),p("div",my,[p("div",_y,[$[4]||($[4]=p("div",{class:"structure-panel__health-label"},"",-1)),p("div",gy,[p("div",{class:"structure-panel__health-fill",style:Ft({width:m.value+"%",backgroundColor:h.value})},null,4)]),p("div",vy,se(Math.ceil(u.value))+" / "+se(Math.ceil(d.value)),1)]),a.value?(I(),U("div",yy,[$[5]||($[5]=p("div",{class:"structure-panel__storage-label"},"",-1)),p("div",by,[r.value?(I(),U("div",wy,[p("span",Sy,se(ue(Ki)(r.value)),1),p("span",Ty,"x"+se(r.value.count||0),1)])):(I(),U("div",My,""))])])):ye("",!0),t.resources&&t.resources.length>0?(I(),U("div",Cy,[$[6]||($[6]=p("div",{class:"structure-panel__ground-label"},"",-1)),p("div",Ey,[(I(!0),U(We,null,Vt(t.resources,(F,B)=>(I(),U("div",{key:B,class:"structure-panel__ground-item"},[p("span",xy,se(F.name||""),1),p("span",ky,"x"+se(F.count||0),1)]))),128))])])):ye("",!0),i.value?(I(),U("div",Ay,[l.value?(I(),U("button",{key:0,class:"structure-panel__action-btn structure-panel__action-btn--move",onClick:$[0]||($[0]=F=>v("move"))},"  ")):ye("",!0),c.value?(I(),U("button",{key:1,class:"structure-panel__action-btn structure-panel__action-btn--attack",onClick:$[1]||($[1]=F=>v("attack"))},"  ")):ye("",!0),a.value&&r.value?(I(),U("button",{key:2,class:"structure-panel__action-btn structure-panel__action-btn--transfer",onClick:$[2]||($[2]=F=>v("transfer"))},"  ")):ye("",!0),a.value?(I(),U("button",{key:3,class:"structure-panel__action-btn structure-panel__action-btn--extract",onClick:$[3]||($[3]=F=>v("extract"))},"  ")):ye("",!0)])):ye("",!0)])]))],2))}},$y=ut(Ry,[["__scopeId","data-v-c3c198e2"]]),Py={class:"resource-panel"},Ly={class:"resource-list"},Iy={class:"resource-layout"},Oy={class:"row row-top"},Dy=["title"],Ny=["src","alt"],Gy={class:"resource-count"},Hy={class:"resource-tooltip"},Uy=["title"],Fy=["src","alt"],By={class:"resource-count"},jy={class:"resource-tooltip"},zy={class:"row row-middle"},Vy=["title"],Ky=["src","alt"],Wy={class:"resource-count"},qy={class:"resource-tooltip"},Xy={class:"row row-bottom"},Yy=["title"],Jy=["src","alt"],Zy={class:"resource-count"},Qy={class:"resource-tooltip"},eb=["title"],tb=["src","alt"],sb={class:"resource-count"},nb={class:"resource-tooltip"},ob={class:"crafting-section"},ib={class:"crafting-grid"},ab=["src"],rb={class:"craft-count"},lb={class:"craft-arrow-group"},cb=["src","alt"],ub={class:"craft-result"},db={class:"recipe-display"},fb=["src"],pb={class:"craft-count"},hb={__name:"ResourcePanel",setup(t,{expose:e}){Kt(d=>({v6e6b9dca:n}));const n=`url('${G("@assets/ui/panel5.png")}')`,o=W({SpiritalSpark:0,RecallGear:0,ResonantCrystal:0,RefinedCopper:0,HeartCrystalDust:0}),i=["HeartCrystalDust","RecallGear","ResonantCrystal","RefinedCopper"],a=W(!1),r=W({visible:!1,success:!0,text:""});function l(d,m=!0,h=1500){r.value={visible:!0,success:m,text:d},window.clearTimeout(l._timer),l._timer=window.setTimeout(()=>{r.value.visible=!1},h)}async function c(){if(!a.value){a.value=!0;try{const d=await zf();js(Pt.UPDATE_RESOURCES),(d==null?void 0:d.type)==="error"?(console.warn("[ResourcePanel] :",(d==null?void 0:d.content)||d),l("",!1)):(console.log("[ResourcePanel] :",d),l("",!0))}catch(d){console.error("[ResourcePanel] :",d),l("",!1)}finally{a.value=!1}}}async function u(){try{const d=await Lo();if(d){const m={},h={};return Object.keys(o.value).forEach(_=>{const E=o.value[_],S=d[_]||0;h[_]=S;const v=S-E;v>0&&(m[_]=v)}),o.value=h,js(Pt.RESOURCES_UPDATED,m),m}}catch(d){console.error("[ResourcePanel] :",d)}return{}}return Et(()=>{u(),Po(Pt.UPDATE_RESOURCES,u)}),cs(()=>{qi(Pt.UPDATE_RESOURCES,u)}),e({updateResources:u}),(d,m)=>{var h;return I(),U("div",Py,[m[0]||(m[0]=p("div",{class:"resource-header"},[p("span",{class:"header-text"},"")],-1)),p("div",Ly,[p("div",Iy,[p("div",Oy,[p("div",{class:"resource-slot small",title:ue(_t)("RecallGear")},[ue(ss)("RecallGear")?(I(),U("img",{key:0,src:ue(ss)("RecallGear"),alt:ue(_t)("RecallGear"),class:"resource-icon"},null,8,Ny)):ye("",!0),p("div",Gy,se(o.value.RecallGear||0),1),p("div",Hy,se(ue(_t)("RecallGear")),1)],8,Dy),p("div",{class:"resource-slot small",title:ue(_t)("HeartCrystalDust")},[ue(ss)("HeartCrystalDust")?(I(),U("img",{key:0,src:ue(ss)("HeartCrystalDust"),alt:ue(_t)("HeartCrystalDust"),class:"resource-icon"},null,8,Fy)):ye("",!0),p("div",By,se(o.value.HeartCrystalDust||0),1),p("div",jy,se(ue(_t)("HeartCrystalDust")),1)],8,Uy)]),p("div",zy,[p("div",{class:"resource-slot large",title:ue(_t)("SpiritalSpark")},[ue(ss)("SpiritalSpark")?(I(),U("img",{key:0,src:ue(ss)("SpiritalSpark"),alt:ue(_t)("SpiritalSpark"),class:"resource-icon"},null,8,Ky)):ye("",!0),p("div",Wy,se(o.value.SpiritalSpark||0),1),p("div",qy,se(ue(_t)("SpiritalSpark")),1)],8,Vy)]),p("div",Xy,[p("div",{class:"resource-slot small",title:ue(_t)("ResonantCrystal")},[ue(ss)("ResonantCrystal")?(I(),U("img",{key:0,src:ue(ss)("ResonantCrystal"),alt:ue(_t)("ResonantCrystal"),class:"resource-icon"},null,8,Jy)):ye("",!0),p("div",Zy,se(o.value.ResonantCrystal||0),1),p("div",Qy,se(ue(_t)("ResonantCrystal")),1)],8,Yy),p("div",{class:"resource-slot small",title:ue(_t)("RefinedCopper")},[ue(ss)("RefinedCopper")?(I(),U("img",{key:0,src:ue(ss)("RefinedCopper"),alt:ue(_t)("RefinedCopper"),class:"resource-icon"},null,8,tb)):ye("",!0),p("div",sb,se(o.value.RefinedCopper||0),1),p("div",nb,se(ue(_t)("RefinedCopper")),1)],8,eb)])])]),p("div",ob,[p("div",ib,[(I(),U(We,null,Vt(i,(_,E)=>{var S;return p("div",{class:"craft-slot",key:E},[(S=ue(Yt)[_])!=null&&S.icon?(I(),U("img",{key:0,src:ue(Yt)[_].icon,class:"craft-icon"},null,8,ab)):ye("",!0),p("div",rb,se(o.value[_]||0),1)])}),64))]),p("div",lb,[p("img",{class:Ye(["craft-arrow-img",{disabled:a.value}]),src:ue(G)("@assets/ui/upgrade.png"),alt:a.value?"":"",onClick:c},null,10,cb),r.value.visible?(I(),U("div",{key:0,class:Ye(["craft-toast",{success:r.value.success,error:!r.value.success}])},se(r.value.text),3)):ye("",!0)]),p("div",ub,[p("div",db,[(h=ue(Yt).SpiritalSpark)!=null&&h.icon?(I(),U("img",{key:0,src:ue(Yt).SpiritalSpark.icon,class:"recipe-icon"},null,8,fb)):ye("",!0),p("div",pb,se(o.value.SpiritalSpark||0),1)])])])])}}},mb=ut(hb,[["__scopeId","data-v-f3ce41a7"]]),_b={class:"game-scene"},gb={key:6,class:"info-panel"},vb={key:7,class:"game-over-overlay"},yb={key:8,class:"game-over-overlay"},bb={key:9,class:"credits-overlay"},wb={key:10,class:"game-over-overlay"},Sb=["src"],Tb=["src"],Mb=["src"],Cb=["src"],Eb=["src"],xb=["src"],kb=["src"],Ab=.2,Rb="url('/assets/panel7.png')",$b="url('/assets/panel8.png')",Pb={__name:"GameScene",props:{isGameMode:{type:Boolean,default:!1},musicOn:{type:Boolean,default:!0}},emits:["back"],setup(t,{emit:e}){Kt(x=>({v4b5315d0:Rb,v4b522d12:$b}));const s=t,n=W(null),o=e,i=W(null),a=G("@assets/frontend_resource/gamescene.mp3"),r=W(null),l=W(null),c=W(null),u=W(null),d=W(null),m=W(null),h=G("@assets/frontend_resource/move.mp3"),_=G("@assets/frontend_resource/move_enemy.mp3"),E=G("@assets/frontend_resource/attack.mp3"),S=G("@assets/frontend_resource/attack_enemy.mp3"),v=G("@assets/frontend_resource/me_hurt.mp3"),M=G("@assets/frontend_resource/enemy_hurt.mp3");let b,w,$,F,B=[],ee={focusPosition:null,focusTarget:null,lerpFactor:.08},Q=null,q=new At,P=null,L=null,fe=null,Te=null;const Ce=new Map,ve={w:!1,a:!1,s:!1,d:!1,shift:!1,space:!1},X=W(tr("controlMode")||"touchpad"),A=W(tr("mouseSensitivity")||.002);window.updateControlMode=x=>{X.value=x,f(`[GameScene] : ${x}`)},window.updateMouseSensitivity=x=>{A.value=x};function de(x){const k=x.key.toLowerCase();k==="w"||k==="a"||k==="s"||k==="d"?ve[k]=!0:k==="shift"?ve.shift=!0:k===" "?(ve.space=!0,x.preventDefault()):k==="escape"&&document.pointerLockElement&&document.exitPointerLock()}function V(x){const k=x.key.toLowerCase();k==="w"||k==="a"||k==="s"||k==="d"?ve[k]=!1:k==="shift"?ve.shift=!1:k===" "&&(ve.space=!1)}let O=!1,Z=0,re=0,Ee=0,Ge=0,Ue=!1;function De(x){x.button===0&&(X.value==="mouse"&&n.value&&n.value.requestPointerLock(),O=!0,Z=x.clientX,re=x.clientY)}function Ze(){O=!1}function ot(x){if(X.value==="touchpad"){if(!O)return;const k=x.clientX-Z,J=x.clientY-re;Ge-=k*A.value,Ee-=J*A.value,Z=x.clientX,re=x.clientY}else if(X.value==="mouse"&&Ue){const k=x.movementX||0,J=x.movementY||0;Ge-=k*A.value,Ee-=J*A.value}Ee=Math.max(-Math.PI/2,Math.min(Math.PI/2,Ee)),w.rotation.order="YXZ",w.rotation.y=Ge,w.rotation.x=Ee}function st(){Ue=document.pointerLockElement===n.value,f(Ue?"[GameScene] ":"[GameScene] ")}function xt(){f("[GameScene] ")}const g=W(null),T=W([]),R=W(null),j=W(!1),H=W([]),N=W([]),K=W(null),oe=W(null),Y=W(!1),z=W(null),_e=W([]),le=W(null),pe=W(1),ce=W([]),ge=W(-1),ie=W(null),Me=W(!1),qe=W(new Set),Qe=W(!1),dt=new Map,ft=W(!1),Nt=W(!1),es=W(!1),it=W(!1),Gt=Pe(()=>{if(ce.value.length===0||ge.value<0||ge.value>=ce.value.length)return null;const x=ce.value[ge.value];return x?x.id:null});Et(async()=>{var k;f("[GameScene] "),Dn(),f("[GameScene] "),Wl(),f("[GameScene] ");const{messageQueue:x}=await Ol(async()=>{const{messageQueue:J}=await Promise.resolve().then(()=>Bf);return{messageQueue:J}},void 0,import.meta.url);if((k=x.sceneContext)!=null&&k.setTestMode&&x.sceneContext.setTestMode("eventloop"),window.__ACTUAL_COPPER_IDS__){const J=window.__ACTUAL_COPPER_IDS__;f("[GameScene] ID:",J);const te=JSON.stringify({type:"on_game_start",content:{ids:J}});ke(te).catch(he=>{f("[GameScene] ",he)}),delete window.__ACTUAL_COPPER_IDS__}else f("[GameScene] ID");window.addEventListener("keydown",de),window.addEventListener("keyup",V),window.addEventListener("mousedown",De),window.addEventListener("mouseup",Ze),window.addEventListener("mousemove",ot),document.addEventListener("pointerlockchange",st),document.addEventListener("pointerlockerror",xt),Ji(),s.musicOn&&i.value&&setTimeout(()=>{if(i.value.readyState>=2)i.value.play().then(()=>{f("[GameScene] ")}).catch(te=>{f("[GameScene] :",te)});else{const te=()=>{i.value.play().then(()=>{f("[GameScene] ")}).catch(he=>{f("[GameScene] :",he)}),i.value.removeEventListener("canplay",te)};i.value.addEventListener("canplay",te,{once:!0})}},200)}),It(()=>s.musicOn,x=>{if(i.value)if(x)if(i.value.readyState>=2)i.value.play().catch(k=>{f("[GameScene] :",k)});else{const k=()=>{i.value.play().catch(J=>{f("[GameScene] :",J)}),i.value.removeEventListener("canplay",k)};i.value.addEventListener("canplay",k)}else i.value.pause()}),cs(()=>{window.removeEventListener("resize",Yi),window.removeEventListener("click",Zi),window.removeEventListener("keydown",de),window.removeEventListener("keyup",V),window.removeEventListener("mousedown",De),window.removeEventListener("mouseup",Ze),window.removeEventListener("mousemove",ot),document.removeEventListener("pointerlockchange",st),document.removeEventListener("pointerlockerror",xt),document.pointerLockElement&&document.exitPointerLock(),i.value&&i.value.pause(),L&&L.dispose(),fe&&fe.dispose(),Te&&Te.dispose(),$&&$.dispose()});function Dn(){b=new _o,b.background=new as(2236962),w=new Ln(60,window.innerWidth/window.innerHeight,.1,2e3),w.position.set(0,5,10),Q=new aa,$=new go({antialias:!0}),$.setSize(window.innerWidth,window.innerHeight),$.setPixelRatio(window.devicePixelRatio),n.value.appendChild($.domElement),F=null;const x=new vo(16777215,.8);b.add(x);const k=new gs(16777215,1);k.position.set(5,10,5),b.add(k),P=new Io;const J=new Oo;J.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),P.setDRACOLoader(J),s.isGameMode&&window.addEventListener("click",Zi),Nn(),L=v_(b,w),fe=y_(b),Te=w_(b),f("[GameScene] "),f('[GameScene] - /(ID=1,2)""'),f("[GameScene] - EventLoop"),window.addEventListener("resize",Yi)}function Nn(){const x=new qt(.8,.8,.8),k=new $t({color:4491519}),J=new et(x,k);J.position.set(.5,.4,.5),b.add(J),B.push({id:1,object:J,name:"1",type:"test"});const te=new qt(.8,.8,.8),he=new $t({color:16729156}),y=new et(te,he);y.position.set(4.5,.4,4.5),b.add(y),B.push({id:2,object:y,name:"2",type:"test"}),f("[GameScene] :",B.map(C=>`ID=${C.id}`))}async function zl(x,k,J,te=1){const he=Ro(x,k);try{const y=await Ot.loadModel(he,!0);f(`[GameScene] : ${k}`);const C=y.clone(!0);C.traverse(be=>{be.material&&(Array.isArray(be.material)?be.material=be.material.map(we=>we.clone()):be.material=be.material.clone())});const ne=new wt().setFromObject(C).getSize(new Ae),ae=new Xt;ae.add(C),ae.position.set(J[0],0,J[1]),ae.scale.set(te,te,te),ae.rotation.y=0;const me=new wt().setFromObject(ae);return ae.position.y=-me.min.y,f(`[GameScene] : ${k}, URL: ${he}`),ae}catch(y){return f(`[GameScene] : ${k}`,y),null}}async function Vl(x,k,J=1,te="model"){try{const he=await Ot.loadModel(x,!0);f(`[GameScene] : ${te}, url=${x}`);const y=he.clone(!0);y.traverse(ae=>{ae.material&&(Array.isArray(ae.material)?ae.material=ae.material.map(me=>me.clone()):ae.material=ae.material.clone())});const D=new wt().setFromObject(y).getSize(new Ae),ne=new Xt;return ne.add(y),ne.position.set(k[0],0,k[1]),ne.scale.set(J,J,J),ne}catch(he){return f(`[GameScene] : ${te}, url=${x}, error=${he}`),null}}async function Kl(x,k,J=1){const te=$o(x);try{const he=await Ot.loadModel(te,!0);f(`[GameScene] : ${x}`);const y=he.clone(!0);y.traverse(be=>{be.material&&(Array.isArray(be.material)?be.material=be.material.map(we=>we.clone()):be.material=be.material.clone())});const D=new wt().setFromObject(y).getSize(new Ae),ne=new Xt;ne.add(y),ne.position.set(k[0],0,k[1]),ne.scale.set(J,J,J),ne.rotation.y=0;const ae=new wt().setFromObject(ne);ne.position.y=-ae.min.y;const me=new Xs(16729156,2.5,12);return me.position.set(0,D.y*J*.8,0),ne.add(me),f(`[GameScene] : ${x}, URL: ${te}`),ne}catch(he){return f(`[GameScene] : ${x}`,he),null}}let Gn=null;function Wl(){const x=new Map,k=new Map,J=new Map;function te(y,C,D){const ne=B.find(we=>we.id===y);if(!ne||!ne.object)return;let ae,me;C==="move"?(ae=65280,me=.8):C==="attack"?(ae=16711680,me=1):C==="summon"?(ae=16776960,me=1.2):(ae=16777215,me=1),x.has(y)||x.set(y,{});const be=x.get(y);if(be[C]&&(b.remove(be[C]),be[C].geometry.dispose(),be[C].material.dispose(),delete be[C]),D){const we=new ci(me-.1,me,32),$e=new Ct({color:ae,side:ks,transparent:!0,opacity:.6}),ze=new et(we,$e);ze.rotation.x=-Math.PI/2,ze.position.set(ne.object.position.x,.1,ne.object.position.z),b.add(ze),be[C]=ze}}const he=y=>{if(B.forEach(C=>{C.object&&(C.object.scale.set(1,1,1),C.object.traverse(D=>{var ne;D.material&&((ne=D.material.emissive)==null||ne.setHex(0),D.material.emissiveIntensity!==void 0&&(D.material.emissiveIntensity=0))}))}),y!==null){const C=B.find(D=>D.id===y);if(C){C.object.scale.set(1.1,1.1,1.1),C.object.traverse(ne=>{ne.material&&ne.material.emissive&&(ne.material.emissive.setHex(16755200),ne.material.emissiveIntensity=.5)});const D=C.type==="summon"?"":C.type==="copper"?"":"";f(`[GameScene] ${D}: ${C.name} (ID=${y})`)}}};Gn=(y,C)=>{const D=B.find(at=>at.id===y);if(!D)return;const ne=new Map;D.object.traverse(at=>{at.material&&at.material.emissive&&(ne.set(at,{color:at.material.emissive.getHex(),intensity:at.material.emissiveIntensity||0}),at.material.emissive.setHex(16711680),at.material.emissiveIntensity=.8)}),setTimeout(()=>{ne.forEach((at,Wt)=>{Wt.material&&Wt.material.emissive&&(Wt.material.emissive.setHex(at.color),Wt.material.emissiveIntensity=at.intensity)})},500);const ae=new Ae(D.object.position.x,.5,D.object.position.z),me=new Ae(C[0],.5,C[1]),be=new Ae().subVectors(me,ae),we=be.length(),$e=new Ae().addVectors(ae,me).multiplyScalar(.5),ze=new so(.05,.05,we,8),Ne=new Ct({color:16729156,transparent:!0,opacity:.9,emissive:16729156,emissiveIntensity:.5}),Ie=new et(ze,Ne);Ie.position.copy($e),Ie.quaternion.setFromUnitVectors(new Ae(0,1,0),be.normalize()),b.add(Ie);const He=new ci(.2,.4,32),je=new Ct({color:16711680,side:ks,transparent:!0,opacity:.8,emissive:16711680,emissiveIntensity:.5}),mt=new et(He,je);mt.rotation.x=-Math.PI/2,mt.position.copy(me),b.add(mt);const Os=performance.now(),rt=300;function lt(){const Wt=(performance.now()-Os)/rt;if(Wt<1){const ln=1-Wt;Ne&&(Ne.opacity=ln),je&&(je.opacity=ln),mt.scale.set(1+Wt*2,1+Wt*2,1),requestAnimationFrame(lt)}else b.remove(Ie),b.remove(mt),ze.dispose(),Ne.dispose(),He.dispose(),je.dispose()}lt(),f(`[GameScene] : ID=${y}, =${ae.x.toFixed(1)},${ae.z.toFixed(1)}  [${C[0]},${C[1]}]`)},xe.setSceneContext({scene:b,camera:w,controls:F,models:B,gridCellSize:1,focusState:ee,focusOnModel:ql,onShowCopperInfo:(y,C,D)=>{var ae,me,be,we,$e,ze,Ne,Ie,He,je,mt;f(`[GameScene] onShowCopperInfo : type=${(ae=y.copper)==null?void 0:ae.copper_type}, can_build=${y.can_build}, can_summon=${y.can_summon}`),((me=y.copper)==null?void 0:me.copper_type)==="CraftsMan"&&y.id!==void 0&&dt.set(y.id,y.can_build===!0);const ne=((we=(be=y.copper)==null?void 0:be.copper_info)==null?void 0:we.name)||y.name||((ze=($e=y.enemy)==null?void 0:$e.enemy_base)==null?void 0:ze.name)||((Ie=(Ne=y.enemy)==null?void 0:Ne.enemy_base)==null?void 0:Ie.enemy_type)||((He=y.enemy_base)==null?void 0:He.name)||((je=y.enemy_base)==null?void 0:je.enemy_type)||` #${y.id}`;((mt=y.copper)==null?void 0:mt.copper_type)==="CraftsMan"?(f(`[GameScene]  can_build=${y.can_build}  can_summon`),g.value={...y,name:ne,can_summon:y.can_build===!0}):g.value={...y,name:ne},T.value=C||[],j.value=D||!1,f(`[GameScene] : ID=${g.value.id}, has_attack_targets=${j.value}, can_summon=${g.value.can_summon}`)},onShowStructureInfo:(y,C)=>{var D;K.value=y,oe.value={structure:y,resources:C},f(`[GameScene] : ID=${y.id}, =${(D=y.structure_base)==null?void 0:D.name}, =${y.now_health}/${y.structure_base.health}`)},highlightSelectedCopper:he,createAttackEffect:Gn,onMoveStart:(y,C)=>{s.isGameMode&&Me.value&&(C==null?void 0:C.type)==="enemy"&&!(C!=null&&C.isOwned)&&(f(`[GameScene]  ${y} `),qe.value.add(y))},onMoveComplete:y=>{if(!s.isGameMode)return;const C=B.find(me=>me.id===y);if((C==null?void 0:C.type)==="structure"){f("[GameScene] "),ie.value=null,Qe.value=!1,setTimeout(async()=>{await rn(y)},300);return}if((C==null?void 0:C.type)==="enemy"&&!(C!=null&&C.isOwned)){Me.value&&qe.value.has(y)?(f(`[GameScene]  ${y} `),qe.value.delete(y),qe.value.size===0&&(f("[GameScene] "),Me.value=!1)):f(`[GameScene]  ${y} `);return}const ne=ce.value.some(me=>me.id===y),ae=(C==null?void 0:C.type)==="summon"||(C==null?void 0:C.isOwned);!ne&&!ae||(Qe.value=!1,f("[GameScene] "),ie.value=null,R.value&&R.value.cancelAction(),setTimeout(async()=>{(C==null?void 0:C.type)==="summon"?await Hn(y,!1):await Is(y),setTimeout(()=>{if(T.value&&T.value.length>0){f("[GameScene] ");return}ea()},100)},300))},onCraftResult:(y,C)=>{f(`[GameScene] : ${y?"":""} - ${C}`),alert(C)},onResourceNotEnough:y=>{f(`[GameScene] : ${y}`),alert(` ${y}`),ie.value=null,le.value=null,Y.value=!1,z.value=null},onSummonFailed:y=>{f(`[GameScene] : ${y}`),alert(` ${y}`),ie.value=null,Y.value=!1,z.value=null},onShowSummonMenu:y=>{f("[GameScene] :",y),_e.value=y||[]},onShowStructureMenu:y=>{var C;f("[GameScene] ",(y==null?void 0:y.length)||0,""),(C=R.value)!=null&&C.showBuildMenu?R.value.showBuildMenu(y||[]):f("[GameScene]  copperActionPanelRef.value.showBuildMenu ")},onRemoveCopper:y=>{const C=ce.value.findIndex(D=>D.id===y);C>-1&&(f(`[GameScene] : ID=${y}`),ce.value.splice(C,1),g.value&&g.value.id===y&&No(),ce.value.length===0||ge.value===C?ge.value=-1:ge.value>C?ge.value-=1:ge.value>=ce.value.length&&(ge.value=ce.value.length-1))},onShowResourceGain:(y,C)=>{f("[GameScene] :",y,C),Te&&Object.keys(C).length>0&&Te.createResourceGainEffect(y,C)},onGameOver:()=>{f("[GameScene] "),ft.value=!0},onGameSuccess:()=>{f("[GameScene] "),Nt.value=!0},onAttackComplete:y=>{if(!s.isGameMode)return;const C=B.find(ne=>ne.id===y);if((C==null?void 0:C.type)==="structure"){f("[GameScene] "),ie.value=null,setTimeout(async()=>{await rn(y)},300);return}if(!ce.value.some(ne=>ne.id===y)){f("[GameScene] ");return}f("[GameScene] "),ie.value=null,R.value&&R.value.cancelAction(),setTimeout(async()=>{(C==null?void 0:C.type)==="summon"?await Hn(y,!1):await Is(y),setTimeout(()=>{if(T.value&&T.value.length>0){f("[GameScene] ");return}ea()},100)},300)},onSetMoveBlock:y=>{fe&&fe.createIndicator(y,"move"),f(`[GameScene] : =${y}`)},onSetAttackBlock:y=>{if(ie.value==="transferring"){H.value.push(y);const C=B.find(D=>{if(D.type==="copper"&&D.object){const ne=D.object.position;return Math.abs(ne.x-y[0])<.1&&Math.abs(ne.z-y[1])<.1}return!1});if(C){const D=ce.value.find(ae=>ae.id===C.id);N.value.find(ae=>ae.id===C.id)||(N.value.push({id:C.id,name:C.name||(D?D.name:` #${C.id}`)||` #${C.id}`,position:y}),f(`[GameScene] : ${C.name||C.id} (ID=${C.id}), =${N.value.length}`))}else f(`[GameScene]  ${y} `)}else fe&&fe.createIndicator(y,"attack"),j.value=!0,f(`[GameScene] : ${y}`)},onSetCanSummonBlock:y=>{fe&&fe.createIndicator(y,"summon"),f(`[GameScene] : =${y}`)},onClearBlock:y=>{fe&&fe.clearIndicatorAt(y)},onSetCopper:async(y,C,D)=>{var Ne,Ie,He,je,mt,Os;if(f(`[GameScene] : id=${D.id}, pos=${C}`),B.find(rt=>rt.id===D.id)){f(`[GameScene] ID=${D.id}`);return}if(((Ne=D.copper)==null?void 0:Ne.copper_type)==="CraftsMan"&&(dt.set(D.id,D.can_build===!0),f(`[GameScene]  can_build : id=${D.id}, can_build=${D.can_build}`)),s.isGameMode){const rt={id:D.id,name:((Ie=D.copper.copper_info)==null?void 0:Ie.name)||` #${D.id}`,level:Number(((He=D.copper)==null?void 0:He.level)??0),turnDone:!1};ce.value.find(lt=>lt.id===D.id)||(ce.value.push(rt),f(`[GameScene] : ${rt.name}`))}const ae=D.copper.copper_type||"Arcanist",me=((je=D.copper.copper_info)==null?void 0:je.name)||"default",be=(mt=D.copper.copper_info)==null?void 0:mt.model_url;let we=1;switch(ae){case"IronWall":we=1.2;break;case"Arcanist":we=1;break;case"Mechanic":we=1.1;break;case"Resonator":we=1;break;case"CraftsMan":we=1;break;default:we=1}let $e;if(be&&be.includes("/enemy/")){const rt=G(be);if(f(`[GameScene] URL: ${be} -> ${rt}`),$e=await Vl(rt,C,we,me),$e){const at=new wt().setFromObject($e).getSize(new Ae),Wt=new wt().setFromObject($e);$e.position.y=-Wt.min.y;const ln=new Xs(4474111,2.5,12);ln.position.set(0,at.y*we*.8,0),$e.add(ln)}}else{const rt=h_(me),lt=m_(ae);f(`[GameScene] : =${me}, =${rt}, type=${ae}, typeFolder=${lt}`),$e=await zl(lt,rt,C,we)}if(!$e){f(`[GameScene] : ${me}`);const rt=new qt(.8,.8,.8);let lt=4491519;switch(ae){case"IronWall":lt=8947848;break;case"Arcanist":lt=16729224;break;case"Mechanic":lt=4521864;break;case"Resonator":lt=16755268;break;case"CraftsMan":lt=4474111;break}const at=new $t({color:lt});$e=new et(rt,at),$e.position.set(C[0],.4,C[1])}$e.userData.modelId=D.id,b.add($e);const ze={id:D.id,object:$e,name:((Os=D.copper.copper_info)==null?void 0:Os.name)||`Copper_${D.id}`,type:"copper"};B.push(ze),f(`[GameScene] : ${ze.name} (ID=${D.id})`)},onSetEnemy:async(y,C,D)=>{var Ie,He,je,mt,Os;const ne=D.id,ae=D.owned||!1;if(f(`[GameScene] : id=${ne}, pos=${C}, owned=${ae}`),B.find(rt=>rt.id===ne)){f(`[GameScene] ID=${ne}`);return}const we=(((Ie=D.enemy_base)==null?void 0:Ie.enemy_type)||"").toLowerCase()||"goblin";let $e=1;switch(we){case"demon":case"glutton":case"devourer":$e=1.5;break;case"guard":case"horn":$e=1.2;break;default:$e=1}const ze={id:ne,object:null,name:((He=D.enemy_base)==null?void 0:He.enemy_type)||`Enemy_${ne}`,type:ae?"summon":"enemy",position:C,isOwned:ae,isLoading:!0};B.push(ze);let Ne=await Kl(we,C,$e);if(!Ne){f(`[GameScene] : ${we}`);const rt=new qt(.8,.8,.8),lt=new $t({color:ae?4474111:16711680});Ne=new et(rt,lt),Ne.position.set(C[0],.4,C[1])}if(ae&&Ne){const lt=new wt().setFromObject(Ne).getSize(new Ae),at=new Xs(4474111,2.5,12);at.position.set(0,lt.y*$e*.8,0),Ne.add(at),f(`[GameScene] : ${we}`)}Ne.userData.modelId=ne,b.add(Ne),ze.object=Ne,ze.isLoading=!1,D.now_health!==void 0&&((je=D.enemy_base)==null?void 0:je.health)!==void 0&&L&&(L.createOrUpdateHealthBar(ne,D.now_health,D.enemy_base.health),f(`[GameScene] : ${we} (${D.now_health}/${D.enemy_base.health})`)),ae&&(ce.value.push({id:ne,name:((mt=D.enemy_base)==null?void 0:mt.name)||we,type:"summon",enemy:D}),f(`[GameScene] : ${we} (ID=${ne})`)),f(`[GameScene] : ${((Os=D.enemy_base)==null?void 0:Os.enemy_type)||ne}, owned=${ae}`)},onSetMaterial:async(y,C,D)=>{var $e,ze,Ne;if(f(`[GameScene] : id=${y}, pos=${C}, name=${($e=D.material_base)==null?void 0:$e.name}`),B.find(Ie=>Ie.id===y)){f(`[GameScene] ID=${y}`);return}const ae=((ze=D.material_base)==null?void 0:ze.name)||"",me=(Ne=D.material_base)==null?void 0:Ne.model_url;if(!me){f("[GameScene] model_url");const Ie=new qt(.5,.5,.5),He=new $t({color:16755200,metalness:.3,roughness:.7}),je=new et(Ie,He);je.position.set(C[0],.25,C[1]),je.userData.modelId=y,b.add(je),B.push({id:y,object:je,name:ae||`Material_${y}`,type:"material"});return}const be=Lf(me);let we=null;try{const Ie=await Ot.loadModel(be,!0),He=new Xt;He.add(Ie),He.position.set(C[0],0,C[1]),He.scale.set(1,1,1),He.rotation.y=0;const je=new wt().setFromObject(He);He.position.y=-je.min.y,we=He,f(`[GameScene] : ${ae}, URL: ${be}`)}catch(Ie){f(`[GameScene] : ${ae}`,Ie);const He=new qt(.5,.5,.5),je=new $t({color:16755200,metalness:.3,roughness:.7});we=new et(He,je),we.position.set(C[0],.25,C[1])}we.userData.modelId=y,b.add(we),B.push({id:y,object:we,name:ae||`Material_${y}`,type:"material"}),f(`[GameScene] : ${ae}`)},onSetStructure:async(y,C,D)=>{var $e,ze;if(f(`[GameScene] : id=${y}, pos=${C}`),B.find(Ne=>Ne.id===y)){f(`[GameScene] ID=${y}`);return}const ae=(($e=D.structure_base)==null?void 0:$e.name)||"",me=g_(ae),be=Il(me);let we=null;try{const Ne=await Ot.loadModel(be,!0),Ie=new Xt;Ie.add(Ne),Ie.position.set(C[0],0,C[1]),Ie.scale.set(1,1,1),Ie.rotation.y=0;const He=new wt().setFromObject(Ie);Ie.position.y=-He.min.y,we=Ie,f(`[GameScene] : ${ae}, URL: ${be}`)}catch(Ne){f(`[GameScene] : ${ae}`,Ne);const Ie=new qt(.9,1.2,.9),He=new $t({color:6710886,metalness:.5,roughness:.6});we=new et(Ie,He),we.position.set(C[0],.6,C[1])}we.userData.modelId=y,b.add(we),B.push({id:y,object:we,name:ae||`Structure_${y}`,type:"structure"}),f(`[GameScene] : ${ae}`),D.now_health!==void 0&&((ze=D.structure_base)!=null&&ze.health)&&L&&(L.createOrUpdateHealthBar(y,D.now_health,D.structure_base.health),f(`[GameScene] : ${ae} (${D.now_health}/${D.structure_base.health})`))},onPutResourceMarker:y=>{const C=`${y[0]},${y[1]}`;if(J.has(C)){const He=J.get(C);b.remove(He),He.traverse(je=>{je.geometry&&je.geometry.dispose(),je.material&&(Array.isArray(je.material)?je.material.forEach(mt=>mt.dispose()):je.material.dispose())}),J.delete(C)}const D=new Xt,ne=new so(.15,.2,.25,8),ae=new $t({color:16766720,emissive:16755200,emissiveIntensity:.6,metalness:.7,roughness:.3}),me=new et(ne,ae);me.position.y=.125,D.add(me);const be=new su(.08,8,8),we=new $t({color:16776960,emissive:16776960,emissiveIntensity:1}),$e=new et(be,we);$e.position.y=.3,D.add($e);const ze=y[0],Ne=y[1];D.position.set(ze,.15,Ne);const Ie=new Xs(16766720,1.5,3);Ie.position.set(0,.3,0),D.add(Ie),b.add(D),J.set(C,D)},onClearResourceMarker:y=>{const C=`${y[0]},${y[1]}`;if(J.has(C)){const D=J.get(C);b.remove(D),D.traverse(ne=>{ne.geometry&&ne.geometry.dispose(),ne.material&&(Array.isArray(ne.material)?ne.material.forEach(ae=>ae.dispose()):ne.material.dispose())}),J.delete(C)}},onDisplayCanMove:(y,C)=>{f(`[GameScene] : id=${y}, show=${C}`),te(y,"move",C),g.value&&g.value.id===y&&(g.value={...g.value,can_move:C},f(`[GameScene] selectedCopper.can_move=${C}`))},onDisplayCanAttack:(y,C)=>{f(`[GameScene] : id=${y}, show=${C}`),te(y,"attack",C),g.value&&g.value.id===y&&(g.value={...g.value,can_attack:C},f(`[GameScene] selectedCopper.can_attack=${C}`))},onDisplayCanSummon:(y,C)=>{var me;let D=C,ne=!1,ae=!1;g.value&&g.value.id===y?(ne=((me=g.value.copper)==null?void 0:me.copper_type)==="CraftsMan",ae=g.value.can_build===!0):dt.has(y)&&(ne=!0,ae=dt.get(y)),ne&&(D=ae,f(`[GameScene] : id=${y}, can_build=${D}`)),f(`[GameScene] /: id=${y}, show=${D}`),te(y,"summon",D),g.value&&g.value.id===y&&(g.value={...g.value,can_summon:D},f(`[GameScene] selectedCopper.can_summon=${D}`))},onClearState:y=>{if(f(`[GameScene] : id=${y}`),x.has(y)){const C=x.get(y);C.move&&(b.remove(C.move),C.move.geometry.dispose(),C.move.material.dispose(),delete C.move),C.attack&&(b.remove(C.attack),C.attack.geometry.dispose(),C.attack.material.dispose(),delete C.attack),C.summon&&(b.remove(C.summon),C.summon.geometry.dispose(),C.summon.material.dispose(),delete C.summon),x.delete(y)}},onUpdateHealth:(y,C,D)=>{f(`[GameScene] : id=${y}, hp=${C}/${D}`);const ne=Ce.get(y);if(ne!==void 0&&C<ne&&C>0){const ae=B.find(me=>me.id===y);if(ae){const me=ae.type==="copper",be=me?d.value:m.value;be&&(be.currentTime=0,be.play().catch(we=>{f(`[GameScene]  (${me?"":""}):`,we)}),f(`[GameScene] : ${me?"":""} (ID=${y})`))}}Ce.set(y,C),L&&L.createOrUpdateHealthBar(y,C,D)},onRemoveHealthBar:y=>{f(`[GameScene] : id=${y}`),L&&L.removeHealthBar(y),Ce.delete(y)},onPutMapBlock:y=>{const C=`${y[0]},${y[1]}`;if(k.has(C)){const me=k.get(C);b.remove(me),me.geometry.dispose(),me.material.dispose()}const D=new qt(.9,.05,.9),ne=new Ct({color:8421504}),ae=new et(D,ne);ae.position.set(y[0],.025,y[1]),b.add(ae),k.set(C,ae)},animateModelMove:(y,C,D)=>{if(!y||!y.object)return;const ne=y.type==="enemy",ae=ne?l.value:r.value;ae&&(ae.currentTime=0,ae.play().catch(Ne=>{f(`[GameScene]  (${ne?"":""}):`,Ne)})),y.isMoving=!0;const me=y.object.position.clone(),be=new Ae(C.x,C.y,C.z),we=500,$e=performance.now();function ze(){if(!y||!y.object){D&&D();return}const Ne=performance.now()-$e,Ie=Math.min(Ne/we,1),He=1-Math.pow(1-Ie,2);y.object.position.lerpVectors(me,be,He),Ie<1?requestAnimationFrame(ze):(y.object.position.copy(be),y.isMoving=!1,D&&D())}ze()},setTestMode:y=>{f(`[GameScene] ${y==="backend"?"":"EventLoop"}`),B.forEach(C=>{C.type==="test"?C.object.visible=y==="backend":(C.type==="copper"||C.type==="enemy")&&(C.object.visible=y==="eventloop")}),f(`[GameScene] ${y==="backend"?"":""}${y==="eventloop"?"":""}EventLoop`)}}),f("[GameScene] ")}function ql(x,k,J){const te=new Ae;x.getWorldPosition(te);const he=window.cameraFocusDistance||8,y=window.cameraFocusHeight||6,C=0,D=he;return{focusPosition:new Ae(te.x+C,te.y+y,te.z+D).clone(),focusTarget:te.clone(),lerpFactor:.1}}function Yi(){w.aspect=window.innerWidth/window.innerHeight,w.updateProjectionMatrix(),$.setSize(window.innerWidth,window.innerHeight)}function Ji(){if(requestAnimationFrame(Ji),ve.w||ve.a||ve.s||ve.d||ve.shift||ve.space){const x=new Ae;ve.w&&(x.z-=1),ve.s&&(x.z+=1),ve.a&&(x.x-=1),ve.d&&(x.x+=1),ve.shift&&(x.y-=1),ve.space&&(x.y+=1),x.applyQuaternion(w.quaternion),x.y=ve.shift?-1:ve.space?1:0,w.position.add(x.multiplyScalar(Ab))}ee.focusPosition&&ee.focusTarget&&(w.position.lerp(ee.focusPosition,ee.lerpFactor),w.lookAt(ee.focusTarget),Ge=w.rotation.y,Ee=w.rotation.x,w.position.distanceTo(ee.focusPosition)<.5&&(f("[GameScene] "),ee.focusPosition=null,ee.focusTarget=null)),L&&L.updateHealthBarsPosition(B),$.render(b,w)}function Zi(x){if(x.target.tagName!=="CANVAS")return;if(q.x=x.clientX/window.innerWidth*2-1,q.y=-(x.clientY/window.innerHeight)*2+1,Q.setFromCamera(q,w),ie.value==="moving"||ie.value==="attacking"||ie.value==="summoning"||ie.value==="building"||ie.value==="transferring"||ie.value==="structureMoving"||ie.value==="structureAttacking"||ie.value==="structureExtract"||ie.value==="structureTransfer"){Xl(q);return}const k=B.filter(te=>(te.type==="copper"||te.type==="summon"||te.type==="enemy"||te.type==="structure")&&te.object).map(te=>te.object),J=Q.intersectObjects(k,!0);if(J.length>0){let te=J[0].object;for(;te.parent&&!te.userData.modelId;)te=te.parent;const he=te.userData.modelId;if(he!==void 0){const y=B.find(ne=>ne.id===he),D={copper:"",summon:"",enemy:"",structure:""}[y==null?void 0:y.type]||"";f(`[GameScene] ${D}ID:`,he),(y==null?void 0:y.type)==="summon"||(y==null?void 0:y.type)==="enemy"?Hn(he,(y==null?void 0:y.type)==="enemy"):(y==null?void 0:y.type)==="structure"?rn(he):Is(he)}}else g.value=null,K.value=null}async function Xl(x){const k=new mr(new Ae(0,1,0),0),J=new aa;if(J.setFromCamera(x,w),ie.value==="moving"&&Qe.value){f("[GameScene] ");return}const te=new Ae;if(J.ray.intersectPlane(k,te),te){const he=Math.round(te.x),y=Math.round(te.z);f(`[GameScene] : (${he}, ${y})`);const C={moving:"move",attacking:"attack",summoning:"summon",building:"summon",structureMoving:"move",structureAttacking:"attack",structureExtract:"attack",structureTransfer:"attack"}[ie.value];if(!fe||!fe.hasIndicatorAt([he,y],C)){f(`[GameScene]  (${he}, ${y}) `);return}ie.value==="moving"?await Yl(he,y):ie.value==="attacking"?await Jl(he,y):ie.value==="summoning"?await Zl(he,y):ie.value==="building"?await Ql(he,y):ie.value==="structureMoving"?await lc(he,y):ie.value==="structureAttacking"?await cc(he,y):ie.value==="structureExtract"?await uc(he,y):ie.value==="structureTransfer"&&await dc(he,y)}}async function Yl(x,k){if(!g.value)return;if(Qe.value){f("[GameScene] ");return}const J=g.value.isOwnedEnemy===!0,te=J?"on_enemy_move_apply":"on_move_apply";f(`[GameScene] : (${x}, ${k}), =${J?"":""}, =${te}`);const he=JSON.stringify({type:te,content:{id:String(g.value.id),position:{x:String(x),y:String(k)}}});Qe.value=!0,await ke(he)}async function Jl(x,k){if(!g.value)return;const J=g.value.isOwnedEnemy===!0,te=J?"on_enemy_attack_apply":"on_attack_apply";f(`[GameScene] : (${x}, ${k}), =${J?"":""}, =${te}`);const he=g.value.id,y=B.find(D=>D.id===he);if(y){const D=y.type==="enemy",ne=D?u.value:c.value;ne&&(ne.currentTime=0,ne.play().catch(ae=>{f(`[GameScene]  (${D?"":""}):`,ae)})),Gn&&Gn(he,[x,k])}const C=JSON.stringify({type:te,content:{id:String(g.value.id),position:{x:String(x),y:String(k)}}});await ke(C)}async function Zl(x,k){if(!g.value)return;f(`[GameScene] : (${x}, ${k})`),z.value=[x,k];const J=JSON.stringify({type:"on_get_summon_menu"});await ke(J),await new Promise(te=>setTimeout(te,100)),Y.value=!0}async function Ql(x,k){if(!g.value||!le.value)return;f(`[GameScene]  ${le.value} : (${x}, ${k})`);const J=g.value.id,te=JSON.stringify({type:"on_structure_build_apply",content:{id:String(J),position:{x:String(x),y:String(k)},name:le.value}});await ke(te),ie.value=null,le.value=null,R.value&&R.value.cancelAction(),await new Promise(he=>setTimeout(he,100)),f("[GameScene] "),await Is(J)}async function ec(x){if(!g.value||!z.value)return;const[k,J]=z.value;f(`[GameScene]  ${x} : (${k}, ${J})`);try{const te=JSON.stringify({type:"on_summon_apply",content:{id:String(g.value.id),position:{x:String(k),y:String(J)},name:x}});await ke(te)}catch(te){f("[GameScene] :",te)}finally{Y.value=!1,ie.value=null,z.value=null,R.value&&R.value.cancelAction();try{const te=JSON.stringify({type:"on_summon_end"});await ke(te)}catch(te){f("[GameScene] :",te)}}}function tc(){Y.value=!1,z.value=null,ie.value=null;const x=JSON.stringify({type:"on_summon_end"});ke(x).catch(k=>{f("[GameScene] ",k)})}function Qi(){if(f("[GameScene] "),ie.value==="structureMoving"){const x=JSON.stringify({type:"on_structure_move_end"});ke(x).catch(k=>{f("[GameScene] ",k)})}else if(ie.value==="structureAttacking"){const x=JSON.stringify({type:"on_structure_attack_end"});ke(x).catch(k=>{f("[GameScene] ",k)})}else if(ie.value==="structureExtract"){const x=JSON.stringify({type:"on_structure_extract_end"});ke(x).catch(k=>{f("[GameScene] ",k)})}else if(ie.value==="structureTransfer"){const x=JSON.stringify({type:"on_structure_transfer_end"});ke(x).catch(k=>{f("[GameScene] ",k)})}ie.value=null}function sc(){Qi(),K.value=null,oe.value=null,f("[GameScene] ")}async function nc(x){if(!K.value)return;const k=K.value.id;switch(f(`[GameScene] : ${x.type}, ID=${k}`),x.type){case"move":await oc(k);break;case"attack":await ic(k);break;case"transfer":await rc(k);break;case"extract":await ac(k);break;default:f("[GameScene] :",x.type)}}async function oc(x){f(`[GameScene]  ${x} `);const k=JSON.stringify({type:"on_structure_move_start",content:{id:String(x)}});await ke(k),ie.value="structureMoving"}async function ic(x){f(`[GameScene]  ${x} `);const k=JSON.stringify({type:"on_structure_attack_start",content:{id:String(x)}});await ke(k),ie.value="structureAttacking"}async function ac(x){f(`[GameScene]  ${x} `);const k=JSON.stringify({type:"on_structure_extract_start",content:{id:String(x)}});await ke(k),ie.value="structureExtract"}async function rc(x){f(`[GameScene]  ${x} `);const k=JSON.stringify({type:"on_structure_transfer_start",content:{id:String(x)}});await ke(k),ie.value="structureTransfer"}async function lc(x,k){if(!K.value)return;f(`[GameScene]  ${K.value.id}  (${x}, ${k})`);const J=JSON.stringify({type:"on_structure_move_apply",content:{id:String(K.value.id),position:{x:String(x),y:String(k)}}});await ke(J),ie.value=null}async function cc(x,k){if(!K.value)return;f(`[GameScene]  ${K.value.id}  (${x}, ${k})`);const J=JSON.stringify({type:"on_structure_attack_apply",content:{id:String(K.value.id),position:{x:String(x),y:String(k)}}});await ke(J),ie.value=null}async function uc(x,k){if(!K.value)return;f(`[GameScene]  ${K.value.id}  (${x}, ${k}) `);const J=K.value.id,te=JSON.stringify({type:"on_structure_extract_apply",content:{id:String(J),position:{x:String(x),y:String(k)}}});await ke(te),f("[GameScene] ");const he=JSON.stringify({type:"on_structure_extract_end"});await ke(he),await new Promise(y=>setTimeout(y,100)),f("[GameScene] "),ie.value=null,setTimeout(async()=>{f("[GameScene] "),await rn(J)},300)}async function dc(x,k){if(!K.value)return;f(`[GameScene]  ${K.value.id}  (${x}, ${k}) `);const J=K.value.id,te=JSON.stringify({type:"on_structure_transfer_apply",content:{id:String(J),position:{x:String(x),y:String(k)}}});await ke(te),f("[GameScene] ");const he=JSON.stringify({type:"on_structure_transfer_end"});await ke(he),await new Promise(y=>setTimeout(y,100)),f("[GameScene] "),ie.value=null,setTimeout(async()=>{f("[GameScene] "),await rn(J)},300)}async function Is(x){const k=ce.value.findIndex(te=>te.id===x);k!==-1&&(ge.value=k),K.value=null;const J=JSON.stringify({type:"on_click_copper",content:{id:String(x)}});await ke(J)}async function rn(x){f(`[GameScene] : ID=${x}`),g.value=null;const k=JSON.stringify({type:"on_click_structure",content:{id:String(x)}});await ke(k)}async function Hn(x,k=!1){if(k)ge.value=-1,No();else{const te=ce.value.findIndex(he=>he.id===x);te!==-1&&(ge.value=te)}K.value=null;const J=JSON.stringify({type:"on_click_enemy",content:{id:String(x)}});await ke(J)}function No(){g.value=null,T.value=[],ie.value=null}async function fc(x){if(f("[GameScene] :",x),x.type==="moveStart")ie.value="moving";else if(x.type==="attackStart")ie.value="attacking";else if(x.type==="summonStart")ie.value="summoning";else if(x.type==="buildRequest"){f("[GameScene] ");const k=JSON.stringify({type:"on_get_structure_menu"});await ke(k)}else if(x.type==="buildStart")ie.value="building",le.value=x.structureName||null;else if(x.type==="transferring"||x.type==="transferStart")ie.value="transferring",H.value=[],N.value=[];else if(x.type==="transferComplete")ie.value=null,H.value=[],N.value=[];else if(x.type==="cancel"){const k=ie.value;if(k==="moving"){const J=JSON.stringify({type:"on_move_end"});ke(J).catch(te=>{f("[GameScene] ",te)})}else if(k==="attacking"){const J=JSON.stringify({type:"on_attack_end"});ke(J).catch(te=>{f("[GameScene] ",te)})}else if(k==="transferring"){const J=JSON.stringify({type:"on_transfer_end"});ke(J).catch(te=>{f("[GameScene] ",te)}),H.value=[],N.value=[]}else if(k==="summoning"){const J=JSON.stringify({type:"on_summon_end"});ke(J).catch(te=>{f("[GameScene] ",te)}),Y.value=!1}else if(k==="building"){const J=JSON.stringify({type:"on_structure_build_end"});ke(J).catch(te=>{f("[GameScene] ",te)}),le.value=null,z.value=null}ie.value=null}else x.type==="wait"&&(f("[GameScene] "),Go())}function ea(){if(ce.value.length!==0){if(g.value){const x=g.value.can_move,k=g.value.can_attack,J=g.value.can_summon;if(f(`[GameScene] : ID=${g.value.id}, can_move=${x}, can_attack=${k}, can_summon=${J}, hasAttackTargets=${j.value}`),x||k&&j.value||J){f("[GameScene] ");return}}f("[GameScene] "),Go()}}async function Go(){var J,te,he;if(ce.value.length===0)return;g.value=null,ie.value=null,ge.value;let x=0;const k=ce.value.length;for(;x<k;){ge.value=(ge.value+1)%ce.value.length;const y=ce.value[ge.value];f(`[GameScene] : ${y.name||y.id} ( ${x+1}/${k})`),await new Promise(me=>{setTimeout(async()=>{const be=B.find($e=>$e.id===y.id);(be==null?void 0:be.type)==="summon"?await Hn(y.id,!1):await Is(y.id),me()},300)}),await new Promise(me=>setTimeout(me,200));const C=((J=g.value)==null?void 0:J.can_move)||!1,D=((te=g.value)==null?void 0:te.can_attack)||!1,ne=((he=g.value)==null?void 0:he.can_summon)||!1,ae=C||D&&j.value||ne;if(f(`[GameScene]  ${y.name}: can_move=${C}, can_attack=${D}, can_summon=${ne}, hasTargets=${j.value}, valid=${ae}`),g.value&&ae){f(`[GameScene] : ${y.name||y.id}`);return}x++}f("[GameScene] "),g.value=null,s.isGameMode&&f('[GameScene] ""')}function pc(){pe.value++,ge.value=-1,g.value=null,ie.value=null,ce.value.forEach(k=>k.turnDone=!1),f(`[GameScene]  ${pe.value}`);const x=B.filter(k=>k.type==="enemy"&&!k.isOwned);if(f(`[GameScene]  ${x.length} `),x.length===0)f("[GameScene] "),Me.value=!1;else{Me.value=!0,qe.value.clear(),f("[GameScene] ");let k=setTimeout(()=>{Me.value&&qe.value.size>0&&(f("[GameScene] "),Me.value=!1,qe.value.clear())},3e3),J=setInterval(()=>{Me.value||(clearTimeout(k),clearInterval(J))},100);setTimeout(()=>{Me.value&&qe.value.size===0&&(f("[GameScene] "),Me.value=!1,clearTimeout(k),clearInterval(J))},1e3)}}async function hc(){f("[GameScene] "),ft.value=!1;const x=JSON.stringify({type:"on_game_over"});await ke(x).catch(k=>{f("[GameScene]  on_game_over ",k)}),o("back")}async function mc(){f("[GameScene] game over"),Nt.value=!1;const x=JSON.stringify({type:"on_game_over"});await ke(x).catch(k=>{f("[GameScene]  on_game_over ",k)}),_c()}function _c(){f("[GameScene] "),es.value=!0,setTimeout(()=>{f("[GameScene] "),es.value=!1,o("back")},5e3)}function gc(){f("[GameScene] "),es.value=!1,o("back")}function vc(){f("[GameScene] "),it.value=!0}function yc(){f("[GameScene] "),it.value=!1}async function bc(){f("[GameScene]  game_over "),it.value=!1;const x=JSON.stringify({type:"on_game_over"});await ke(x).catch(k=>{f("[GameScene]  on_game_over ",k)}),o("back")}return(x,k)=>{var J,te,he,y;return I(),U("div",_b,[p("div",{ref_key:"container",ref:n,class:"scene-container"},null,512),t.isGameMode?(I(),Lt($v,{key:0,currentCopperId:Gt.value,copperList:ce.value,roundNumber:pe.value,isEnemyMoving:Me.value,onNextCopper:Go,onEndRound:pc,onSelectCopper:Is},null,8,["currentCopperId","copperList","roundNumber","isEnemyMoving"])):ye("",!0),t.isGameMode?(I(),U("button",{key:1,class:"withdraw-button",onClick:vc},"  ")):ye("",!0),t.isGameMode?(I(),Lt(mb,{key:2})):ye("",!0),t.isGameMode&&g.value?(I(),Lt(_v,{key:3,ref_key:"copperActionPanelRef",ref:R,copper:g.value,resources:T.value,hasAttackTargets:j.value,transferTargets:N.value,onSelectCopper:Is,onClose:No,onAction:fc},null,8,["copper","resources","hasAttackTargets","transferTargets"])):ye("",!0),t.isGameMode?(I(),Lt(ry,{key:4,visible:Y.value,"copper-name":((he=(te=(J=g.value)==null?void 0:J.copper)==null?void 0:te.copper_info)==null?void 0:he.name)||"","enemy-list":_e.value,position:z.value,onClose:tc,onSummon:ec},null,8,["visible","copper-name","enemy-list","position"])):ye("",!0),t.isGameMode&&K.value?(I(),Lt($y,{key:5,structure:K.value,resources:((y=oe.value)==null?void 0:y.resources)||[],"action-mode":ie.value==="structureMoving"?"move":ie.value==="structureAttacking"?"attack":ie.value==="structureExtract"?"extract":ie.value==="structureTransfer"?"transfer":null,onClose:sc,onAction:nc,onCancel:Qi},null,8,["structure","resources","action-mode"])):ye("",!0),t.isGameMode?ye("",!0):(I(),U("div",gb,[...k[0]||(k[0]=[fo('<h3 data-v-d71fd2f3>3D</h3><p style="color:#ffd700;font-weight:600;" data-v-d71fd2f3> </p><div style="margin:8px 0;padding:8px;background:rgba(255, 255, 255, 0.1);border-radius:6px;" data-v-d71fd2f3><p style="font-weight:600;" data-v-d71fd2f3> </p><p style="font-size:12px;" data-v-d71fd2f3>  = ID:1</p><p style="font-size:12px;" data-v-d71fd2f3>  = ID:2</p></div><div style="margin:8px 0;padding:8px;background:rgba(255, 255, 255, 0.1);border-radius:6px;" data-v-d71fd2f3><p style="font-weight:600;" data-v-d71fd2f3> EventLoop</p><p style="font-size:12px;" data-v-d71fd2f3>1.   EventLoop</p><p style="font-size:12px;" data-v-d71fd2f3>2. &quot; &quot;</p><p style="font-size:12px;" data-v-d71fd2f3>3. 3</p><p style="font-size:11px;" data-v-d71fd2f3>  =IronWall  =Arcanist  =CraftsMan </p></div>',4)])])),ft.value?(I(),U("div",vb,[p("div",{class:"game-over-dialog"},[k[1]||(k[1]=p("h2",{class:"game-over-title"},"",-1)),k[2]||(k[2]=p("p",{class:"game-over-message"},"",-1)),p("button",{class:"game-over-button",onClick:hc},"  ")])])):ye("",!0),Nt.value?(I(),U("div",yb,[p("div",{class:"game-over-dialog success-dialog"},[k[3]||(k[3]=p("h2",{class:"success-title"},"  ",-1)),k[4]||(k[4]=p("p",{class:"game-over-message"},"",-1)),p("button",{class:"game-over-button success-button",onClick:mc},"  ")])])):ye("",!0),es.value?(I(),U("div",bb,[p("div",{class:"credits-container"},[k[5]||(k[5]=fo('<h1 class="credits-title" data-v-d71fd2f3></h1><div class="credits-content" data-v-d71fd2f3><div class="credits-section" data-v-d71fd2f3><h2 data-v-d71fd2f3></h2><p data-v-d71fd2f3>MGPIC Team</p></div><div class="credits-section" data-v-d71fd2f3><h2 data-v-d71fd2f3></h2><p data-v-d71fd2f3>Backend Developer</p><p data-v-d71fd2f3>Frontend Developer</p></div><div class="credits-section" data-v-d71fd2f3><h2 data-v-d71fd2f3></h2><p data-v-d71fd2f3>3D Artist</p><p data-v-d71fd2f3>UI Designer</p></div><div class="credits-section" data-v-d71fd2f3><h2 data-v-d71fd2f3></h2><p data-v-d71fd2f3>Sound Designer</p></div><div class="credits-section" data-v-d71fd2f3><h2 data-v-d71fd2f3></h2><p data-v-d71fd2f3></p></div></div>',2)),p("button",{class:"skip-credits-button",onClick:gc},"")])])):ye("",!0),it.value?(I(),U("div",wb,[p("div",{class:"game-over-dialog"},[k[6]||(k[6]=p("h2",{class:"withdraw-title"},"",-1)),k[7]||(k[7]=p("p",{class:"game-over-message"},[Ps(""),p("br"),Ps("")],-1)),p("div",{class:"dialog-buttons"},[p("button",{class:"dialog-button cancel-button",onClick:yc},"  "),p("button",{class:"dialog-button confirm-button",onClick:bc},"  ")])])])):ye("",!0),p("audio",{ref_key:"audioRef",ref:i,src:ue(a),loop:"",preload:"auto"},null,8,Sb),p("audio",{ref_key:"moveSoundRef",ref:r,src:ue(h),preload:"auto"},null,8,Tb),p("audio",{ref_key:"moveEnemySoundRef",ref:l,src:ue(_),preload:"auto"},null,8,Mb),p("audio",{ref_key:"attackSoundRef",ref:c,src:ue(E),preload:"auto"},null,8,Cb),p("audio",{ref_key:"attackEnemySoundRef",ref:u,src:ue(S),preload:"auto"},null,8,Eb),p("audio",{ref_key:"meHurtSoundRef",ref:d,src:ue(v),preload:"auto"},null,8,xb),p("audio",{ref_key:"enemyHurtSoundRef",ref:m,src:ue(M),preload:"auto"},null,8,kb)])}}},Lb=ut(Pb,[["__scopeId","data-v-d71fd2f3"]]),Ib={class:"stage"},Ob={key:0,style:{position:"relative",width:"100%",height:"100%"}},Db={key:2,class:"modal"},Nb={class:"modal-title"},Gb={key:2,class:"overlay",style:{"z-index":"30000","align-items":"flex-start","justify-content":"flex-start",background:"rgba(0, 0, 0, 0.25)"}},Hb={class:"settings"},Ub={class:"settings__header"},Fb=["src"],Bb={class:"settings__content"},jb={class:"settings__section"},zb={class:"settings__control-options"},Vb={__name:"App",setup(t){const e=W(!1),s=W(null),n=W(!1),o=W(null),i=W([]);W(0);const a=W(!0),r=W(!1),l=W("touchpad"),c=W(!1);let u=null;function d(q){s.value!==q&&(i.value.push(s.value),s.value=q),window.__START_MENU_PAUSE__&&window.__START_MENU_PAUSE__(),e.value=!0}function m(){a.value=!1,u&&clearTimeout(u),u=setTimeout(()=>{a.value||(f("[App] StartMenu"),c.value=!0)},5*60*1e3)}function h(){s.value=null,i.value=[],window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__(),e.value=!1}function _(q){f("[App] ID:",q.ids),h(),r.value=!0,f("[App] ")}function E(){r.value=!1}function S(){const q=Do();l.value=q.controlMode,n.value=!0,e.value=!0}function v(){n.value=!1,s.value||(window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__(),e.value=!1)}function M(q){l.value=q,Fl("controlMode",q),window.updateControlMode&&window.updateControlMode(q),f(`[App] : ${q}`)}function b(){if(n.value){v();return}if(s.value){if(s.value==="warehouse"&&o.value&&o.value.handleBack&&o.value.handleBack())return;const q=i.value.pop()??null;s.value=q,q||(e.value=!1);return}if(!a.value){u&&(clearTimeout(u),u=null),c.value&&(c.value=!1,f("[App] StartMenu")),a.value=!0,setTimeout(()=>{window.__INIT_THREE_SCENE__?window.__INIT_THREE_SCENE__().then(()=>{window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__()}).catch(()=>{window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__()}):window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__()},100),e.value=!1;return}}const w=W(!0),$=W(null);function F(){w.value=!w.value,f("[App] :",w.value?"":"")}async function B(){try{f("[App] ...");const q=await Wf();if(q.type==="error"){f("[App] :",q.content),alert(": "+q.content);return}f("[App] ...");const P=new Blob([JSON.stringify(q,null,2)],{type:"application/json"}),L=document.createElement("a");L.href=URL.createObjectURL(P);const fe=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);L.download=`mgpic-save-${fe}.json`,L.click(),URL.revokeObjectURL(L.href),f("[App] ")}catch(q){f("[App] :",q),alert("")}}function ee(){try{$.value&&$.value.click()}catch{}}async function Q(q){try{const P=q.target&&q.target.files&&q.target.files[0];if(!P)return;f("[App] ...");const L=new FileReader;L.onload=async()=>{try{const fe=String(L.result||"{}"),Te=JSON.parse(fe);f("[App] ..."),await Kf(fe),f("[App] "),alert("")}catch(fe){f("[App] :",fe),alert(": "+fe.message)}q.target.value=""},L.onerror=()=>{f("[App] "),alert(""),q.target.value=""},L.readAsText(P)}catch(P){f("[App] :",P),alert("")}}return Et(()=>{Nl(q=>{})}),cs(()=>{u&&(clearTimeout(u),u=null)}),(q,P)=>(I(),U("div",Ib,[r.value?(I(),Lt(Lb,{key:0,isGameMode:!0,"music-on":w.value,onBack:E},null,8,["music-on"])):ye("",!0),r.value?ye("",!0):(I(),U(We,{key:1},[c.value?ye("",!0):qr((I(),Lt(Cm,{key:0,visible:a.value,onStarted:m},null,8,["visible"])),[[$l,a.value]]),a.value?ye("",!0):(I(),Lt(Za,{key:1,"music-on":w.value,onBack:b,onOpenSettings:S,onToggleMusic:F},null,8,["music-on"])),tt(Nf,{"music-on":w.value,paused:s.value==="start"||s.value==="warehouse"||r.value,onStartGame:P[0]||(P[0]=L=>d("start")),onOpenWarehouse:P[1]||(P[1]=L=>d("warehouse")),onOpenTutorial:P[2]||(P[2]=L=>d("tutorial")),onOpenEncyclopedia:P[3]||(P[3]=L=>d("encyclopedia")),onToggleMusic:F},null,8,["music-on","paused"]),s.value?(I(),U("div",{key:2,class:Ye(["overlay",{"overlay--warehouse":s.value==="warehouse"}])},[s.value==="warehouse"?(I(),U("div",Ob,[tt(Za,{"music-on":w.value,onBack:b,onOpenSettings:S,onToggleMusic:F},null,8,["music-on"]),tt(om,{ref_key:"warehouseRef",ref:o,"music-on":w.value},null,8,["music-on"])])):s.value==="start"?(I(),Lt(d_,{key:1,"music-on":w.value,paused:r.value,onClose:h,onConfirm:_},null,8,["music-on","paused"])):(I(),U("div",Db,[p("h2",Nb,se(s.value==="warehouse"?"  Copper Warehouse":s.value==="tutorial"?"  Tutorial":s.value==="encyclopedia"?"  Game Encyclopedia":"  Start Game"),1),P[6]||(P[6]=p("p",{class:"modal-body"},"",-1)),p("button",{class:"close-btn",onClick:h},"")]))],2)):ye("",!0)],64)),n.value?(I(),U("div",Gb,[p("div",Hb,[p("div",Ub,[P[7]||(P[7]=p("div",{class:"settings__title"},"",-1)),p("button",{class:"settings__close",onClick:v,"aria-label":""},[p("img",{src:ue(G)("@assets/ui/close.png"),alt:""},null,8,Fb)])]),p("div",Bb,[p("div",jb,[P[10]||(P[10]=p("div",{class:"settings__section-title"},"",-1)),p("div",zb,[p("button",{class:Ye(["settings__control-btn",{active:l.value==="touchpad"}]),onClick:P[4]||(P[4]=L=>M("touchpad"))},[...P[8]||(P[8]=[p("span",{class:"control-title"},"",-1),p("span",{class:"control-desc"},"",-1)])],2),p("button",{class:Ye(["settings__control-btn",{active:l.value==="mouse"}]),onClick:P[5]||(P[5]=L=>M("mouse"))},[...P[9]||(P[9]=[p("span",{class:"control-title"},"",-1),p("span",{class:"control-desc"},"",-1)])],2)])]),p("button",{class:"settings__item",onClick:B},[...P[11]||(P[11]=[fo('<span class="settings__icon" data-v-6f1cd762><svg width="44" height="44" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-6f1cd762><path d="M12 3v12m0 0l-4-4m4 4l4-4" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-6f1cd762></path><path d="M4 19h16" stroke="#fff" stroke-width="2" stroke-linecap="round" data-v-6f1cd762></path></svg></span><span class="settings__label" data-v-6f1cd762></span>',2)])]),p("button",{class:"settings__item",onClick:ee},[...P[12]||(P[12]=[fo('<span class="settings__icon" data-v-6f1cd762><svg width="44" height="44" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-6f1cd762><path d="M12 21V9m0 0l4 4m-4-4L8 13" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-6f1cd762></path><path d="M4 5h16" stroke="#fff" stroke-width="2" stroke-linecap="round" data-v-6f1cd762></path></svg></span><span class="settings__label" data-v-6f1cd762></span>',2)])]),p("input",{ref_key:"fileInput",ref:$,type:"file",accept:".json",onChange:Q,style:{display:"none"}},null,544)])])])):ye("",!0)]))}},or=ut(Vb,[["__scopeId","data-v-6f1cd762"]]);function Kb(){const t=navigator.userAgent;return/Safari/.test(t)&&!/Chrome/.test(t)&&!/Chromium/.test(t)}function Wb(){const t=document.getElementById("safari-warning"),e=document.getElementById("loading-screen");t.style.display="flex",e.style.display="none",document.getElementById("continue-safari").addEventListener("click",()=>{t.style.display="none",e.style.display="flex",jl()}),document.getElementById("download-chrome").addEventListener("click",()=>{window.open("https://www.google.com/chrome/","_blank")})}function oi(t,e,s,n=""){const o=document.getElementById("progress-bar"),i=document.getElementById("progress-text"),a=document.querySelector(".loading-subtitle");o&&(o.style.width=s+"%"),i&&(t===0&&e===0?i.textContent=`${s}%`:i.textContent=`${t} / ${e} (${s}%)`),a&&n&&(a.textContent=n)}function ir(){const t=document.getElementById("loading-screen");t&&(t.classList.add("fade-out"),setTimeout(()=>{t.style.display="none"},500))}async function jl(){try{f("..."),await Mi(oi,["high"]),f(""),oi(0,100,100,"..."),ja(or).mount("#app"),await new Promise(e=>setTimeout(e,200)),window.__INIT_THREE_SCENE__&&await window.__INIT_THREE_SCENE__((e,s,n)=>{oi(0,0,n,`3D... ${n}%`)}),f(""),setTimeout(()=>{ir()},300),setTimeout(async()=>{try{f("..."),await Mi(null,["medium"]),f("")}catch(e){f(":",e)}},1e3)}catch(t){f(":",t),ja(or).mount("#app"),ir()}}Kb()?(f("Safari"),Wb()):(f("Safari"),jl());
